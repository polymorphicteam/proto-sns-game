(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[792],{10540(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},11249(e,t,n){"use strict";n.d(t,{A:()=>r});var o=n(31601),a=n.n(o),i=n(76314),s=n.n(i)()(a());s.push([e.id,"body {\n  margin: 0;\n  padding: 0;\n  background: black;\n  overflow: hidden;\n}\n\n#game-canvas {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: block;\n}\n\n/* ============================================ */\n/* React Overlay Styles */\n/* ============================================ */\n\n#react-overlay {\n  position: fixed;\n  pointer-events: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Game Overlay Container */\n/* ============================================ */\n\n.game-overlay-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  user-select: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Top HUD */\n/* ============================================ */\n\n.top-hud {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  justify-content: space-between;\n  padding: 20px;\n}\n\n/* ============================================ */\n/* Lives Display (Top Left) */\n/* ============================================ */\n\n.lives-container {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.lives-label {\n  color: white;\n  font-family: sans-serif;\n  font-size: 20px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n.hearts-container {\n  display: flex;\n  gap: 5px;\n}\n\n.heart {\n  font-size: 24px;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n.empty-heart {\n  font-size: 24px;\n  opacity: 0.3;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n/* ============================================ */\n/* Coin Counter (Top Right) */\n/* ============================================ */\n\n.coin-counter {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.coin-icon {\n  font-size: 24px;\n}\n\n.coin-count {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Power-ups Display (Top Center) */\n/* ============================================ */\n\n.powerups-container {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 10px;\n}\n\n.powerup-icon {\n  padding: 8px 16px;\n  background-color: rgba(255, 215, 0, 0.2);\n  border: 2px solid gold;\n  border-radius: 8px;\n  color: white;\n  font-family: sans-serif;\n  font-size: 16px;\n  font-weight: bold;\n  text-shadow: 1px 1px 0 #000;\n}\n\n/* ============================================ */\n/* Game Over Screen */\n/* ============================================ */\n\n.gameover-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  pointer-events: auto;\n}\n\n.gameover-text {\n  color: #ff4444;\n  font-family: sans-serif;\n  font-size: 64px;\n  font-weight: bold;\n  text-shadow: 4px 4px 0 #000;\n  margin-bottom: 20px;\n}\n\n.gameover-subtext {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Victory Screen */\n/* ============================================ */\n\n.victory-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  pointer-events: auto;\n  animation: victory-pulse 0.5s ease-out;\n}\n\n@keyframes victory-pulse {\n  0% {\n    transform: translate(-50%, -50%) scale(0.5);\n    opacity: 0;\n  }\n\n  50% {\n    transform: translate(-50%, -50%) scale(1.1);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) scale(1);\n    opacity: 1;\n  }\n}\n\n.victory-text {\n  font-family: 'Inter', sans-serif;\n  font-size: 72px;\n  font-weight: 900;\n  background: linear-gradient(180deg, #ffd700 0%, #ff8c00 50%, #ffd700 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 30px rgba(255, 215, 0, 0.5));\n  margin-bottom: 20px;\n  animation: victory-glow 1s ease-in-out infinite alternate;\n}\n\n@keyframes victory-glow {\n  0% {\n    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 215, 0, 0.4));\n  }\n\n  100% {\n    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.8));\n  }\n}\n\n.victory-subtext {\n  color: white;\n  font-family: 'Inter', sans-serif;\n  font-size: 28px;\n  font-weight: 600;\n  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n}\n\n/* ============================================ */\n/* Loading Screen */\n/* ============================================ */\n\n.loading-screen {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(180deg, #2c1810 0%, #4a2c1a 30%, #8b4513 70%, #2c1810 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n}\n\n.intro-image-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.intro-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  object-position: center;\n}\n\n.loading-indicator {\n  position: absolute;\n  bottom: 40px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  background: rgba(0, 0, 0, 0.7);\n  padding: 16px 32px;\n  border-radius: 12px;\n  backdrop-filter: blur(8px);\n}\n\n.loading-content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 24px;\n}\n\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.2);\n  border-top: 3px solid #ffd700;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n.loading-text {\n  color: white;\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 18px;\n  font-weight: 600;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);\n  animation: pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes pulse {\n\n  0%,\n  100% {\n    opacity: 1;\n  }\n\n  50% {\n    opacity: 0.5;\n  }\n}\n\n/* Start Button - 1940s Diner Style */\n.start-button {\n  padding: 16px 48px;\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 24px;\n  font-weight: 700;\n  letter-spacing: 3px;\n  text-transform: uppercase;\n  color: #fff;\n  background: linear-gradient(180deg, #ff6b35 0%, #d32f2f 100%);\n  border: 3px solid #ffd700;\n  border-radius: 12px;\n  cursor: pointer;\n  pointer-events: auto;\n  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\n  box-shadow:\n    0 4px 15px rgba(255, 107, 53, 0.4),\n    0 0 30px rgba(255, 215, 0, 0.3),\n    inset 0 1px 0 rgba(255, 255, 255, 0.3);\n  transition: all 0.2s ease;\n}\n\n.start-button:hover {\n  transform: scale(1.05);\n  background: linear-gradient(180deg, #ff8a50 0%, #e53935 100%);\n  box-shadow:\n    0 6px 20px rgba(255, 107, 53, 0.6),\n    0 0 40px rgba(255, 215, 0, 0.5),\n    inset 0 1px 0 rgba(255, 255, 255, 0.3);\n}\n\n.start-button:active {\n  transform: scale(0.98);\n}\n\n/* ============================================ */\n/* Countdown Overlay */\n/* ============================================ */\n\n.countdown-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  pointer-events: none;\n}\n\n.countdown-number {\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 150px;\n  font-weight: 900;\n  color: #ffa500;\n  background: linear-gradient(180deg, #ffdd00 0%, #ff8c00 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 165, 0, 0.5));\n  animation: countdown-zoom 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;\n}\n\n.countdown-go {\n  color: #4ade80;\n  text-shadow:\n    0 0 20px rgba(74, 222, 128, 0.5),\n    0 0 40px rgba(74, 222, 128, 0.3),\n    0 4px 8px rgba(0, 0, 0, 0.5);\n}\n\n@keyframes countdown-zoom {\n  0% {\n    transform: scale(0.3);\n    opacity: 0;\n  }\n\n  20% {\n    opacity: 1;\n  }\n\n  70% {\n    transform: scale(1.1);\n    opacity: 1;\n  }\n\n  100% {\n    transform: scale(1.0);\n    opacity: 0;\n  }\n}\n\n/* ============================================ */\n/* Match Timer */\n/* ============================================ */\n\n.match-timer {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 2rem;\n  font-weight: bold;\n  color: #fff;\n  text-shadow:\n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 10px rgba(255, 255, 255, 0.3);\n  pointer-events: none;\n  z-index: 100;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 8px;\n}\n\n.match-timer.timer-warning {\n  color: #ff4444;\n  animation: pulse-warning 0.5s ease-in-out infinite;\n  text-shadow:\n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 15px rgba(255, 68, 68, 0.6);\n}\n\n@keyframes pulse-warning {\n\n  0%,\n  100% {\n    transform: translateX(-50%) scale(1);\n  }\n\n  50% {\n    transform: translateX(-50%) scale(1.1);\n  }\n}",""]);const r=s},25100(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/duck/oring_new.glb"},31601(e){"use strict";e.exports=function(e){return e[1]}},34538(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/platform/green_car.glb"},39012(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/insuperable/Soda_new1.glb"},41113(e){"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},44503(e,t,n){var o={"./duck/oring_new.glb":25100,"./insuperable/Fries_new.glb":65115,"./insuperable/Soda_new1.glb":39012,"./jump/Burger.glb":82218,"./platform/flame_car.glb":82638,"./platform/green_car.glb":34538,"./platform/red_car.glb":71034,"./platform/white_car.glb":74568};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=44503},55056(e,t,n){"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},55464(e,t,n){"use strict";var o=n(85072),a=n.n(o),i=n(97825),s=n.n(i),r=n(77659),l=n.n(r),c=n(55056),d=n.n(c),u=n(10540),p=n.n(u),f=n(41113),g=n.n(f),m=n(11249),h={};h.styleTagTransform=g(),h.setAttributes=d(),h.insert=l().bind(null,"head"),h.domAPI=s(),h.insertStyleElement=p(),a()(m.A,h),m.A&&m.A.locals&&m.A.locals;var v=n(11964);n(57792);const b={Idle:[0,88],Run:[89,109],Strafe_L:[182,201],Strafe_R:[202,221]};function x(e,t){const[n,o]=b[e];return{start:n,end:o,loop:!0,scroll:t}}const y=135,w={Idle:x("Idle",0),Run:x("Run",y),Slide:{start:110,end:154,loop:!1,scroll:y},Jump:{start:155,end:181,loop:!1,scroll:y,allowStrafe:!1},Strafe_L:x("Strafe_L",y),Strafe_R:x("Strafe_R",y),Run_Idle:{start:222,end:248,loop:!1,scroll:0},Fall:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1},Getup:{start:325,end:552,loop:!1,scroll:0,allowStrafe:!1},Death:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1}},S=new Set(["Slide","Jump","Fall","Getup","Death"]);var C=n(96540);const M=e=>{let t;const n=new Set,o=(e,o)=>{const a="function"==typeof e?e(t):e;if(!Object.is(a,t)){const e=t;t=(null!=o?o:"object"!=typeof a||null===a)?a:Object.assign({},t,a),n.forEach(n=>n(t,e))}},a=()=>t,i={setState:o,getState:a,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(o,a,i);return i},I=e=>e,P=e=>{const t=(e=>e?M(e):M)(e),n=e=>function(e,t=I){const n=C.useSyncExternalStore(e.subscribe,C.useCallback(()=>t(e.getState()),[e,t]),C.useCallback(()=>t(e.getInitialState()),[e,t]));return C.useDebugValue(n),n}(t,e);return Object.assign(n,t),n},R={coinCount:0,score:0,lives:3,gameState:"idle",isLoading:!0,showIntroScreen:!0,countdownValue:null,matchDuration:120,matchTimeRemaining:120,isMatchTimerActive:!1,activePowerUps:[]},k=(j=e=>Object.assign(Object.assign({},R),{updateCoinCount:t=>e({coinCount:t}),incrementCoinCount:t=>e(e=>({coinCount:e.coinCount+t})),resetCoinCount:()=>e({coinCount:0}),decrementLives:()=>e(e=>{const t=Math.max(0,e.lives-1),n=t<=0?"gameover":e.gameState;return console.log(`‚ù§Ô∏è Lives: ${t} | Game State: ${n}`),{lives:t,gameState:n}}),setLives:t=>e({lives:Math.max(0,t)}),addScore:t=>e(e=>({score:e.score+t})),setGameState:t=>{console.log(`üéÆ Game State: ${t}`),e({gameState:t})},activatePowerUp:(t,n)=>e(e=>{const o=Date.now()+n,a={type:t,expiresAt:o},i=e.activePowerUps.filter(e=>e.type!==t);return console.log(`‚ö° Power-up activated: ${t} (expires in ${n}ms)`),{activePowerUps:[...i,a]}}),deactivatePowerUp:t=>e(e=>({activePowerUps:e.activePowerUps.filter(e=>e.type!==t)})),setLoading:t=>{console.log(`‚è≥ Loading: ${t}`),e({isLoading:t})},dismissIntroScreen:()=>{console.log("üé¨ Intro screen dismissed"),e({showIntroScreen:!1})},setCountdown:t=>{e({countdownValue:t})},startMatchTimer:()=>{e(e=>({isMatchTimerActive:!0,matchTimeRemaining:e.matchDuration})),console.log("‚è±Ô∏è Match timer started")},tickMatchTimer:t=>e(e=>{if(!e.isMatchTimerActive)return{};if("playing"!==e.gameState)return{};const n=Math.max(0,e.matchTimeRemaining-t);if(n<=0){const t=e.lives>0;return console.log(t?"üéâ VICTORY! Player survived the match!":"‚è±Ô∏è TIME'S UP! Match ended."),{matchTimeRemaining:0,isMatchTimerActive:!1,gameState:t?"victory":"gameover"}}return{matchTimeRemaining:n}}),stopMatchTimer:()=>{e({isMatchTimerActive:!1}),console.log("‚è±Ô∏è Match timer stopped")},resetGame:()=>{console.log("üîÑ Game reset"),e(Object.assign(Object.assign({},R),{isLoading:!1,showIntroScreen:!1,countdownValue:null}))}}))?P(j):P;var j;let z=0;function T(e,t,n,o,a,i,s,r,l){const c={forward:!1,slide:!1,jump:!1,leftPressed:!1,rightPressed:!1};let d=null;const u={Digit1:"Idle",Digit2:"Run",Digit3:"Slide",Digit4:"Jump",Digit5:"Run_Idle"};let p=0,f=0,g=!1,m=!1,h=null,b=null,x=0,y=0,C=!1;const M={halfWidth:0,halfDepth:0,standingHeight:0,slideHeight:0,centerOffsetY:0,slideCenterOffsetY:0,initialized:!1};let I=null,P=0,R=!1,j=!1,T=0;const E={active:!1,velocity:0,gravity:-180,jumpStrength:75};let L=null;function O(){if(!h||!M.initialized)return null;const e="Slide"===(null==b?void 0:b.currentState),t=e?M.slideHeight:M.standingHeight;let n=e?M.slideCenterOffsetY:M.centerOffsetY;E.active&&(n+=4),e&&(n-=2);const o=new v.Pq0(h.position.x,h.position.y+n,h.position.z),a=.5*t,i={min:new v.Pq0(o.x-M.halfWidth,o.y-a,o.z-M.halfDepth),max:new v.Pq0(o.x+M.halfWidth,o.y+a,o.z+M.halfDepth)};return i}function A(e,t){return!(e.max.x<t.min.x||e.min.x>t.max.x||e.max.y<t.min.y||e.min.y>t.max.y||e.max.z<t.min.z||e.min.z>t.max.z)}function D(t){if(!b)return;const n=b.currentState;if("Fall"===n||"Getup"===n||"Death"===n)return;if(t&&function(t){if(j=!0,T=.25,t&&h){const n=h.position.clone();n.y+=3,function(e,t,n,o={}){var a,i,s,r;const l=null!==(a=o.duration)&&void 0!==a?a:.8,c=null!==(i=o.particleCount)&&void 0!==i?i:120,d=null!==(s=o.color1)&&void 0!==s?s:new v.ov8(.6,.55,.5,.6),u=null!==(r=o.color2)&&void 0!==r?r:new v.ov8(.4,.35,.3,.5),p=new v.okU("dustCloud",c,e);p.particleTexture=new v.gPd("https://raw.githubusercontent.com/BabylonJS/Babylon.js/master/packages/tools/playground/public/textures/cloud.png",e);const f=v.PeD.CreateBox("dustEmitter",{size:.1},e);f.position=t.clone(),f.parent=n,f.isVisible=!1,p.emitter=f,p.color1=d,p.color2=u,p.colorDead=new v.ov8(.3,.28,.25,0),p.minSize=3,p.maxSize=7,p.minLifeTime=.4,p.maxLifeTime=l,p.emitRate=400,p.blendMode=v.okU.BLENDMODE_STANDARD,p.minEmitPower=5,p.maxEmitPower=12,p.updateSpeed=.01,p.createCylinderEmitter(2.5,.5,0),p.direction1=new v.Pq0(-1,-.5,-1),p.direction2=new v.Pq0(1,1.5,1),p.gravity=new v.Pq0(0,-5,0),p.start(),setTimeout(()=>{p.stop()},150),setTimeout(()=>{p.dispose(),f.dispose()},1e3*(l+.5)),console.log("üí® Dust cloud VFX created at",t.toString())}(e,n,t.mesh,{duration:.4,particleCount:60})}console.log("üîô Bounce-back effect triggered!")}(t),k.getState().decrementLives(),k.getState().lives<=0)return console.log("üíÄ GAME OVER - No lives remaining"),E.active=!1,E.velocity=0,P=4,void b.setPlayerState("Death",!0);E.active=!1,E.velocity=0,P=4,b.setPlayerState("Fall",!0);let o=null;t||(R=!0,E.velocity=-50,console.log("üï≥Ô∏è Falling into gap!"),B&&h&&(o=B.position.y-h.position.y,console.log(`üíæ Saved Camera Y Offset: ${o}`)))}const B=new v.VR0("camTarget",e);function _(e){c.forward=!1,c.slide=!1,c.jump=!1,c.leftPressed=!1,c.rightPressed=!1,d=e,e&&b?b.setPlayerState(e,!0):b&&b.setPlayerState("Idle",!0)}function N(e){if(!h||!b)return;if(!b.canStrafe)return;const t=p;p=Math.min(1,Math.max(-1,p+e)),t!==p&&(f=25*p,e>0?b.setPlayerState("Strafe_R"):b.setPlayerState("Strafe_L"))}!function(e,t,n,o,a){v.cng.ImportMesh(null,n,"player.glb",e,(n,i,s,r)=>{var l,c,d,u;if(0===n.length)return void console.error("No meshes loaded from player.glb");const p=new v.VR0("playerRoot",e);n.forEach(e=>{e.parent=p,e.alwaysSelectAsActiveMesh=!0,e.setEnabled(!0),e instanceof v.eaF&&(e.receiveShadows=!0,o.addShadowCaster(e,!0))});const f=null!==(c=null!==(l=n.find(e=>e instanceof v.eaF&&!!e.skeleton))&&void 0!==l?l:n.find(e=>e instanceof v.eaF))&&void 0!==c?c:null,g=null!==(d=null!=f?f:n[0])&&void 0!==d?d:null;p.position=v.Pq0.Zero(),p.scaling=v.Pq0.One(),p.computeWorldMatrix(!0);const m=s[0]||(null==f?void 0:f.skeleton)||null,{min:h,max:b}=p.getHierarchyBoundingVectors(),x=b.y-h.y,y=x>0?16/x:1;p.scaling=new v.Pq0(y,y,y),p.computeWorldMatrix(!0),p.rotate(v._0v.Y,Math.PI,v.$xS.LOCAL),p.computeWorldMatrix(!0);const{min:w,max:S}=p.getHierarchyBoundingVectors(),C=w.add(S).scale(.5);p.position=new v.Pq0(-C.x,.05-w.y,7.5-C.z),p.computeWorldMatrix(!0),g?t.lockedTarget=g:t.setTarget(p.position.clone());const M=null!==(u=r.find(e=>e.targetedAnimations.length>0))&&void 0!==u?u:null;r.forEach(e=>{e!==M&&e.stop()}),a({playerRoot:p,playerSkeleton:m,playerAnimationGroup:M})},void 0,(e,t,n)=>{console.error("Error loading player.glb:",t,n)})}(e,t,n,o,n=>{h=n.playerRoot,x=h.position.y,y=x,t.lockedTarget=B,B.position.copyFrom(h.position),B.position.y-=15;const{min:o,max:i}=n.playerRoot.getHierarchyBoundingVectors(),s=o.subtract(n.playerRoot.position),r=i.subtract(n.playerRoot.position),c=r.x-s.x,d=r.z-s.z,u=r.y-s.y;M.halfWidth=.5*c,M.halfDepth=.5*d,M.standingHeight=u,M.slideHeight=.6*u,M.centerOffsetY=s.y+.5*u,M.slideCenterOffsetY=s.y+.5*M.slideHeight,M.initialized=!0,b=function(e){var t;const{scene:n,playerRoot:o,playerSkeleton:a,animationGroup:i,setScrollSpeed:s}=e;let r="Idle",l=!1,c=!1,d=null,u=null,p=null,f=24;if(i){const e=i.targetedAnimations[0];(null===(t=null==e?void 0:e.animation)||void 0===t?void 0:t.framePerSecond)&&(f=e.animation.framePerSecond)}function g(e,t){if(a){const t=a.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}}function m(){d&&p&&(d.onAnimationEndObservable.remove(p),p=null),i&&u&&(i.onAnimationGroupEndObservable.remove(u),u=null),i&&i.stop(),d&&d.stop(),d=null}return a&&Object.keys(w).forEach(e=>{if(!a.getAnimationRange(e)){const{start:t,end:n}=w[e];a.createAnimationRange(e,t,n)}}),{get currentState(){return r},get canStrafe(){return!(!c||"Jump"!==r&&"Fall"!==r)||!1!==w[r].allowStrafe},setPlayerState:function e(t,o=!1){if(!o&&r===t)return;if(!o&&S.has(r))return;const l=w[t],c=g(t,l);if(!a&&!i)return r=t,void s(l.scroll);m(),s(l.scroll);const h=()=>{"Slide"===t?e("Run",!0):"Fall"===t?e("Getup",!0):"Getup"===t?e("Run",!0):"Run_Idle"===t&&e("Idle",!0)};let v=!1;if(i){const e=f/24,t=c.start*e,n=c.end*e;i.reset(),i.start(l.loop,1.5,t,n,!1),v=!0,l.loop||(u=i.onAnimationGroupEndObservable.addOnce(()=>{u=null,h()}))}else a&&(d=n.beginAnimation(a,c.start,c.end,l.loop,1),d&&(v=!0,l.loop||(p=d.onAnimationEndObservable.addOnce(()=>{p=null,h()}))));r=t},setAllowAirStrafe:e=>{c=e},ensureIdle:function(){if(l)return;const e=g("Idle",w.Idle);if(i){const t=f/24;i.reset(),i.start(!0,1,e.start*t,e.end*t,!0),l=!0}else a&&(d=n.beginAnimation(a,e.start,e.end,!0),d&&(l=!0))},pauseAnimation:function(){i&&i.pause(),d&&d.pause()},resumeAnimation:function(){i&&i.play(),d&&d.restart()},dispose:function(){m()}}}({scene:e,playerRoot:n.playerRoot,playerSkeleton:n.playerSkeleton,animationGroup:n.playerAnimationGroup,setScrollSpeed:a}),V(),m&&G(),null==l||l()});const $=()=>"playing"===k.getState().gameState;function G(){m=!0,g=!0,k.getState().setGameState("playing"),b&&b.setPlayerState("Run",!0)}function V(){b&&b.ensureIdle()}function F(){h&&b&&(h.position.y=y,x=y,p=0,f=0,h.position.x=0,B&&(B.position.copyFrom(h.position),B.position.y-=15,console.log("üì∑ Camera target reset to default position")),L=null,h.metadata={lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z},g=!1,m=!1,C=!1,R=!1,E.active=!1,E.velocity=0,j=!1,T=0,P=0,b.setPlayerState("Idle",!0),a(0),console.log("Player controller reset"))}e.onBeforeRenderObservable.add(()=>{var t,n,o,l,u,p;if(!h||!b)return;if("paused"===k.getState().gameState)return;const m=k.getState();if(m.isMatchTimerActive&&"playing"===m.gameState){const t=e.getEngine().getDeltaTime()/1e3;m.tickMatchTimer(t)}if("gameover"===m.gameState)return void("Death"!==b.currentState&&(console.log("üéÆ Game Over detected - setting player to Death state"),E.active=!1,E.velocity=0,j=!1,T=0,a(0),b.setPlayerState("Death",!0)));!function(){if(!h||!b)return;if(d)return;const e=b.currentState;"Fall"!==e&&"Getup"!==e&&"Death"!==e&&(c.jump&&!E.active?(b.setPlayerState("Jump"),h&&(E.active||(E.active=!0,E.velocity=E.jumpStrength)),c.jump=!1):c.slide&&b.setPlayerState("Slide"))}();const w=e.getEngine().getDeltaTime()/1e3;P=Math.max(0,P-w),j&&(T-=w,T<=0?(j=!1,T=0,a(0),console.log("‚úÖ Bounce-back effect completed")):a(-240)),h.position.x=v.X5X.Lerp(h.position.x,f,.12),function(){var t,n,o,a,s,r;if(!h)return;if("Fall"===(null==b?void 0:b.currentState)||"Getup"===(null==b?void 0:b.currentState))return void(null==I||I.hide());const l=i.getActivePlatformMeshes().length>0,c=h.position.add(new v.Pq0(0,2,0)),u=new v.RlV(c,new v.Pq0(0,-1,0),40);null==I||I.hide();const p=e.pickWithRay(u,e=>{var t,n,o;return!0===(null===(t=e.metadata)||void 0===t?void 0:t.isCollisionMesh)||"platform"===(null===(n=e.metadata)||void 0===n?void 0:n.obstacleType)||!(!e.parent||"platform"!==(null===(o=e.parent.metadata)||void 0===o?void 0:o.obstacleType))});if((null==p?void 0:p.hit)&&p.pickedPoint&&p.pickedMesh){const e=p.pickedMesh.getBoundingInfo(),i=null==e?void 0:e.boundingBox.minimumWorld,l=null==e?void 0:e.boundingBox.maximumWorld,c=1.5,u=!i||!l||h.position.x>=i.x-c&&h.position.x<=l.x+c,f=!i||!l||h.position.z>=i.z-c&&h.position.z<=l.z+c,g=l.y,m=h.position.y,v=m-g,w=v>=-2&&v<=30;if(p){const e=performance.now();if(e-z>300){z=e,console.log("----- PLATFORM LANDING DEBUG -----"),console.log("Picked Mesh:",null===(t=p.pickedMesh)||void 0===t?void 0:t.name),console.log("isCollisionMesh:",null===(o=null===(n=p.pickedMesh)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.isCollisionMesh),console.log("PickedPoint Y:",null===(s=null===(a=p.pickedPoint)||void 0===a?void 0:a.y)||void 0===s?void 0:s.toFixed(3)),console.log("Player Y:",h.position.y.toFixed(3));const i=null===(r=p.pickedMesh)||void 0===r?void 0:r.getBoundingInfo();i&&(console.log("bbMinY:",i.boundingBox.minimumWorld.y.toFixed(3)),console.log("bbMaxY:",i.boundingBox.maximumWorld.y.toFixed(3))),console.log("deltaY:",v),console.log("feetY:",m),console.log("platformTopY:",g),console.log("withinX:",u),console.log("withinZ:",f),console.log("platformBelow:",w),console.log("----------------------------------")}}if(u&&f&&w){const e=l.y,t=Math.max(e,y),n=1.5,o=E.active&&E.velocity<=0,a=h.position.y-t<=n;if(!E.active||o&&a)return x=t,h.position.y=Math.max(h.position.y,x),E.active&&(E.active=!1,E.velocity=0,!d&&b&&b.setPlayerState("Run",!0)),void(C=!0)}}if(!l)return C=!1,void(x=y);C?(x=y,(!E.active||E.velocity<=0)&&(E.active=!0,E.velocity=0),C=!1):x=y}(),function(e){if(h){if(!E.active)return R?(E.velocity+=E.gravity*e,void(h.position.y+=E.velocity*e)):void(h.position.y!==x&&(h.position.y=x));E.velocity+=E.gravity*e,h.position.y+=E.velocity*e,h.position.y<=x&&(h.position.y=x,E.active=!1,E.velocity=0,!d&&b&&b.setPlayerState("Run",!0))}}(w),R&&("Getup"!==b.currentState&&"Run"!==b.currentState&&"Idle"!==b.currentState||(R=!1,h.position.y=x,E.velocity=0,r&&r.fillGapAt(h.position.x,h.position.z),B&&null!==L&&(B.position.y=h.position.y+L,console.log(`üîÑ Respawn: Restored Camera Y Offset: ${L}`),L=null),h.metadata=Object.assign(Object.assign({},h.metadata||{}),{lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z}),console.log("‚ú® Recovered from gap fall & repaired road")));const S=k.getState().gameState;if(B&&"playing"===S){const e=h.position.x-(null!==(n=null===(t=h.metadata)||void 0===t?void 0:t.lastX)&&void 0!==n?n:h.position.x),a=h.position.z-(null!==(l=null===(o=h.metadata)||void 0===o?void 0:o.lastZ)&&void 0!==l?l:h.position.z);let i=0;R||(i=h.position.y-(null!==(p=null===(u=h.metadata)||void 0===u?void 0:u.lastY)&&void 0!==p?p:h.position.y),B.position.y+=i),B.position.x+=e,B.position.z+=a}if(h&&(h.metadata=Object.assign(Object.assign({},h.metadata||{}),{lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z})),!d&&"Fall"!==b.currentState&&"Getup"!==b.currentState&&"Death"!==b.currentState&&$()){const e=function(){var e;if(!h||!b)return null;if(P>0)return null;const t=O();if(!t)return null;const n=i.getActiveObstacles();for(const o of n){if(!o.active)continue;const n=o.mesh;n.computeWorldMatrix(!0);const a=(null===(e=o.collisionMeshes)||void 0===e?void 0:e.length)?o.collisionMeshes:[n];for(const e of a){e.computeWorldMatrix(!0);const n=e.getBoundingInfo();if(!n)continue;const a={min:n.boundingBox.minimumWorld,max:n.boundingBox.maximumWorld};if("platform"===o.type){const e=t.min.y>=a.max.y-1.2;if(C||e)continue}if(A(t,a))return o}}return null}();e&&D(e),r&&!E.active&&r.isOverGap(h.position.x,h.position.z)&&(console.log("‚ö†Ô∏è Player fell into gap!"),D());const t=O();if(t){const e=s.checkCollisions(t);if(e>0){console.log("Collected coins:",e);const t=new CustomEvent("coinCollected",{detail:{count:e}});window.dispatchEvent(t)}}}const M=b.currentState,_=Math.abs(h.position.x-f)<.5;g&&_&&("Strafe_L"===M||"Strafe_R"===M)&&b.setPlayerState("Run")});const Y={startX:0,startY:0,startTime:0,isDragging:!1};return{handleKeyDown:function(e){const t=u[e.code];if(t)return e.preventDefault(),void _(t);if("Digit0"===e.code)return e.preventDefault(),void _(null);if("KeyP"===e.code){const e=k.getState();return void("playing"===e.gameState?(e.setGameState("paused"),b&&b.pauseAnimation()):"paused"===e.gameState&&(e.setGameState("playing"),b&&b.resumeAnimation()))}if("KeyR"===e.code)return console.log("üîÑ RESTARTING GAME..."),k.getState().resetGame(),i.reset(),s.reset(),F(),G(),void k.getState().startMatchTimer();if($())switch(e.code){case"ArrowLeft":case"KeyA":c.leftPressed=!0,N(1);break;case"ArrowRight":case"KeyD":c.rightPressed=!0,N(-1);break;case"ArrowDown":case"KeyS":c.slide=!0;break;case"KeyW":c.jump=!0}},handleKeyUp:function(e){switch(e.code){case"ArrowLeft":case"KeyA":c.leftPressed=!1;break;case"ArrowRight":case"KeyD":c.rightPressed=!1;break;case"ArrowDown":case"KeyS":c.slide=!1;break;case"KeyW":c.jump=!1}},handleTouchStart:function(e){if(!$())return;const t=e.touches[0];t&&(Y.startX=t.clientX,Y.startY=t.clientY,Y.startTime=Date.now(),Y.isDragging=!0)},handleTouchMove:function(e){$()&&Y.isDragging},handleTouchEnd:function(e){if(!$()||!Y.isDragging)return;const t=e.changedTouches[0];if(!t)return;const n=t.clientX-Y.startX,o=t.clientY-Y.startY,a=Date.now()-Y.startTime;Y.isDragging=!1;const i=Math.sqrt(n*n+o*o);if(i<50&&a<200)return c.jump=!0,void setTimeout(()=>c.jump=!1,100);i>=50&&a<500&&(Math.abs(n)>Math.abs(o)?N(n>0?-1:1):o<0?(c.jump=!0,setTimeout(()=>c.jump=!1,100)):(c.slide=!0,setTimeout(()=>c.slide=!1,500)))},handlePointerDown:function(t){if(!$())return;const n=e.getEngine().getRenderingCanvas();if(!n)return;const o=n.getBoundingClientRect(),a=t.clientX-o.left,i=t.clientY-o.top,s=o.width,r=o.height,l=a<.33*s,d=a>.66*s;i<.33*r&&!l&&!d?c.jump=!0:i>.66*r&&!l&&!d?c.slide=!0:l?N(1):d&&N(-1)},handlePointerUp:function(e){c.slide=!1,c.jump=!1},startGame:G,ensureIdle:V,dispose:function(){I&&(I.dispose(),I=null)},reset:F,cameraTarget:B}}const E=new Map,L={ground:{albedoColor:new v.v9j(.12,.12,.14),metallic:0,roughness:.9},building:{metallic:0,roughness:1},coin:{albedoColor:new v.v9j(1,.8,0),emissiveColor:new v.v9j(.4,.3,0),metallic:1,roughness:.3},obstacle:{metallic:0,roughness:.9},obstacleGLB:{metallic:0,roughness:.85},hamburger:{metallic:0,roughness:.7}},O={jump:{albedo:new v.v9j(.8,.2,.2),emissive:new v.v9j(.2,.05,.05)},duck:{albedo:new v.v9j(.2,.6,.9),emissive:new v.v9j(.05,.15,.25)},platform:{albedo:new v.v9j(.35,.8,.4),emissive:new v.v9j(.08,.2,.1)},insuperable:{albedo:new v.v9j(.5,.2,.8),emissive:new v.v9j(.1,.05,.2)}};function A(e,t){const n=`obstaclePBR_${t}`;if(E.has(n))return E.get(n);const o=O[t]||O.jump,a=new v.YOq(n,e);return a.albedoColor=o.albedo,a.emissiveColor=o.emissive,a.metallic=L.obstacle.metallic,a.roughness=L.obstacle.roughness,E.set(n,a),a}function D(e,t,n){var o,a;const i=e.material;if(i){if(i instanceof v.YOq){const t=i.metallicTexture||i.microSurfaceTexture,n=i.bumpTexture,o=i.reflectivityTexture||i.reflectionTexture;return console.log(`[MaterialFactory] ${e.name}: metallicRoughness=${!!t}, normal=${!!n}, reflectance=${!!o}`),void(t||(i.metallic=L.obstacleGLB.metallic,i.roughness=L.obstacleGLB.roughness))}if(i instanceof v.FUi){const n=new v.YOq(`${i.name}_unified`,t);i.diffuseTexture&&(n.albedoTexture=i.diffuseTexture),i.bumpTexture&&(n.bumpTexture=i.bumpTexture),i.emissiveTexture&&(n.emissiveTexture=i.emissiveTexture),i.ambientTexture&&(n.ambientTexture=i.ambientTexture),i.specularTexture&&(n.reflectivityTexture=i.specularTexture),n.albedoColor=null!==(o=i.diffuseColor)&&void 0!==o?o:v.v9j.White(),n.emissiveColor=null!==(a=i.emissiveColor)&&void 0!==a?a:v.v9j.Black(),n.metallic=L.obstacleGLB.metallic,n.roughness=L.obstacleGLB.roughness,e.material=n}}}new v.v9j(.85,.55,.25),new v.v9j(.35,.2,.1),new v.v9j(1,.8,.2),new v.v9j(.3,.7,.2),new v.v9j(.9,.2,.15),new v.v9j(.95,.92,.8);class B{static preloadAll(e,t){return n=this,o=void 0,i=function*(){if(this.loaded)return;const n=[];for(const o in t){const a=o,i=t[a];for(const t of i){const o=v.cng.LoadAssetContainerAsync("",t,e,null,".glb").then(e=>{this.cache[a].push({container:e,sourceUrl:t})}).catch(e=>{console.error(`Failed to load obstacle GLB [${a}]: ${t}`,e)});n.push(o)}}yield Promise.all(n),this.loaded=!0,console.log("Obstacle GLBs preloaded:",this.cache)},new((a=void 0)||(a=Promise))(function(e,t){function s(e){try{l(i.next(e))}catch(e){t(e)}}function r(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a(function(e){e(n)})).then(s,r)}l((i=i.apply(n,o||[])).next())});var n,o,a,i}static getVariantCount(e){const t=this.cache[e];return t?t.length:0}static getMesh(e,t,n){const o=this.cache[e];if(!o||0===o.length)return null;const a=o.length-1,i="number"==typeof n&&n>=0&&n<=a?n:Math.floor(Math.random()*o.length),{container:s,sourceUrl:r}=o[i],l=s.instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];if(!l)return console.warn(`Empty GLB container for ${e}`),null;const c=l;c.metadata=c.metadata||{},c.metadata.sourceUrl=r,c.position.setAll(0),"duck"===e&&c.scaling.setAll(1.5),"insuperable"===e&&(c.rotation.z=0),function(e,t){D(e,t);const n=e.getChildMeshes(!1);for(const e of n)D(e,t)}(c,t);let d=[];const u=c.getChildMeshes(!1).filter(e=>e.name.toLowerCase().includes("customcollision"));if(c.name&&c.name.toLowerCase().includes("customcollision")&&u.unshift(c),u.length>0?(console.log(`[ObstacleGLBBuilder] Found ${u.length} custom collision mesh(es) for ${e}`),d=u,d.forEach(e=>{e.isVisible=!1,e.isPickable=!0,e.metadata=e.metadata||{},e.metadata.isCollisionMesh=!0,e.computeWorldMatrix(!0)})):d=[c],c.computeWorldMatrix(!0),1===d.length&&d[0]===c){const{min:e,max:t}=c.getHierarchyBoundingVectors(),n=new v.jLo(e,t);c.setBoundingInfo(n)}return d.forEach(e=>e.computeWorldMatrix(!0)),{root:c,collisionMeshes:d}}}function _(e,t){const n=e.getTotalVertices();if(0===n)return;const o=[];for(let e=0;e<n;e++)o.push(t[0],t[1],t[2],t[3]);e.setVerticesData(v.Rcs.ColorKind,o)}function N(e,t=.75){const n=new v.eaF("obs_hamburger",e),o=[.95,.7,.3,1],a=[.2,.8,.2,1],i=[1,.2,.2,1],s=[.98,.96,.9,1],r=6*t,l=3*t,c=5.5*t,d=1.5*t;let u=0;const p=v.PeD.CreateCylinder("bottomBun",{diameter:2*r,height:l,tessellation:32},e);_(p,o),u=l/2,p.position.y=u,p.parent=n,u+=l/2;const f=v.PeD.CreateCylinder("patty",{diameter:2*c,height:d,tessellation:32},e);_(f,[.4,.2,.1,1]),u+=d/2,f.position.y=u,f.parent=n,u+=d/2;const g=1.8*r,m=v.PeD.CreateBox("cheese",{width:g,height:.3*t,depth:g},e);_(m,[1,.9,.2,1]),u+=.15*t,m.position.y=u,m.rotation.y=Math.PI/4,m.parent=n,u+=.15*t;const h=1.1*r,b=.8*t;u+=b/2;for(let t=0;t<6;t++){const o=v.PeD.CreateBox(`lettuce_${t}`,{width:.8*h,height:b,depth:.5*h},e);_(o,a),o.position.y=u,o.rotation.y=Math.PI/3*t,o.position.x=Math.cos(Math.PI/3*t)*r*.3,o.position.z=Math.sin(Math.PI/3*t)*r*.3,o.parent=n}u+=b/2;const x=4*t,y=.6*t;u+=y/2;const w=v.PeD.CreateCylinder("tomato1",{diameter:2*x,height:y,tessellation:16},e);_(w,i),w.position.y=u,w.position.x=-1.5*t,w.parent=n;const S=v.PeD.CreateCylinder("tomato2",{diameter:2*x,height:y,tessellation:16},e);_(S,i),S.position.y=u,S.position.x=1.5*t,S.parent=n,u+=y/2;const C=v.PeD.CreateSphere("topBun",{diameter:2*r,slice:.5,segments:16},e);_(C,o),C.position.y=u,C.parent=n,[{x:0,z:-2},{x:1.5,z:-1},{x:-1.5,z:-1},{x:2,z:1},{x:-2,z:1},{x:0,z:2},{x:1,z:.5},{x:-1,z:.5}].forEach((o,a)=>{const i=v.PeD.CreateCapsule(`seed_${a}`,{height:.8*t,radius:.2*t},e);_(i,s);const l=o.x*t,c=o.z*t,d=Math.sqrt(l*l+c*c),p=u+.7*Math.sqrt(Math.max(0,r*r-d*d));i.position.set(l,p,c),i.rotation.x=Math.PI/2,i.rotation.z=Math.random()*Math.PI,i.parent=n}),n.position.y=0;const M=n.getChildMeshes();if(M.length>0){const t=v.eaF.MergeMeshes(M,!0,!1,n,!1,!0);if(t)return t.name="obs_hamburger",t.material=function(e){const t="hamburgerUnifiedPBR";if(E.has(t))return E.get(t);const n=new v.YOq(t,e);return n.metallic=0,n.roughness=.9,E.set(t,n),n}(e),t.useVertexColors=!0,t.metadata={isHamburger:!0},t}return n}B.cache={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]},B.loaded=!1;const $=[[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1},{laneIndex:1}],delayNext:1.6},{obstacles:[{type:"duck",laneIndex:-1}],coins:[{laneIndex:0}],delayNext:1.6},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:-1},{laneIndex:0}],delayNext:1.6},{obstacles:[{type:"duck",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8},{laneIndex:1,count:3,spacing:8}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"insuperable",laneIndex:1}],delayNext:1.2},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"jump",laneIndex:0},{type:"insuperable",laneIndex:1}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"duck",laneIndex:0},{type:"insuperable",laneIndex:1}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"platform",laneIndex:0},{type:"insuperable",laneIndex:1}],coins:[{laneIndex:0,yOffset:15,count:3,spacing:6}],delayNext:2.2},{obstacles:[{type:"insuperable",laneIndex:-1}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:1}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:-1}],delayNext:1.5},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:1.2},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"insuperable",laneIndex:1}],delayNext:2.5},{obstacles:[{type:"jump",laneIndex:1}],delayNext:1.5}],[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:-1}],coins:[{laneIndex:1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:0}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:1}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:-1}],delayNext:2.2},{obstacles:[{type:"platform",laneIndex:0}],coins:[{laneIndex:0,yOffset:15,count:5,spacing:8}],delayNext:3},{obstacles:[{type:"platform",laneIndex:-1},{type:"platform",laneIndex:1}],coins:[{laneIndex:0,count:5,spacing:8}],delayNext:3}],[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8},{laneIndex:1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:-1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:0}],delayNext:2},{obstacles:[{type:"jump",laneIndex:-1},{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:5,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:0}],delayNext:1.8},{obstacles:[{type:"jump",laneIndex:0}],delayNext:1.8},{obstacles:[{type:"jump",laneIndex:-1},{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:4,spacing:8}],delayNext:3}]];const G={cubesWide:7,cubesLong:42,cubeSize:25,extraStartRows:6,get roadWidth(){return this.cubesWide*this.cubeSize},get roadLength(){return this.cubesLong*this.cubeSize},segmentCount:3,fallGravity:2500,fallMaxSpeed:4e3,triggerZoneStart:-80,triggerZoneEnd:-200,fallProbabilityPerSecond:1.33,maxAdjacentGaps:1,cubeColor:new v.v9j(.15,.15,.2),cubeRoughness:.8};function V(e,t,o,a,i,s){const r=function(e,t,n){let o=G.cubesLong,a=G.roadLength,i=null;const s=new v.YOq("cubeMatRed",e);s.albedoColor=new v.v9j(.2,.2,.2),s.roughness=.9,s.metallic=0;const r=new v.YOq("cubeMatBlack",e);r.albedoColor=new v.v9j(.2,.2,.2),r.roughness=.9,r.metallic=0;const l=v.PeD.CreateBox("fallingCubeSourceRed",{size:G.cubeSize},e);l.material=s,l.isVisible=!1,l.receiveShadows=!0;const c=v.PeD.CreateBox("fallingCubeSourceBlack",{size:G.cubeSize},e);c.material=r,c.isVisible=!1,c.receiveShadows=!0;const d=new v.YOq("shadowCatcherMat",e);d.albedoColor=new v.v9j(1,1,1),d.roughness=1,d.metallic=0,d.alpha=.95;const u=v.PeD.CreateGround("shadowCatcher",{width:600,height:2e3},e);u.material=d,u.position.y=-G.cubeSize-50,u.receiveShadows=!0,u.isPickable=!1;const p=e.onBeforeRenderObservable.add(()=>{const t=e.activeCamera;t&&(u.position.x=.3*t.position.x,u.position.z=t.position.z-600)}),f=[],g=new Map;function m(e){return`${e.segmentIndex}_${e.gridX}_${e.gridZ}`}function h(e,t){return e%3==1&&t%3==1}function b(){for(const e of f)e.instance.dispose();f.length=0,g.clear();const e=-G.roadWidth/2+G.cubeSize/2,n=-G.cubeSize/2;let i=0;for(let s=0;s<G.segmentCount;s++){const r=-s*a,d=0===s?-G.extraStartRows:0;for(let a=0;a<G.cubesWide;a++)for(let u=d;u<o;u++){const o=e+a*G.cubeSize,d=r-u*G.cubeSize-G.cubeSize/2,p=u<0,g=((a+u+s)%2==0?l:c).createInstance(`cube_${s}_${a}_${u}`);g.position=new v.Pq0(o,n,d),g.receiveShadows=!0,t.addShadowCaster(g,!0);const m=h(a,u);m&&i++,f.push({instance:g,state:"active",fallVelocity:0,originalY:n,gridX:a,gridZ:u,segmentIndex:s,isCellCenter:m,randomFallOffset:100*Math.random(),isSafePath:p})}}!function(){console.log("üï∏Ô∏è Weaving safe path...");const e=new Map;for(const t of f){const n=`${t.segmentIndex}_${t.gridZ}`;e.has(n)||e.set(n,new Map),e.get(n).set(t.gridX,t)}let t=3;for(let n=0;n<G.segmentCount;n++)for(let a=0;a<o;a++){const o=`${n}_${a}`,i=e.get(o);if(!i)continue;const s=i.get(t);s&&(s.isSafePath=!0);let r=t+(Math.floor(3*Math.random())-1);r<1&&(r=1),r>5&&(r=5),t=r}}(),console.log(`‚úÖ Created falling cube road: ${f.length} cubes, ${i} cell centers that can fall`)}b();let x=k.getState().lives;const y=k.subscribe(e=>{x=e.lives}),w=e.onBeforeRenderObservable.add(()=>{if("playing"!==k.getState().gameState)return;const t=n();if(0===t)return;const o=e.getEngine().getDeltaTime()/1e3,i=t*o,s=G.segmentCount*a;let r=1/0;for(const e of f)e.instance.position.z<r&&(r=e.instance.position.z);for(const e of f){e.instance.position.z+=i;const t=1.5*G.cubeSize,n=4.5*G.cubeSize,a=3,r=t+15*Math.abs(e.gridX-a)+(e.randomFallOffset||0);if(e.instance.position.z>r&&"active"===e.state&&(e.state="falling"),e.instance.position.z>n&&(e.instance.position.z-=s,"active"!==e.state&&(e.state="active",e.fallVelocity=0,e.instance.position.y=e.originalY,e.instance.isVisible=!0,g.delete(m(e)))),"falling"===e.state&&(e.fallVelocity=Math.min(e.fallVelocity+G.fallGravity*o,G.fallMaxSpeed),e.instance.position.y-=e.fallVelocity*o,!(e.instance.position.z>t)&&e.instance.position.y<e.originalY-3*G.cubeSize&&(e.state="fallen",e.instance.isVisible=!1,g.set(m(e),{x:e.instance.position.x,z:e.instance.position.z}))),"active"===e.state){const t=e.instance.position.z;if(t>G.triggerZoneEnd&&t<G.triggerZoneStart){const t=performance.now()/1e3,n=Math.min(5,1+t/20),a=G.fallProbabilityPerSecond*n*o;Math.random()<a&&S(e)&&(e.state="falling",e.fallVelocity=0)}}}});function S(e){if(e.gridX<1||e.gridX>5)return!1;if(e.isSafePath)return!1;if(i&&i(e.instance.position.x,e.instance.position.z,40))return!1;if(e.gridZ%3!=0)return!1;let t=0;for(const n of f)n.gridZ===e.gridZ&&n.segmentIndex===e.segmentIndex&&("falling"!==n.state&&"fallen"!==n.state||t++);return!(t>=2)}return{getGapBoundingBoxes:function(){const e=[],t=G.cubeSize/2;for(const[,n]of g)e.push({min:new v.Pq0(n.x-t,-100,n.z-t),max:new v.Pq0(n.x+t,0,n.z+t)});return e},isOverGap:function(e,t){for(const n of f)if("fallen"===n.state){const o=Math.abs(e-n.instance.position.x),a=Math.abs(t-n.instance.position.z);if(o<8&&a<8)return!0}return!1},reset:function(){for(const e of f)e.state="active",e.fallVelocity=0,e.instance.position.y=e.originalY,e.instance.isVisible=!0;g.clear(),console.log("üîÑ Falling cube road reset")},rebuild:function(e){console.log(`üõ†Ô∏è Rebuilding road with target length: ${e}`),o=Math.round(e/G.cubeSize),a=o*G.cubeSize,console.log(`   -> New dimensions: ${o} cubes long = ${a} units`),b()},fillGapAt:function(e,t){const n=G.cubeSize;for(const o of f)if("fallen"===o.state){const a=Math.abs(e-o.instance.position.x),i=Math.abs(t-o.instance.position.z);if(a<n&&i<n)return console.log("ü©π Repairing road gap under player"),o.state="active",o.fallVelocity=0,o.instance.position.y=o.originalY,o.instance.isVisible=!0,void g.delete(m(o))}},setObstacleChecker:e=>{i=e},dispose:function(){e.onBeforeRenderObservable.remove(w),e.onBeforeRenderObservable.remove(p),y();for(const e of f)e.instance.dispose();f.length=0,l.dispose(),c.dispose(),s.dispose(),r.dispose(),u.dispose(),d.dispose(),g.clear(),console.log("üóëÔ∏è Falling cube road disposed")}}}(e,t,i),l=function(e,t,n,o,a){const i=[],s=[];let r=160,l=0;const c=function(e){const t="groundPBR";if(E.has(t))return E.get(t);const n=new v.YOq(t,e);return n.albedoColor=L.ground.albedoColor,n.metallic=L.ground.metallic,n.roughness=L.ground.roughness,E.set(t,n),n}(e),d={offset:0};function u(e){e.uScale=1,e.vScale=Math.max(1,12),e.wrapU=v.gPd.CLAMP_ADDRESSMODE,e.wrapV=v.gPd.WRAP_ADDRESSMODE}const{packagedTex:p,dynamicTex:f}=function(){const t=`${o}fallback-road-texture.png`,n=new v.gPd(t,e,void 0,!1,v.gPd.TRILINEAR_SAMPLINGMODE),a=new v.RCS("roadDyn",{width:1024,height:1024},e,!1),i=a.getContext();if(i){const e=1024;i.fillStyle="#201f2b",i.fillRect(0,0,e,e),i.fillStyle="#14131d",i.fillRect(0,.08*e,e,.84*e),i.fillStyle="#fcd75a";const t=Math.round(.005*e),n=Math.round(.01*e),o=Math.round(1*n),a=(e-t)/2;for(let s=0;s<e;s+=n+o)i.fillRect(a,s,t,n)}return a.update(!1),n.onLoadObservable.addOnce(()=>{u(n),c.albedoTexture=n}),{packagedTex:n,dynamicTex:a}}();c.albedoTexture=f,u(f);let g=f;function m(t,n){const o=v.PeD.CreateGround(`ground-${t}`,{width:350,height:n},e);return o.material=c,o.receiveShadows=!0,o.position.z=-t*n,o.isVisible=!1,o}function h(e,t){i.forEach(e=>e.dispose()),i.length=0,r=e;for(let n=0;n<t;n++){const t=m(n,e);i.push(t)}d.offset=0,u(g)}h(r,6);const b=Array.from({length:10},(e,t)=>`b${t+1}.glb`),x=new Map;function y(n,o,a,i){const s=new v.VR0(o,e);return s.parent=n,s.rotation=new v.Pq0(0,a,0),i.forEach(e=>{const n=e.createInstance(`${e.name}-${o}`);n.parent=s,function(e,t){const n=x.get(t);n&&(e.position=n.pos.clone(),e.scaling=n.scale.clone(),n.rotQ?(e.rotationQuaternion=n.rotQ.clone(),e.rotation=v.Pq0.Zero()):n.rot&&(e.rotation=n.rot.clone(),e.rotationQuaternion=null))}(n,e),n.receiveShadows=!0,t.addShadowCaster(n,!0)}),s}return Promise.all(b.map(t=>v.cng.ImportMeshAsync(null,n,t,e).then(e=>e.meshes.filter(e=>e instanceof v.eaF)))).then(t=>{const n=t.flat();if(0===n.length)return;n.forEach(t=>{var n,o,a,i;if(t.scaling=t.scaling.scale(8),x.set(t,{pos:t.position.clone(),rot:null!==(o=null===(n=t.rotation)||void 0===n?void 0:n.clone())&&void 0!==o?o:null,rotQ:null!==(i=null===(a=t.rotationQuaternion)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,scale:t.scaling.clone()}),!(t.material instanceof v.YOq)){const n=t.material,o=function(e,t){const n="buildingPBR_"+(t?`${t.r.toFixed(2)}_${t.g.toFixed(2)}_${t.b.toFixed(2)}`:"default");if(E.has(n))return E.get(n);const o=new v.YOq(n,e);return o.albedoColor=null!=t?t:v.v9j.White(),o.metallic=L.building.metallic,o.roughness=L.building.roughness,E.set(n,o),o}(e,null==n?void 0:n.diffuseColor);t.material=o}t.isVisible=!1,t.setEnabled(!1)});const o=new v.VR0("buildSeg-0",e);function i(e,t){e.position=new v.Pq0(0,0,-t*l),s.push(e)}y(o,"B_A0",0,n),y(o,"B_B0",Math.PI,n).position.x=-10,o.getHierarchyBoundingVectors(),l=1050,a&&a(l),h(l,6),i(o,0);for(let t=1;t<6;t++){const o=new v.VR0(`buildSeg-${t}`,e);y(o,`B_A${t}`,0,n),y(o,`B_B${t}`,Math.PI,n),i(o,t)}}).catch(e=>console.error("Buildings load error:",e)),{groundSegments:i,buildingSegments:s,groundSpacing:r,buildingSpacing:l,getRoadOffset:()=>d.offset,setRoadOffset:e=>{d.offset=e%1,d.offset<0&&(d.offset+=1)},updateRoadTextureOffset:()=>{g.vOffset=d.offset},advanceGround:function(e){for(const t of i)t.position.z+=e;let t=1/0;for(const e of i)e.position.z<t&&(t=e.position.z);for(const e of i)e.position.z>r&&(e.position.z=t-r)},advanceBuildings:function(e){for(const t of s)t.position.z+=e;let t=1/0;for(const e of s)e.position.z<t&&(t=e.position.z);for(const e of s)e.position.z>l&&(e.position.z=t-l)},rebuildGround:h,dispose:function(){i.forEach(e=>e.dispose()),s.forEach(e=>e.dispose()),f.dispose(),p.dispose(),g.dispose()}}}(e,t,o,a,e=>{console.log(`üèóÔ∏è World spacing ready: ${e}, rebuilding road...`),r.rebuild(e)}),c=function(e,t,n){let o=null;return o=e.onBeforeRenderObservable.add(()=>{const o=k.getState().gameState,a=n();if("playing"!==o&&!("gameover"===o&&a<0))return;const i=e.getEngine().getDeltaTime()/1e3;if(0===a)return;const s=a*i;t.advanceGround(s),t.advanceBuildings(s);const r=t.getRoadOffset()-s/t.groundSpacing;t.setRoadOffset(r),t.updateRoadTextureOffset()}),{dispose:function(){o&&(e.onBeforeRenderObservable.remove(o),o=null)}}}(e,l,i),d=function(e,t,n,o={}){var a,i,s,r;const l=null!==(a=o.spawnZ)&&void 0!==a?a:-520,c=null!==(i=o.despawnZ)&&void 0!==i?i:200,d=null!==(s=o.laneWidth)&&void 0!==s?s:25,u=null!==(r=o.modelPath)&&void 0!==r?r:"/scene/assets/model/coin/Bitcoin.glb",p=new v.VR0("coins_root",e),f=[],g=[];let m=null,h=!1;const b=[];function x(){var n,o;const a=f.find(e=>!e.active);if(a){a.active=!0,a.mesh.setEnabled(!0);const e=null===(o=(n=a.mesh).getChildMeshes)||void 0===o?void 0:o.call(n,!1);return e&&e.forEach(e=>e.setEnabled(!0)),a}const i=function(){if(!m)return null;const n=m.instantiateModelsToScene(e=>`coin_${f.length}_${e}`,!1);if(0===n.rootNodes.length)return console.error("‚ùå No root nodes in coin container"),null;const o=new v.VR0(`coin_root_${f.length}`,e);o.parent=p;for(const e of n.rootNodes)e.parent=o;o.scaling=new v.Pq0(1,1,1);const a=o.getChildMeshes(!1);for(const e of a)if(t.addShadowCaster(e,!0),e.receiveShadows=!0,e.material&&e.material instanceof v.YOq){const t=e.material;t.metallic=.9,t.roughness=.2}return console.log(`ü™ô Created coin with ${a.length} meshes`),o}();if(!i)return null;const s={mesh:i,active:!0,rotationSpeed:3};return f.push(s),s}function y(e,t,n=1,o=10){const a=e*d;for(let e=0;e<n;e++){const n=x();if(!n)continue;const i=e*o;n.mesh.position.set(a,5+t,l+i),g.push(n)}}function w(e,t){if(0===t)return;const n=t*e;for(let t=g.length-1;t>=0;t--){const o=g[t];o.mesh.position.z+=n,o.mesh.rotation.y+=o.rotationSpeed*e,o.mesh.position.z>c&&(o.active=!1,o.mesh.setEnabled(!1),g.splice(t,1))}}v.cng.LoadAssetContainerAsync(u,"",e).then(e=>{console.log("ü™ô Bitcoin GLB loaded successfully"),console.log(`   Meshes: ${e.meshes.length}`),m=e,h=!0;for(const e of b)y(e.laneIndex,e.yOffset,e.count,e.spacing);b.length=0}).catch(e=>{console.error("‚ùå Failed to load Bitcoin GLB:",e),h=!0});const S=e.onBeforeRenderObservable.add(()=>{const t=k.getState().gameState,o=n();("playing"===t||"gameover"===t&&o<0)&&w(e.getEngine().getDeltaTime()/1e3,o)});return{spawnCoin:function(e,t,n=1,o=10){h&&m?y(e,t,n,o):b.push({laneIndex:e,yOffset:t,count:n,spacing:o})},update:w,checkCollisions:function(e){let t=0;const n=2.5;for(let o=g.length-1;o>=0;o--){const a=g[o],i=a.mesh.position,s=i.x-n,r=i.x+n,l=i.y-n,c=i.y+n,d=i.z-n,u=i.z+n;!(e.max.x<s||e.min.x>r||e.max.y<l||e.min.y>c||e.max.z<d||e.min.z>u)&&(a.active=!1,a.mesh.setEnabled(!1),g.splice(o,1),t++)}return t},dispose:function(){S&&e.onBeforeRenderObservable.remove(S),f.forEach(e=>e.mesh.dispose()),p.dispose()},reset:function(){for(const e of g)e.active=!1,e.mesh.setEnabled(!1);g.length=0,console.log("Coin system reset")},isReady:()=>h}}(e,t,i),u=function(e,t,n){const o=new v.VR0("roadside_cars_root",e),a=[],i=[],s=[];let r=!1;const l=["red_car.glb","green_car.glb","flame_car.glb","white_car.glb"].map(t=>{const n=`scene/assets/model/roadside/${t}`;return v.cng.LoadAssetContainerAsync("",n,e,null,".glb").then(e=>{a.push(e),console.log(`‚úÖ Loaded roadside car: ${t}`)}).catch(e=>{console.warn(`Failed to load car ${t}:`,e)})});function c(){let e=-800;for(;e<0;)d(e),e+=150+200*Math.random()}function d(e){let n=s.find(e=>!e.active);if(!n){const e=function(){if(0===a.length)return null;const e=a[Math.floor(Math.random()*a.length)].instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];return e?(e.parent=o,t.addShadowCaster(e,!0),e.getChildMeshes().forEach(e=>{e.receiveShadows=!0}),e):null}();if(!e)return;n={mesh:e,active:!1},s.push(n)}const r=Math.random()<.5?-120:120,l=-120===r?0:Math.PI;n.mesh.position.set(r,-5,e),n.mesh.rotation=new v.Pq0(0,l,0),n.mesh.setEnabled(!0),n.active=!0,i.push(n)}function u(e){const t=k.getState().gameState,o=n();if("playing"!==t&&!("gameover"===t&&o<0))return;if(0===o)return;const a=o*e;for(const e of i)e.mesh.position.z+=a;for(let e=i.length-1;e>=0;e--){const t=i[e];t.mesh.position.z>150&&(t.active=!1,t.mesh.setEnabled(!1),i.splice(e,1))}if(o>0&&r){let e=0;for(const t of i)t.mesh.position.z<e&&(e=t.mesh.position.z);e>-650&&d(e-(150+200*Math.random()))}}Promise.all(l).then(()=>{r=a.length>0,r&&(console.log(`‚úÖ Roadside cars ready (${a.length} variants)`),c())});const p=e.onBeforeRenderObservable.add(()=>{u(e.getEngine().getDeltaTime()/1e3)});return{update:u,dispose:()=>{e.onBeforeRenderObservable.remove(p),s.forEach(e=>e.mesh.dispose()),a.forEach(e=>e.dispose()),o.dispose()},reset:function(){for(const e of i)e.active=!1,e.mesh.setEnabled(!1);i.length=0,r&&c()}}}(e,t,i),p=function(e,t,o,a,i={},s){var r,l,c;const d=null!==(r=i.laneWidth)&&void 0!==r?r:25,u=(i.laneCount,null!==(l=i.spawnZ)&&void 0!==l?l:-400),p=null!==(c=i.despawnZ)&&void 0!==c?c:200,f=(i.minSpawnDelay,i.maxSpawnDelay,{jump:A(e,"jump"),duck:A(e,"duck"),platform:A(e,"platform"),insuperable:A(e,"insuperable"),hamburger:A(e,"jump")}),g=function(){const e={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]};try{const t=n(44503);t.keys().forEach(n=>{const o=n.replace(/^\.\//,"").split("/");if(o.length>=2){const a=o[0];if(a in e){const o=t(n);e[a].push(o)}}}),console.log("Obstacle Model Scan Results:",e)}catch(e){console.warn("Failed to scan obstacle folders (require.context might not be available):",e)}return e}();let m=!1;B.preloadAll(e,g).then(()=>{m=!0,console.log("‚úÖ Obstacle GLBs ready"),s&&s()});const h=new v.VR0("obstacles_root",e),b={jump:()=>function(e,t){const n=v.PeD.CreateBox("obs_jump",{width:12,height:12,depth:14},e);return n.material=t,n.position.y=6,n}(e,f.jump),duck:()=>function(e,t){const n=v.PeD.CreateBox("obs_duck",{width:18,height:6,depth:10},e);return n.material=t,n.position.y=12,n}(e,f.duck),platform:()=>function(e,t){const n=v.PeD.CreateBox("obs_platform",{width:18,height:15,depth:90},e);return n.material=t,n.position.y=7.5,n}(e,f.platform),insuperable:()=>function(e){const t=N(e,1.5);return t.name="obs_insuperable",t}(e),hamburger:()=>N(e,1)},x=[],y=[];function w(n){let o=!1;"hamburger"!==n&&("jump"===n||"insuperable"===n)&&(o=Math.random()<0);const a=B.getVariantCount(n),i=a>0?Math.floor(Math.random()*a):void 0,s=x.find(e=>e.type===n&&!e.active&&!!e.isHamburgerVariant===o&&(void 0===i||e.variant===i||void 0===e.variant));if(s)return s.active=!0,s.mesh.setEnabled(!0),s;let r=null,l=null,c=i,d=!1;if(o)r=N(e,"insuperable"===n?2:1),l=[r],c=void 0,d=!0;else{const t=void 0!==i?B.getMesh(n,e,i):B.getMesh(n,e);t?(r=t.root,l=t.collisionMeshes):(r=b[n](),l=[r],c=void 0),d=!1}r.parent=h,r.receiveShadows=!0,r.metadata={obstacleType:n,variant:c,isHamburgerVariant:d},t.addShadowCaster(r,!0);const u={mesh:r,collisionMeshes:null!=l?l:[r],type:n,variant:c,isHamburgerVariant:d,active:!0};return x.push(u),u}let S=1,C=$[0],M=0,I=1;const P=e.onBeforeRenderObservable.add(()=>{var t,n;const i=k.getState().gameState,s=o();if("playing"!==i&&!("gameover"===i&&s<0))return;const r=e.getEngine().getDeltaTime()/1e3;if(0===s)return;const l=s*r;for(const e of y)if(e.mesh.position.z+=l,"insuperable"===e.type){const o=(null===(t=e.mesh.metadata)||void 0===t?void 0:t.sourceUrl)||"",a=o.toLowerCase().includes("soda");if((null===(n=e.mesh.metadata)||void 0===n?void 0:n._debugLogged)||(console.log(`[DEBUG] Insuperable mesh: ${e.mesh.name}, sourceUrl: ${o}, isSoda: ${a}`),e.mesh.metadata=e.mesh.metadata||{},e.mesh.metadata._debugLogged=!0),a){const t=1.5*r;e.mesh.rotate(v._0v.Y,t,v.$xS.LOCAL)}}for(let e=y.length-1;e>=0;e--){const t=y[e];t.mesh.position.z>p&&(t.active=!1,t.mesh.setEnabled(!1),y.splice(e,1))}s>0&&(S+=r,S>=I&&(S=0,function(){var e;if(M>=C.length){const e=Math.floor(Math.random()*$.length);C=$[e],M=0,console.log("Switched to pattern index:",e)}const t=C[M];for(const n of t.obstacles){const t=w(n.type),o=n.laneIndex*d,a=((null===(e=t.mesh.metadata)||void 0===e?void 0:e.sourceUrl)||"").toLowerCase().includes("car"),i=a&&"platform"===t.type?-3:0;if(t.mesh.position.set(o,t.mesh.position.y+i,u),!a||"insuperable"!==t.type&&"platform"!==t.type)t.mesh.rotation.y=0;else{const e=n.laneIndex>=0;t.mesh.rotation.y=e?Math.PI:0}y.push(t)}if(t.coins)for(const e of t.coins)a.spawnCoin(e.laneIndex,e.yOffset||0,e.count,e.spacing);const n=performance.now()/1e3,o=Math.max(.4,1-n/300);I=t.delayNext*o,M++}()))});return{dispose:function(){P&&e.onBeforeRenderObservable.remove(P),x.forEach(e=>e.mesh.dispose()),h.dispose()},getActiveObstacles:function(){return y},getActivePlatformMeshes:function(){return y.filter(e=>"platform"===e.type).map(e=>e.mesh)},reset:function(){for(const e of y)e.active=!1,e.mesh.setEnabled(!1);y.length=0,S=0,M=0,I=2;const e=Math.floor(Math.random()*$.length);C=$[e],console.log("Obstacle system reset")},isReady:function(){return m},hasObstacleAt:function(e,t,n){for(const o of y){if(!o.active)continue;const a=e-o.mesh.position.x,i=t-o.mesh.position.z;if(a*a+i*i<n*n)return!0}return!1}}}(e,t,i,d,{laneWidth:25,laneCount:3},s);return r.setObstacleChecker((e,t,n)=>p.hasObstacleAt(e,t,n)),{dispose:function(){p.dispose(),d.dispose(),u.dispose(),r.dispose(),c.dispose(),l.dispose()},obstacleController:p,coinController:d,fallingCubeRoadController:r}}v.gSV&&(v.gSV.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});var F=n(74848),Y=n(5338);const q=()=>{const e=k(e=>e.isLoading),t=k(e=>e.dismissIntroScreen);return(0,F.jsx)("div",{className:"loading-screen",children:(0,F.jsxs)("div",{className:"intro-image-container",children:[(0,F.jsx)("img",{src:"/intro-screen.png",alt:"Game Instructions",className:"intro-image"}),(0,F.jsx)("div",{className:"loading-indicator",children:e?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"loading-spinner"}),(0,F.jsx)("div",{className:"loading-text",children:"Loading..."})]}):(0,F.jsx)("button",{className:"start-button",onClick:()=>{t(),window.dispatchEvent(new KeyboardEvent("keydown",{code:"Space",key:" "}))},children:"TAP TO START"})})]})})},U=()=>{const e=k(e=>e.countdownValue);if(null===e)return null;const t=0===e?"GO!":e.toString(),n=0===e;return(0,F.jsx)("div",{className:"countdown-overlay",children:(0,F.jsx)("div",{className:"countdown-number "+(n?"countdown-go":""),children:t},e)})},W=()=>{const e=k(e=>e.showIntroScreen),t=k(e=>e.coinCount),n=k(e=>e.lives),o=k(e=>e.gameState),a=k(e=>e.activePowerUps),i=k(e=>e.matchTimeRemaining),s=k(e=>e.isMatchTimerActive);return e?(0,F.jsx)(q,{}):(0,F.jsxs)("div",{className:"game-overlay-container",children:[(0,F.jsx)(U,{}),(0,F.jsxs)("div",{className:"top-hud",children:[(0,F.jsxs)("div",{className:"lives-container",children:[(0,F.jsx)("span",{className:"lives-label",children:"Lives:"}),(0,F.jsxs)("div",{className:"hearts-container",children:[Array.from({length:Math.max(0,n)}).map((e,t)=>(0,F.jsx)("span",{className:"heart",children:"‚ù§Ô∏è"},t)),Array.from({length:Math.max(0,3-n)}).map((e,t)=>(0,F.jsx)("span",{className:"empty-heart",children:"üñ§"},`empty-${t}`))]})]}),(0,F.jsxs)("div",{className:"coin-counter",children:[(0,F.jsx)("span",{className:"coin-icon",children:"üü°"}),(0,F.jsx)("span",{className:"coin-count",children:t})]})]}),s&&(0,F.jsxs)("div",{className:"match-timer "+(i<=10?"timer-warning":""),children:["‚è±Ô∏è ",(r=i,`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`)]}),a.length>0&&(0,F.jsx)("div",{className:"powerups-container",children:a.map(e=>(0,F.jsxs)("div",{className:"powerup-icon",children:["‚ö° ",e.type]},e.type))}),"gameover"===o&&(0,F.jsxs)("div",{className:"gameover-overlay",children:[(0,F.jsx)("div",{className:"gameover-text",children:i<=0?"TIME'S UP!":"GAME OVER"}),(0,F.jsx)("div",{className:"gameover-subtext",children:"Press R to restart"}),(0,F.jsx)("button",{className:"reset-button",onClick:()=>{window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR",key:"r"}))},style:{marginTop:"20px",padding:"8px 16px",fontSize:"14px",backgroundColor:"rgba(255, 50, 50, 0.9)",color:"white",border:"2px solid rgba(255, 255, 255, 0.5)",borderRadius:"8px",cursor:"pointer",pointerEvents:"auto",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},children:"üîÑ Restart"})]}),"victory"===o&&(0,F.jsxs)("div",{className:"victory-overlay",children:[(0,F.jsx)("div",{className:"victory-text",children:"üéâ VICTORY! üéâ"}),(0,F.jsxs)("div",{className:"victory-subtext",children:["You survived with ",t," coins!"]}),(0,F.jsx)("button",{className:"reset-button victory-button",onClick:()=>{window.dispatchEvent(new KeyboardEvent("keydown",{code:"KeyR",key:"r"}))},style:{marginTop:"20px",padding:"12px 24px",fontSize:"16px",backgroundColor:"rgba(50, 200, 50, 0.9)",color:"white",border:"3px solid rgba(255, 215, 0, 0.8)",borderRadius:"12px",cursor:"pointer",pointerEvents:"auto",textShadow:"2px 2px 4px rgba(0,0,0,0.5)",boxShadow:"0 6px 12px rgba(0,0,0,0.4), 0 0 20px rgba(255, 215, 0, 0.3)"},children:"üèÜ Play Again"})]})]});var r};window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("game-canvas");e?(function(){const e=document.getElementById("game-canvas");if(!(e&&e instanceof HTMLCanvasElement))return void console.error("‚ùå Canvas not found - cannot initialize React overlay");const t=document.createElement("div");t.id="react-overlay";const n=()=>{const n=e.getBoundingClientRect();t.style.top=`${n.top}px`,t.style.left=`${n.left}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`};n(),document.body.appendChild(t),new ResizeObserver(()=>{n()}).observe(e),window.addEventListener("resize",n),(0,Y.H)(t).render((0,F.jsx)(C.StrictMode,{children:(0,F.jsx)(W,{})})),console.log("‚úÖ React overlay initialized and synced with canvas")}(),function(e){if(!e)return;let t=null;const o=()=>{if(!t)return;const n=Math.max(1,e.height/1080);t.setHardwareScalingLevel(Math.min(2.5,n))},a=()=>{const n=9/16,a=window.innerWidth;let i=window.innerHeight,s=i*n;s>a&&(s=a,i=s/n),e.width=s,e.height=i,e.style.width=`${s}px`,e.style.height=`${i}px`,null==t||t.resize(),o()};a(),e.addEventListener("contextmenu",e=>{e.preventDefault()});const{engine:i,scene:s}=function(e){const t=new v.N$8(e,!0);v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.NoneLogLevel;const n=new v.Z58(t);return n.environmentTexture=v.b4q.CreateFromPrefilteredData("https://assets.babylonjs.com/environments/environmentSpecular.env",n),n.environmentIntensity=.4,n.clearColor=new v.ov8(1,1,1,1),{engine:t,scene:n}}(e);t=i,o();const{shadowGenerator:r}=function(e){const t=new v.g4z("hemilight",new v.Pq0(0,1,0),e);t.intensity=.2;const n=new v.ZyN("dirLight",new v.Pq0(-.5,-1,.5),e);n.position=new v.Pq0(20,40,-30),n.intensity=2;const o=new v.owA(2048,n);return o.usePercentageCloserFiltering=!0,o.filteringQuality=v.owA.QUALITY_MEDIUM,o.bias=.001,o.normalBias=.02,n.shadowMinZ=1,n.shadowMaxZ=200,{hemisphericLight:t,directionalLight:n,shadowGenerator:o,setDirectionalLightIntensity:e=>{n.intensity=e}}}(s),{camera:l}=function(e,t){const n=localStorage.getItem("camera_alpha"),o=localStorage.getItem("camera_beta"),a=localStorage.getItem("camera_radius"),i=n?parseFloat(n):Math.PI/2,s=o?parseFloat(o):Math.PI/2.5,r=a?parseFloat(a):200,l=new v.Lqh("camera",i,s,r,new v.Pq0(0,8,0),e);l.fov=1.5,l.attachControl(t,!0);const c=l.inputs.attached.mouse;return c&&(c.useCtrlForPanning=!1,c.buttons=[0,1,2],c.panningMouseButton=2),l.inputs.removeByType("ArcRotateCameraKeyboardMoveInput"),l.keysUp=[],l.keysDown=[],l.keysLeft=[],l.keysRight=[],l.lowerRadiusLimit=20,l.upperRadiusLimit=200,l.panningSensibility=50,l.panningAxis=new v.Pq0(1,1,0),{camera:l}}(s,e),{assetBase:c,modelRoot:d,textureRoot:u}=function(){const e="undefined"!=typeof window?window.location.hostname:"",t=e.endsWith("github.io")||e.endsWith("vercel.app")||e.endsWith(".vercel.app")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/":"scene/assets/";return{assetBase:t,modelRoot:`${t}model/`,textureRoot:`${t}road/`}}(),{skyDome:p}=function(e,t){const n=v.PeD.CreateSphere("skyDome",{diameter:5e3,segments:32,sideOrientation:v.eaF.BACKSIDE},e),o=new v.FUi("skyMat",e),a=new v.gPd(`${t}sky_clouds.jpg`,e,!1,!1,v.gPd.TRILINEAR_SAMPLINGMODE);return a.uScale=8,a.vScale=4,o.diffuseTexture=a,o.emissiveTexture=a,o.emissiveColor=new v.v9j(.5,.5,.5),o.specularColor=new v.v9j(0,0,0),o.backFaceCulling=!1,o.disableLighting=!0,n.material=o,n.isPickable=!1,n.infiniteDistance=!0,n.position=v.Pq0.Zero(),{skyDome:n,skyMaterial:o,cloudTexture:a}}(s,c);p.isVisible=!1,n.e(47).then(n.bind(n,44047)).then(({createCelebrationVFX:e})=>{let t=null;k.subscribe(n=>{if("victory"!==n.gameState||t)"victory"!==n.gameState&&t&&(t(),t=null);else{const{dispose:n}=e(s,l,{duration:10,fireworkCount:8});t=n,console.log("üéÜ Victory celebration triggered!")}})});let f=0,g=!1,m=!1;function h(){if(g&&m){console.log("‚úÖ All assets loaded - hiding loading screen"),k.getState().setLoading(!1);const e=[3,2,1,0];let t=0;const n=()=>{k.getState().setCountdown(e[t]),t++,t<e.length?setTimeout(n,1e3):setTimeout(()=>{k.getState().setCountdown(null),console.log("üèÉ Starting game after countdown"),y.startGame(),k.getState().startMatchTimer(),console.log("‚è±Ô∏è Match timer started (2 minutes)")},500)};n()}}const b=V(s,r,d,u,()=>f,()=>{m=!0,console.log("‚úÖ Obstacles ready"),h()}),x=function(){let e=0;function t(t){e=t,k.getState().updateCoinCount(e)}const n=n=>{const o=n.detail.count;t(e+o)};return window.addEventListener("coinCollected",n),{updateCoinCount:t,dispose:function(){window.removeEventListener("coinCollected",n)}}}(),y=T(s,l,d,r,e=>f=e,b.obstacleController,b.coinController,b.fallingCubeRoadController,()=>{g=!0,console.log("‚úÖ Player ready"),h()});t.runRenderLoop(()=>{y.ensureIdle(),s.render()});const w=()=>a(),S=e=>y.handleKeyDown(e),C=e=>y.handleKeyUp(e),M=e=>y.handleTouchStart(e),I=e=>y.handleTouchMove(e),P=e=>y.handleTouchEnd(e),R=e=>y.handlePointerDown(e),j=e=>y.handlePointerUp(e);window.addEventListener("resize",w);const z={};window.addEventListener("keydown",e=>{z[e.key]=!0,S(e),!e.shiftKey||"c"!==e.key&&"C"!==e.key||(console.log("üì∏ CAMERA CAPTURE (Saving to LocalStorage)..."),localStorage.setItem("camera_alpha",l.alpha.toString()),localStorage.setItem("camera_beta",l.beta.toString()),localStorage.setItem("camera_radius",l.radius.toString()),y&&y.cameraTarget?alert("‚úÖ Camera Angle & Zoom Saved to LocalStorage!\nRefresh to see it applied."):alert("‚úÖ Camera Angle & Zoom Saved to LocalStorage!"),console.log(`Saved: Alpha=${l.alpha}, Beta=${l.beta}, Radius=${l.radius}`))}),window.addEventListener("keyup",e=>{z[e.key]=!1,C(e)}),window.addEventListener("touchstart",M,{passive:!0}),window.addEventListener("touchmove",I,{passive:!0}),window.addEventListener("touchend",P,{passive:!0}),window.addEventListener("pointerdown",R),window.addEventListener("pointerup",j);let E=!1,L=null,O="idle",A=null;s.onBeforeRenderObservable.add(()=>{const t=k.getState().gameState;if("playing"===t)return void(E||(l.detachControl(),A&&"paused"===O?(l.alpha=A.alpha,l.beta=A.beta,l.radius=A.radius,l.target.copyFrom(A.targetPosition),console.log("üì∑ Camera state restored (unpause)")):console.log("üì∑ Fresh start - using current camera position"),A=null,L&&(l.lockedTarget=L,L=null),E=!0,console.log("üîí Camera Locked (Playing)")));if(E&&(A={alpha:l.alpha,beta:l.beta,radius:l.radius,targetPosition:l.target.clone()},console.log("üíæ Camera state saved"),l.lockedTarget&&(L=l.lockedTarget,l.lockedTarget=null),l.attachControl(e,!0),E=!1,console.log("üîì Camera Unlocked (Not Playing) - Free orbit enabled")),O=t,"gameover"===t)return;const n=2.5,o=(l.getDirection(v.Pq0.Forward()),l.getDirection(v.Pq0.Right())),a=l.getDirection(v.Pq0.Up());z.ArrowLeft&&l.target.subtractInPlace(o.scale(n)),z.ArrowRight&&l.target.addInPlace(o.scale(n)),z.ArrowUp&&l.target.addInPlace(a.scale(n)),z.ArrowDown&&l.target.subtractInPlace(a.scale(n))}),window.addEventListener("beforeunload",()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",S),window.removeEventListener("keyup",C),window.removeEventListener("touchstart",M),window.removeEventListener("touchmove",I),window.removeEventListener("touchend",P),window.removeEventListener("pointerdown",R),window.removeEventListener("pointerup",j),b.dispose(),y.dispose(),x.dispose(),v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.AllLogLevel,null==t||t.dispose()})}(e)):console.error("‚ùå Errore: Canvas #game-canvas non trovato.")})},65115(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/insuperable/Fries_new.glb"},71034(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/platform/red_car.glb"},74568(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/platform/white_car.glb"},76314(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},77659(e){"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},82218(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/jump/Burger.glb"},82638(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/platform/flame_car.glb"},85072(e){"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},s=[],r=0;r<e.length;r++){var l=e[r],c=o.base?l[0]+o.base:l[0],d=i[c]||0,u="".concat(c," ").concat(d);i[c]=d+1;var p=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var g=a(f,o);o.byIndex=r,t.splice(r,0,{identifier:u,updater:g,references:1})}s.push(u)}return s}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=o(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var r=n(i[s]);t[r].references--}for(var l=o(e,a),c=0;c<i.length;c++){var d=n(i[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},97825(e){"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},e=>{e.O(0,[645,967],()=>e(e.s=55464)),e.O()}]);