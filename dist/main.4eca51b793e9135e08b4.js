(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[792],{4417(e){"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},10540(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},11249(e,t,n){"use strict";n.d(t,{A:()=>p});var o=n(31601),a=n.n(o),i=n(76314),s=n.n(i),r=n(4417),l=n.n(r),c=new URL(n(62251),n.b),d=s()(a()),u=l()(c);d.push([e.id,`body {\n  margin: 0;\n  padding: 0;\n  background: black;\n  overflow: hidden;\n}\n\n#game-canvas {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: block;\n}\n\n/* ============================================ */\n/* React Overlay Styles */\n/* ============================================ */\n\n#react-overlay {\n  position: fixed;\n  pointer-events: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Game Overlay Container */\n/* ============================================ */\n\n.game-overlay-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  user-select: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Top HUD */\n/* ============================================ */\n\n.top-hud {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  justify-content: space-between;\n  padding: 20px;\n}\n\n/* ============================================ */\n/* Lives Display (Top Left) */\n/* ============================================ */\n\n.lives-container {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.lives-label {\n  color: white;\n  font-family: sans-serif;\n  font-size: 20px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n.hearts-container {\n  display: flex;\n  gap: 5px;\n}\n\n.heart {\n  font-size: 24px;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n.empty-heart {\n  font-size: 24px;\n  opacity: 0.3;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n/* ============================================ */\n/* Coin Counter (Top Right) */\n/* ============================================ */\n\n.coin-counter {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.coin-icon {\n  font-size: 24px;\n}\n\n.coin-count {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Power-ups Display (Top Center) */\n/* ============================================ */\n\n.powerups-container {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 10px;\n}\n\n.powerup-icon {\n  padding: 8px 16px;\n  background-color: rgba(255, 215, 0, 0.2);\n  border: 2px solid gold;\n  border-radius: 8px;\n  color: white;\n  font-family: sans-serif;\n  font-size: 16px;\n  font-weight: bold;\n  text-shadow: 1px 1px 0 #000;\n}\n\n/* ============================================ */\n/* Game Over Screen */\n/* ============================================ */\n\n.gameover-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  pointer-events: auto;\n}\n\n.gameover-text {\n  color: #ff4444;\n  font-family: sans-serif;\n  font-size: 64px;\n  font-weight: bold;\n  text-shadow: 4px 4px 0 #000;\n  margin-bottom: 20px;\n}\n\n.gameover-subtext {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Victory Screen */\n/* ============================================ */\n\n.victory-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  pointer-events: auto;\n  animation: victory-pulse 0.5s ease-out;\n}\n\n@keyframes victory-pulse {\n  0% {\n    transform: translate(-50%, -50%) scale(0.5);\n    opacity: 0;\n  }\n\n  50% {\n    transform: translate(-50%, -50%) scale(1.1);\n  }\n\n  100% {\n    transform: translate(-50%, -50%) scale(1);\n    opacity: 1;\n  }\n}\n\n.victory-text {\n  font-family: 'Inter', sans-serif;\n  font-size: 72px;\n  font-weight: 900;\n  background: linear-gradient(180deg, #ffd700 0%, #ff8c00 50%, #ffd700 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 30px rgba(255, 215, 0, 0.5));\n  margin-bottom: 20px;\n  animation: victory-glow 1s ease-in-out infinite alternate;\n}\n\n@keyframes victory-glow {\n  0% {\n    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 215, 0, 0.4));\n  }\n\n  100% {\n    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.8));\n  }\n}\n\n.victory-subtext {\n  color: white;\n  font-family: 'Inter', sans-serif;\n  font-size: 28px;\n  font-weight: 600;\n  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n}\n\n/* ============================================ */\n/* Loading Screen */\n/* ============================================ */\n\n.loading-screen {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(180deg, #0f172a 0%, #059669 100%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n}\n\n.intro-image-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.intro-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  object-position: center;\n}\n\n.loading-indicator {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  background: transparent;\n  padding: 16px 32px;\n  border-radius: 12px;\n}\n\n.loading-content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 24px;\n}\n\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 255, 255, 0.2);\n  border-top: 3px solid #ffd700;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n.loading-text {\n  color: white;\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 18px;\n  font-weight: 600;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);\n  animation: pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes pulse {\n\n  0%,\n  100% {\n    opacity: 1;\n  }\n\n  50% {\n    opacity: 0.5;\n  }\n}\n\n/* Start Play Button */\n.start-button {\n  width: 200px;\n  height: 60px;\n  margin-top: 40px;\n  background: linear-gradient(90deg, #10b981 0%, #34d399 100%);\n  border: 4px solid #ffffff;\n  border-radius: 30px;\n  color: white;\n  font-family: 'Inter', sans-serif;\n  font-size: 24px;\n  font-weight: 800;\n  text-transform: uppercase;\n  letter-spacing: 2px;\n  cursor: pointer;\n  pointer-events: auto;\n  outline: none;\n  z-index: 2001;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);\n  transition: transform 0.2s, box-shadow 0.2s;\n}\n\n.start-button:hover {\n  transform: scale(1.05);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);\n}\n\n.start-button:active {\n  transform: scale(0.95);\n  background: linear-gradient(90deg, #059669 0%, #10b981 100%);\n}\n\n/* ============================================ */\n/* Countdown Overlay */\n/* ============================================ */\n\n.countdown-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  pointer-events: none;\n}\n\n.countdown-number {\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 150px;\n  font-weight: 900;\n  color: #ffa500;\n  background: linear-gradient(180deg, #ffdd00 0%, #ff8c00 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 165, 0, 0.5));\n  animation: countdown-zoom 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;\n}\n\n.countdown-go {\n  color: #4ade80;\n  text-shadow:\n    0 0 20px rgba(74, 222, 128, 0.5),\n    0 0 40px rgba(74, 222, 128, 0.3),\n    0 4px 8px rgba(0, 0, 0, 0.5);\n}\n\n@keyframes countdown-zoom {\n  0% {\n    transform: scale(0.3);\n    opacity: 0;\n  }\n\n  20% {\n    opacity: 1;\n  }\n\n  70% {\n    transform: scale(1.1);\n    opacity: 1;\n  }\n\n  100% {\n    transform: scale(1.0);\n    opacity: 0;\n  }\n}\n\n/* ============================================ */\n/* Match Timer */\n/* ============================================ */\n\n.match-timer {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 2rem;\n  font-weight: bold;\n  color: #fff;\n  text-shadow:\n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 10px rgba(255, 255, 255, 0.3);\n  pointer-events: none;\n  z-index: 100;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 8px;\n}\n\n.match-timer.timer-warning {\n  color: #ff4444;\n  animation: pulse-warning 0.5s ease-in-out infinite;\n  text-shadow:\n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 15px rgba(255, 68, 68, 0.6);\n}\n\n@keyframes pulse-warning {\n\n  0%,\n  100% {\n    transform: translateX(-50%) scale(1);\n  }\n\n  50% {\n    transform: translateX(-50%) scale(1.1);\n  }\n}\n\n/* ============================================ */\n/* Outro Screen (Static Victory) */\n/* ============================================ */\n\n.outro-screen {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2000;\n  pointer-events: auto;\n\n  background-image: url(${u});\n  background-position: center center;\n  background-repeat: no-repeat;\n  background-size: cover;\n}`,""]);const p=d},31470(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/platform/BUS.glb"},31601(e){"use strict";e.exports=function(e){return e[1]}},39012(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/insuperable/Soda_new1.glb"},41113(e){"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},44503(e,t,n){var o={"./insuperable/Fries_new.glb":65115,"./insuperable/Soda_new1.glb":39012,"./jump/Burger.glb":82218,"./platform/BUS.glb":31470};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=44503},55056(e,t,n){"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},62251(e,t,n){"use strict";e.exports=n.p+"6e67a1edb58c637e28a1.jpg"},65115(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/insuperable/Fries_new.glb"},76314(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},77659(e){"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},82218(e,t,n){"use strict";e.exports=n.p+"scene/assets/model/obstacles/jump/Burger.glb"},85072(e){"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},s=[],r=0;r<e.length;r++){var l=e[r],c=o.base?l[0]+o.base:l[0],d=i[c]||0,u="".concat(c," ").concat(d);i[c]=d+1;var p=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var g=a(f,o);o.byIndex=r,t.splice(r,0,{identifier:u,updater:g,references:1})}s.push(u)}return s}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=o(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var r=n(i[s]);t[r].references--}for(var l=o(e,a),c=0;c<i.length;c++){var d=n(i[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},97825(e){"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},98869(e,t,n){"use strict";var o=n(85072),a=n.n(o),i=n(97825),s=n.n(i),r=n(77659),l=n.n(r),c=n(55056),d=n.n(c),u=n(10540),p=n.n(u),f=n(41113),g=n.n(f),m=n(11249),h={};h.styleTagTransform=g(),h.setAttributes=d(),h.insert=l().bind(null,"head"),h.domAPI=s(),h.insertStyleElement=p(),a()(m.A,h),m.A&&m.A.locals&&m.A.locals;var v=n(11964);n(57792);const b={Idle:[0,88],Run:[89,109],Strafe_L:[182,201],Strafe_R:[202,221]};function x(e,t){const[n,o]=b[e];return{start:n,end:o,loop:!0,scroll:t}}const y={Idle:x("Idle",0),Run:x("Run",75),Slide:{start:110,end:154,loop:!1,scroll:75},Jump:{start:155,end:181,loop:!1,scroll:75,allowStrafe:!1},Strafe_L:x("Strafe_L",75),Strafe_R:x("Strafe_R",75),Run_Idle:{start:222,end:248,loop:!1,scroll:0},Fall:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1},Getup:{start:325,end:552,loop:!1,scroll:0,allowStrafe:!1},Death:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1}},w=new Set(["Slide","Jump","Fall","Getup","Death"]);var S=n(96540);const M=e=>{let t;const n=new Set,o=(e,o)=>{const a="function"==typeof e?e(t):e;if(!Object.is(a,t)){const e=t;t=(null!=o?o:"object"!=typeof a||null===a)?a:Object.assign({},t,a),n.forEach(n=>n(t,e))}},a=()=>t,i={setState:o,getState:a,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(o,a,i);return i},C=e=>e,I=e=>{const t=(e=>e?M(e):M)(e),n=e=>function(e,t=C){const n=S.useSyncExternalStore(e.subscribe,S.useCallback(()=>t(e.getState()),[e,t]),S.useCallback(()=>t(e.getInitialState()),[e,t]));return S.useDebugValue(n),n}(t,e);return Object.assign(n,t),n},P={coinCount:0,score:0,lives:3,gameState:"idle",isLoading:!0,showIntroScreen:!0,countdownValue:null,matchDuration:90,matchTimeRemaining:90,isMatchTimerActive:!1,activePowerUps:[]},z=(k=e=>Object.assign(Object.assign({},P),{updateCoinCount:t=>e({coinCount:t}),incrementCoinCount:t=>e(e=>({coinCount:e.coinCount+t})),resetCoinCount:()=>e({coinCount:0}),decrementLives:()=>e(e=>{const t=Math.max(0,e.lives-1),n=t<=0?"gameover":e.gameState;return console.log(`â¤ï¸ Lives: ${t} | Game State: ${n}`),{lives:t,gameState:n}}),setLives:t=>e({lives:Math.max(0,t)}),addScore:t=>e(e=>({score:e.score+t})),setGameState:t=>{console.log(`ðŸŽ® Game State: ${t}`),e({gameState:t})},activatePowerUp:(t,n)=>e(e=>{const o=Date.now()+n,a={type:t,expiresAt:o},i=e.activePowerUps.filter(e=>e.type!==t);return console.log(`âš¡ Power-up activated: ${t} (expires in ${n}ms)`),{activePowerUps:[...i,a]}}),deactivatePowerUp:t=>e(e=>({activePowerUps:e.activePowerUps.filter(e=>e.type!==t)})),setLoading:t=>{console.log(`â³ Loading: ${t}`),e({isLoading:t})},dismissIntroScreen:()=>{console.log("ðŸŽ¬ Intro screen dismissed"),e({showIntroScreen:!1})},setCountdown:t=>{e({countdownValue:t})},startMatchTimer:()=>{e(e=>({isMatchTimerActive:!0,matchTimeRemaining:e.matchDuration})),console.log("â±ï¸ Match timer started")},tickMatchTimer:t=>e(e=>{if(!e.isMatchTimerActive)return{};if("playing"!==e.gameState)return{};const n=Math.max(0,e.matchTimeRemaining-t);if(n<=0){const t=e.lives>0;return console.log(t?"ðŸŽ‰ VICTORY! Player survived the match!":"â±ï¸ TIME'S UP! Match ended."),{matchTimeRemaining:0,isMatchTimerActive:!1,gameState:t?"victory":"gameover"}}return{matchTimeRemaining:n}}),stopMatchTimer:()=>{e({isMatchTimerActive:!1}),console.log("â±ï¸ Match timer stopped")},resetGame:()=>{console.log("ðŸ”„ Game reset"),e(Object.assign(Object.assign({},P),{isLoading:!1,showIntroScreen:!1,countdownValue:null}))}}))?I(k):I;var k;let R=0;function O(e,t,n,o,a,i,s,r,l){const c={forward:!1,slide:!1,jump:!1,leftPressed:!1,rightPressed:!1};let d=null;const u={Digit1:"Idle",Digit2:"Run",Digit3:"Slide",Digit4:"Jump",Digit5:"Run_Idle"};let p=0,f=0,g=!1,m=!1,h=null,b=null,x=0,S=0,M=!1;const C={halfWidth:0,halfDepth:0,standingHeight:0,slideHeight:0,centerOffsetY:0,slideCenterOffsetY:0,initialized:!1};let I=null,P=0,k=!1,O=!1,E=0;const T={active:!1,velocity:0,gravity:-488,jumpStrength:180};let L=null;function j(){if(!h||!C.initialized)return null;const e="Slide"===(null==b?void 0:b.currentState),t=e?C.slideHeight:C.standingHeight;let n=e?C.slideCenterOffsetY:C.centerOffsetY;T.active&&(n+=4),e&&(n-=2);const o=new v.Pq0(h.position.x,h.position.y+n,h.position.z),a=.5*t,i={min:new v.Pq0(o.x-C.halfWidth,o.y-a,o.z-C.halfDepth),max:new v.Pq0(o.x+C.halfWidth,o.y+a,o.z+C.halfDepth)};return i}function _(e,t){return!(e.max.x<t.min.x||e.min.x>t.max.x||e.max.y<t.min.y||e.min.y>t.max.y||e.max.z<t.min.z||e.min.z>t.max.z)}function D(t){if(!b)return;const n=b.currentState;if("Fall"===n||"Getup"===n||"Death"===n)return;if(t&&(function(t){if(O=!0,E=.25,t&&h){const n=h.position.clone();n.y+=3,function(e,t,n,o={}){var a,i,s,r;const l=null!==(a=o.duration)&&void 0!==a?a:.8,c=null!==(i=o.particleCount)&&void 0!==i?i:120,d=null!==(s=o.color1)&&void 0!==s?s:new v.ov8(.6,.55,.5,.6),u=null!==(r=o.color2)&&void 0!==r?r:new v.ov8(.4,.35,.3,.5),p=new v.okU("dustCloud",c,e);p.particleTexture=new v.gPd("https://raw.githubusercontent.com/BabylonJS/Babylon.js/master/packages/tools/playground/public/textures/cloud.png",e);const f=v.PeD.CreateBox("dustEmitter",{size:.1},e);f.position=t.clone(),f.parent=n,f.isVisible=!1,p.emitter=f,p.color1=d,p.color2=u,p.colorDead=new v.ov8(.3,.28,.25,0),p.minSize=3,p.maxSize=7,p.minLifeTime=.4,p.maxLifeTime=l,p.emitRate=400,p.blendMode=v.okU.BLENDMODE_STANDARD,p.minEmitPower=5,p.maxEmitPower=12,p.updateSpeed=.01,p.createCylinderEmitter(2.5,.5,0),p.direction1=new v.Pq0(-1,-.5,-1),p.direction2=new v.Pq0(1,1.5,1),p.gravity=new v.Pq0(0,-5,0),p.start(),setTimeout(()=>{p.stop()},150),setTimeout(()=>{p.dispose(),f.dispose()},1e3*(l+.5)),console.log("ðŸ’¨ Dust cloud VFX created at",t.toString())}(e,n,t.mesh,{duration:.4,particleCount:60})}console.log("ðŸ”™ Bounce-back effect triggered!")}(t),t.active=!1,t.mesh.setEnabled(!1)),z.getState().decrementLives(),z.getState().lives<=0)return console.log("ðŸ’€ GAME OVER - No lives remaining"),T.active=!1,T.velocity=0,P=4,void b.setPlayerState("Death",!0);if(T.active=!1,T.velocity=0,P=4,b.setPlayerState("Fall",!0),r&&h){for(let e=0;e>=-60;e-=15)for(let t=-15;t<=15;t+=15)r.fillGapAt(h.position.x+t,h.position.z+e);console.log("ðŸ©¹ Repaired road around player for safe respawn")}let o=null;t||(k=!0,T.velocity=-50,console.log("ðŸ•³ï¸ Falling into gap!"),A&&h&&(o=A.position.y-h.position.y,console.log(`ðŸ’¾ Saved Camera Y Offset: ${o}`)))}const A=new v.VR0("camTarget",e);function B(e){c.forward=!1,c.slide=!1,c.jump=!1,c.leftPressed=!1,c.rightPressed=!1,d=e,e&&b?b.setPlayerState(e,!0):b&&b.setPlayerState("Idle",!0)}function F(e){if(!h||!b)return;if(!b.canStrafe)return;const t=p;p=Math.min(1,Math.max(-1,p+e)),t!==p&&(f=25*p,e>0?b.setPlayerState("Strafe_R"):b.setPlayerState("Strafe_L"))}!function(e,t,n,o,a){v.cng.ImportMesh(null,n,"player.glb",e,(n,i,s,r)=>{var l,c,d,u;if(0===n.length)return void console.error("No meshes loaded from player.glb");const p=new v.VR0("playerRoot",e);n.forEach(e=>{e.parent=p,e.alwaysSelectAsActiveMesh=!0,e.setEnabled(!0),e instanceof v.eaF&&(e.receiveShadows=!0,o.addShadowCaster(e,!0))});const f=null!==(c=null!==(l=n.find(e=>e instanceof v.eaF&&!!e.skeleton))&&void 0!==l?l:n.find(e=>e instanceof v.eaF))&&void 0!==c?c:null,g=null!==(d=null!=f?f:n[0])&&void 0!==d?d:null;p.position=v.Pq0.Zero(),p.scaling=v.Pq0.One(),p.computeWorldMatrix(!0);const m=s[0]||(null==f?void 0:f.skeleton)||null,{min:h,max:b}=p.getHierarchyBoundingVectors(),x=b.y-h.y,y=x>0?16/x:1;p.scaling=new v.Pq0(y,y,y),p.computeWorldMatrix(!0),p.rotate(v._0v.Y,Math.PI,v.$xS.LOCAL),p.computeWorldMatrix(!0);const{min:w,max:S}=p.getHierarchyBoundingVectors(),M=w.add(S).scale(.5);p.position=new v.Pq0(-M.x,.05-w.y,7.5-M.z),p.computeWorldMatrix(!0),g?t.lockedTarget=g:t.setTarget(p.position.clone());const C=null!==(u=r.find(e=>e.targetedAnimations.length>0))&&void 0!==u?u:null;r.forEach(e=>{e!==C&&e.stop()}),a({playerRoot:p,playerSkeleton:m,playerAnimationGroup:C})},void 0,(e,t,n)=>{console.error("Error loading player.glb:",t,n)})}(e,t,n,o,n=>{h=n.playerRoot,x=h.position.y,S=x,t.lockedTarget=A;const o=localStorage.getItem("camera_target_x"),i=localStorage.getItem("camera_target_y"),s=localStorage.getItem("camera_target_z");null!==o&&null!==i&&null!==s?(A.position.set(parseFloat(o),parseFloat(i),parseFloat(s)),console.log("ðŸ“· Camera target initialized from LocalStorage")):(A.position.copyFrom(h.position),A.position.y-=15,console.log("ðŸ“· Camera target initialized with default offset (-15)"));const{min:r,max:c}=n.playerRoot.getHierarchyBoundingVectors(),d=r.subtract(n.playerRoot.position),u=c.subtract(n.playerRoot.position),p=u.x-d.x,f=u.z-d.z,g=u.y-d.y;C.halfWidth=.5*p,C.halfDepth=.5*f,C.standingHeight=g,C.slideHeight=.6*g,C.centerOffsetY=d.y+.5*g,C.slideCenterOffsetY=d.y+.5*C.slideHeight,C.initialized=!0,b=function(e){var t;const{scene:n,playerRoot:o,playerSkeleton:a,animationGroup:i,setScrollSpeed:s}=e;let r="Idle",l=!1,c=!1,d=null,u=null,p=null,f=24;if(i){const e=i.targetedAnimations[0];(null===(t=null==e?void 0:e.animation)||void 0===t?void 0:t.framePerSecond)&&(f=e.animation.framePerSecond)}function g(e,t){if(a){const t=a.getAnimationRange(e);if(t)return{start:t.from,end:t.to}}return{start:t.start,end:t.end}}function m(){d&&p&&(d.onAnimationEndObservable.remove(p),p=null),i&&u&&(i.onAnimationGroupEndObservable.remove(u),u=null),i&&i.stop(),d&&d.stop(),d=null}return a&&Object.keys(y).forEach(e=>{if(!a.getAnimationRange(e)){const{start:t,end:n}=y[e];a.createAnimationRange(e,t,n)}}),{get currentState(){return r},get canStrafe(){return!(!c||"Jump"!==r&&"Fall"!==r)||!1!==y[r].allowStrafe},setPlayerState:function e(t,o=!1){if(!o&&r===t)return;if(!o&&w.has(r))return;const l=y[t],c=g(t,l);if(!a&&!i)return r=t,void s(l.scroll);m(),s(l.scroll);const h=()=>{"Slide"===t?e("Run",!0):"Fall"===t?e("Getup",!0):"Getup"===t?e("Run",!0):"Run_Idle"===t&&e("Idle",!0)};let v=!1;if(i){const e=f/24,t=c.start*e,n=c.end*e;i.reset(),i.start(l.loop,1.5,t,n,!1),v=!0,l.loop||(u=i.onAnimationGroupEndObservable.addOnce(()=>{u=null,h()}))}else a&&(d=n.beginAnimation(a,c.start,c.end,l.loop,1),d&&(v=!0,l.loop||(p=d.onAnimationEndObservable.addOnce(()=>{p=null,h()}))));r=t},setAllowAirStrafe:e=>{c=e},ensureIdle:function(){if(l)return;m(),r="Idle",s(0);const e=g("Idle",y.Idle);if(i){const t=f/24;i.reset(),i.stop(),i.start(!0,1,e.start*t,e.end*t,!0),l=!0,console.log("âœ… Player initialized to Idle animation")}else a&&(d=n.beginAnimation(a,e.start,e.end,!0),d&&(l=!0,console.log("âœ… Player initialized to Idle animation (skeleton)")))},pauseAnimation:function(){i&&i.pause(),d&&d.pause()},resumeAnimation:function(){i&&i.play(),d&&d.restart()},dispose:function(){m()}}}({scene:e,playerRoot:n.playerRoot,playerSkeleton:n.playerSkeleton,animationGroup:n.playerAnimationGroup,setScrollSpeed:a}),V(),m&&N(),null==l||l()});const $=()=>"playing"===z.getState().gameState;function N(){m=!0,g=!0,z.getState().setGameState("playing"),b&&b.setPlayerState("Run",!0)}function V(){b&&b.ensureIdle()}function G(){h&&b&&(h.position.y=S,x=S,p=0,f=0,h.position.x=0,A&&(A.position.copyFrom(h.position),A.position.y-=15,console.log("ðŸ“· Camera target reset to default position")),L=null,h.metadata={lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z},g=!1,m=!1,M=!1,k=!1,T.active=!1,T.velocity=0,O=!1,E=0,P=0,b.setPlayerState("Idle",!0),a(0),console.log("Player controller reset"))}e.onBeforeRenderObservable.add(()=>{var t,n,o,l,u,p;if(!h||!b)return;if("paused"===z.getState().gameState)return;const m=z.getState();if(m.isMatchTimerActive&&"playing"===m.gameState){const t=e.getEngine().getDeltaTime()/1e3;m.tickMatchTimer(t)}if("gameover"===m.gameState)return void("Death"!==b.currentState&&(console.log("ðŸŽ® Game Over detected - setting player to Death state"),T.active=!1,T.velocity=0,O=!1,E=0,a(0),b.setPlayerState("Death",!0)));!function(){if(!h||!b)return;if(d)return;const e=b.currentState;"Fall"!==e&&"Getup"!==e&&"Death"!==e&&(c.jump&&!T.active?(b.setPlayerState("Jump"),h&&(T.active||(T.active=!0,T.velocity=T.jumpStrength)),c.jump=!1):c.slide&&b.setPlayerState("Slide"))}();const y=e.getEngine().getDeltaTime()/1e3;P=Math.max(0,P-y),O&&(E-=y,E<=0?(O=!1,E=0,a(0),console.log("âœ… Bounce-back effect completed")):a(-240)),h.position.x=v.X5X.Lerp(h.position.x,f,.12),function(){var t,n,o,a,s,r;if(!h)return;if("Fall"===(null==b?void 0:b.currentState)||"Getup"===(null==b?void 0:b.currentState))return void(null==I||I.hide());const l=i.getActivePlatformMeshes().length>0,c=h.position.add(new v.Pq0(0,2,0)),u=new v.RlV(c,new v.Pq0(0,-1,0),40);null==I||I.hide();const p=e.pickWithRay(u,e=>{var t,n,o;return!0===(null===(t=e.metadata)||void 0===t?void 0:t.isCollisionMesh)||"platform"===(null===(n=e.metadata)||void 0===n?void 0:n.obstacleType)||!(!e.parent||"platform"!==(null===(o=e.parent.metadata)||void 0===o?void 0:o.obstacleType))});if((null==p?void 0:p.hit)&&p.pickedPoint&&p.pickedMesh){const e=p.pickedMesh.getBoundingInfo(),i=null==e?void 0:e.boundingBox.minimumWorld,l=null==e?void 0:e.boundingBox.maximumWorld,c=1.5,u=!i||!l||h.position.x>=i.x-c&&h.position.x<=l.x+c,f=!i||!l||h.position.z>=i.z-c&&h.position.z<=l.z+c,g=l.y,m=h.position.y,v=m-g,y=v>=-2&&v<=30;if(p){const e=performance.now();if(e-R>300){R=e,console.log("----- PLATFORM LANDING DEBUG -----"),console.log("Picked Mesh:",null===(t=p.pickedMesh)||void 0===t?void 0:t.name),console.log("isCollisionMesh:",null===(o=null===(n=p.pickedMesh)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.isCollisionMesh),console.log("PickedPoint Y:",null===(s=null===(a=p.pickedPoint)||void 0===a?void 0:a.y)||void 0===s?void 0:s.toFixed(3)),console.log("Player Y:",h.position.y.toFixed(3));const i=null===(r=p.pickedMesh)||void 0===r?void 0:r.getBoundingInfo();i&&(console.log("bbMinY:",i.boundingBox.minimumWorld.y.toFixed(3)),console.log("bbMaxY:",i.boundingBox.maximumWorld.y.toFixed(3))),console.log("deltaY:",v),console.log("feetY:",m),console.log("platformTopY:",g),console.log("withinX:",u),console.log("withinZ:",f),console.log("platformBelow:",y),console.log("----------------------------------")}}if(u&&f&&y){const e=l.y,t=Math.max(e,S),n=1.5,o=T.active&&T.velocity<=0,a=h.position.y-t<=n;if(!T.active||o&&a)return x=t,h.position.y=Math.max(h.position.y,x),T.active&&(T.active=!1,T.velocity=0,!d&&b&&b.setPlayerState("Run",!0)),void(M=!0)}}if(!l)return M=!1,void(x=S);M?(x=S,(!T.active||T.velocity<=0)&&(T.active=!0,T.velocity=0),M=!1):x=S}(),function(e){if(h){if(!T.active)return k?(T.velocity+=T.gravity*e,void(h.position.y+=T.velocity*e)):void(h.position.y!==x&&(h.position.y=x));T.velocity+=T.gravity*e,h.position.y+=T.velocity*e,h.position.y<=x&&(h.position.y=x,T.active=!1,T.velocity=0,!d&&b&&b.setPlayerState("Run",!0))}}(y),k&&("Getup"!==b.currentState&&"Run"!==b.currentState&&"Idle"!==b.currentState||(k=!1,h.position.y=x,T.velocity=0,r&&r.fillGapAt(h.position.x,h.position.z),A&&null!==L&&(A.position.y=h.position.y+L,console.log(`ðŸ”„ Respawn: Restored Camera Y Offset: ${L}`),L=null),h.metadata=Object.assign(Object.assign({},h.metadata||{}),{lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z}),console.log("âœ¨ Recovered from gap fall & repaired road")));const w=z.getState().gameState;if(A&&"playing"===w){const e=h.position.x-(null!==(n=null===(t=h.metadata)||void 0===t?void 0:t.lastX)&&void 0!==n?n:h.position.x),a=h.position.z-(null!==(l=null===(o=h.metadata)||void 0===o?void 0:o.lastZ)&&void 0!==l?l:h.position.z);let i=0;k||(i=h.position.y-(null!==(p=null===(u=h.metadata)||void 0===u?void 0:u.lastY)&&void 0!==p?p:h.position.y),A.position.y+=i),A.position.x+=e,A.position.z+=a}if(h&&(h.metadata=Object.assign(Object.assign({},h.metadata||{}),{lastX:h.position.x,lastY:h.position.y,lastZ:h.position.z})),!d&&"Fall"!==b.currentState&&"Getup"!==b.currentState&&"Death"!==b.currentState&&$()){const e=function(){var e;if(!h||!b)return null;if(P>0)return null;const t=j();if(!t)return null;const n=i.getActiveObstacles();for(const o of n){if(!o.active)continue;const n=o.mesh;n.computeWorldMatrix(!0);const a=(null===(e=o.collisionMeshes)||void 0===e?void 0:e.length)?o.collisionMeshes:[n];for(const e of a){e.computeWorldMatrix(!0);const n=e.getBoundingInfo();if(!n)continue;const a={min:n.boundingBox.minimumWorld,max:n.boundingBox.maximumWorld};if("platform"===o.type){const e=t.min.y>=a.max.y-1.2;if(M||e)continue}if(_(t,a))return o}}return null}();e&&D(e),r&&!T.active&&P<=0&&r.isOverGap(h.position.x,h.position.z)&&(console.log("âš ï¸ Player fell into gap!"),D());const t=j();if(t){const e=s.checkCollisions(t);if(e>0){console.log("Collected coins:",e);const t=new CustomEvent("coinCollected",{detail:{count:e}});window.dispatchEvent(t)}}}const C=b.currentState,B=Math.abs(h.position.x-f)<.5;g&&B&&("Strafe_L"===C||"Strafe_R"===C)&&b.setPlayerState("Run")});const U={startX:0,startY:0,startTime:0,isDragging:!1};return{handleKeyDown:function(e){const t=u[e.code];if(t)return e.preventDefault(),void B(t);if("Digit0"===e.code)return e.preventDefault(),void B(null);if("KeyP"===e.code){const e=z.getState();return void("playing"===e.gameState?(e.setGameState("paused"),b&&b.pauseAnimation()):"paused"===e.gameState&&(e.setGameState("playing"),b&&b.resumeAnimation()))}if("KeyR"===e.code)return console.log("ðŸ”„ RESTARTING GAME..."),z.getState().resetGame(),i.reset(),s.reset(),G(),N(),void z.getState().startMatchTimer();if($())switch(e.code){case"ArrowLeft":case"KeyA":c.leftPressed=!0,F(1);break;case"ArrowRight":case"KeyD":c.rightPressed=!0,F(-1);break;case"ArrowDown":case"KeyS":c.slide=!0;break;case"KeyW":c.jump=!0}},handleKeyUp:function(e){switch(e.code){case"ArrowLeft":case"KeyA":c.leftPressed=!1;break;case"ArrowRight":case"KeyD":c.rightPressed=!1;break;case"ArrowDown":case"KeyS":c.slide=!1;break;case"KeyW":c.jump=!1}},handleTouchStart:function(e){if(!$())return;const t=e.touches[0];t&&(U.startX=t.clientX,U.startY=t.clientY,U.startTime=Date.now(),U.isDragging=!0)},handleTouchMove:function(e){$()&&U.isDragging},handleTouchEnd:function(e){if(!$()||!U.isDragging)return;const t=e.changedTouches[0];if(!t)return;const n=t.clientX-U.startX,o=t.clientY-U.startY,a=Date.now()-U.startTime;U.isDragging=!1;const i=Math.sqrt(n*n+o*o);if(i<50&&a<200)return c.jump=!0,void setTimeout(()=>c.jump=!1,100);i>=50&&a<500&&(Math.abs(n)>Math.abs(o)?F(n>0?-1:1):o<0?(c.jump=!0,setTimeout(()=>c.jump=!1,100)):(c.slide=!0,setTimeout(()=>c.slide=!1,500)))},handlePointerDown:function(t){if(!$())return;const n=e.getEngine().getRenderingCanvas();if(!n)return;const o=n.getBoundingClientRect(),a=t.clientX-o.left,i=t.clientY-o.top,s=o.width,r=o.height,l=a<.33*s,d=a>.66*s;i<.33*r&&!l&&!d?c.jump=!0:i>.66*r&&!l&&!d?c.slide=!0:l?F(1):d&&F(-1)},handlePointerUp:function(e){c.slide=!1,c.jump=!1},startGame:N,ensureIdle:V,dispose:function(){I&&(I.dispose(),I=null)},reset:G,cameraTarget:A}}const E=new Map,T={ground:{albedoColor:new v.v9j(.12,.12,.14),metallic:0,roughness:.9},building:{metallic:0,roughness:1},coin:{albedoColor:new v.v9j(1,.8,0),emissiveColor:new v.v9j(.4,.3,0),metallic:1,roughness:.3},obstacle:{metallic:0,roughness:.9},obstacleGLB:{metallic:0,roughness:.85},hamburger:{metallic:0,roughness:.7}},L={jump:{albedo:new v.v9j(.8,.2,.2),emissive:new v.v9j(.2,.05,.05)},duck:{albedo:new v.v9j(.2,.6,.9),emissive:new v.v9j(.05,.15,.25)},platform:{albedo:new v.v9j(.35,.8,.4),emissive:new v.v9j(.08,.2,.1)},insuperable:{albedo:new v.v9j(.5,.2,.8),emissive:new v.v9j(.1,.05,.2)}};function j(e,t){const n=`obstaclePBR_${t}`;if(E.has(n))return E.get(n);const o=L[t]||L.jump,a=new v.YOq(n,e);return a.albedoColor=o.albedo,a.emissiveColor=o.emissive,a.metallic=T.obstacle.metallic,a.roughness=T.obstacle.roughness,E.set(n,a),a.freeze(),a}function _(e,t,n){var o,a;const i=e.material;if(i){if(i instanceof v.YOq){const t=i.metallicTexture||i.microSurfaceTexture,n=i.bumpTexture,o=i.reflectivityTexture||i.reflectionTexture;return console.log(`[MaterialFactory] ${e.name}: metallicRoughness=${!!t}, normal=${!!n}, reflectance=${!!o}`),t||(i.metallic=T.obstacleGLB.metallic,i.roughness=T.obstacleGLB.roughness),void((e.name.toLowerCase().includes("soda")||e.name.toLowerCase().includes("can")||e.parent&&e.parent.name.toLowerCase().includes("soda"))&&(i.metallic=.8,i.roughness=.15,i.environmentIntensity=1.8,i.emissiveColor=new v.v9j(.4,.4,.4),i.emissiveIntensity=.8,console.log(`âœ¨ Brightened drink material for: ${e.name}`)))}if(i instanceof v.FUi){const n=new v.YOq(`${i.name}_unified`,t);i.diffuseTexture&&(n.albedoTexture=i.diffuseTexture),i.bumpTexture&&(n.bumpTexture=i.bumpTexture),i.emissiveTexture&&(n.emissiveTexture=i.emissiveTexture),i.ambientTexture&&(n.ambientTexture=i.ambientTexture),i.specularTexture&&(n.reflectivityTexture=i.specularTexture),n.albedoColor=null!==(o=i.diffuseColor)&&void 0!==o?o:v.v9j.White(),n.emissiveColor=null!==(a=i.emissiveColor)&&void 0!==a?a:v.v9j.Black(),n.metallic=T.obstacleGLB.metallic,n.roughness=T.obstacleGLB.roughness,e.material=n}}}new v.v9j(.85,.55,.25),new v.v9j(.35,.2,.1),new v.v9j(1,.8,.2),new v.v9j(.3,.7,.2),new v.v9j(.9,.2,.15),new v.v9j(.95,.92,.8);class D{static preloadAll(e,t){return n=this,o=void 0,i=function*(){if(this.loaded)return;const n=[];for(const o in t){const a=o,i=t[a];for(const t of i){const o=v.cng.LoadAssetContainerAsync("",t,e,null,".glb").then(e=>{this.cache[a].push({container:e,sourceUrl:t})}).catch(e=>{console.error(`Failed to load obstacle GLB [${a}]: ${t}`,e)});n.push(o)}}yield Promise.all(n),this.loaded=!0,console.log("Obstacle GLBs preloaded:",this.cache)},new((a=void 0)||(a=Promise))(function(e,t){function s(e){try{l(i.next(e))}catch(e){t(e)}}function r(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a(function(e){e(n)})).then(s,r)}l((i=i.apply(n,o||[])).next())});var n,o,a,i}static getVariantCount(e){const t=this.cache[e];return t?t.length:0}static getMesh(e,t,n){const o=this.cache[e];if(!o||0===o.length)return null;const a=o.length-1,i="number"==typeof n&&n>=0&&n<=a?n:Math.floor(Math.random()*o.length),{container:s,sourceUrl:r}=o[i],l=s.instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];if(!l)return console.warn(`Empty GLB container for ${e}`),null;const c=l;c.metadata=c.metadata||{},c.metadata.sourceUrl=r,c.position.setAll(0),"duck"===e&&c.scaling.setAll(1.5),r.toLowerCase().includes("fries")?(c.scaling.setAll(1.2),c.rotationQuaternion=null,c.rotation.y=Math.PI,c.getChildMeshes(!1).forEach(e=>{e.rotationQuaternion=null}),console.log(`ðŸŸ Spawned FRIES: ${r}`)):r.toLowerCase().includes("soda")&&console.log(`ðŸ¥¤ Spawned SODA: ${r}`),"insuperable"===e&&(c.rotation.z=0),function(e,t){_(e,t);const n=e.getChildMeshes(!1);for(const e of n)_(e,t)}(c,t);let d=[];const u=c.getChildMeshes(!1).filter(e=>e.name.toLowerCase().includes("customcollision"));if(c.name&&c.name.toLowerCase().includes("customcollision")&&u.unshift(c),u.length>0?(console.log(`[ObstacleGLBBuilder] Found ${u.length} custom collision mesh(es) for ${e}`),d=u,d.forEach(e=>{e.isVisible=!1,e.isPickable=!0,e.metadata=e.metadata||{},e.metadata.isCollisionMesh=!0,e.computeWorldMatrix(!0)})):d=[c],c.computeWorldMatrix(!0),1===d.length&&d[0]===c){const{min:e,max:t}=c.getHierarchyBoundingVectors(),n=new v.jLo(e,t);c.setBoundingInfo(n)}return d.forEach(e=>e.computeWorldMatrix(!0)),{root:c,collisionMeshes:d}}}function A(e,t){const n=e.getTotalVertices();if(0===n)return;const o=[];for(let e=0;e<n;e++)o.push(t[0],t[1],t[2],t[3]);e.setVerticesData(v.Rcs.ColorKind,o)}function B(e,t=.75){const n=new v.eaF("obs_hamburger",e),o=[.95,.7,.3,1],a=[.2,.8,.2,1],i=[1,.2,.2,1],s=[.98,.96,.9,1],r=6*t,l=3*t,c=5.5*t,d=1.5*t;let u=0;const p=v.PeD.CreateCylinder("bottomBun",{diameter:2*r,height:l,tessellation:32},e);A(p,o),u=l/2,p.position.y=u,p.parent=n,u+=l/2;const f=v.PeD.CreateCylinder("patty",{diameter:2*c,height:d,tessellation:32},e);A(f,[.4,.2,.1,1]),u+=d/2,f.position.y=u,f.parent=n,u+=d/2;const g=1.8*r,m=v.PeD.CreateBox("cheese",{width:g,height:.3*t,depth:g},e);A(m,[1,.9,.2,1]),u+=.15*t,m.position.y=u,m.rotation.y=Math.PI/4,m.parent=n,u+=.15*t;const h=1.1*r,b=.8*t;u+=b/2;for(let t=0;t<6;t++){const o=v.PeD.CreateBox(`lettuce_${t}`,{width:.8*h,height:b,depth:.5*h},e);A(o,a),o.position.y=u,o.rotation.y=Math.PI/3*t,o.position.x=Math.cos(Math.PI/3*t)*r*.3,o.position.z=Math.sin(Math.PI/3*t)*r*.3,o.parent=n}u+=b/2;const x=4*t,y=.6*t;u+=y/2;const w=v.PeD.CreateCylinder("tomato1",{diameter:2*x,height:y,tessellation:16},e);A(w,i),w.position.y=u,w.position.x=-1.5*t,w.parent=n;const S=v.PeD.CreateCylinder("tomato2",{diameter:2*x,height:y,tessellation:16},e);A(S,i),S.position.y=u,S.position.x=1.5*t,S.parent=n,u+=y/2;const M=v.PeD.CreateSphere("topBun",{diameter:2*r,slice:.5,segments:16},e);A(M,o),M.position.y=u,M.parent=n,[{x:0,z:-2},{x:1.5,z:-1},{x:-1.5,z:-1},{x:2,z:1},{x:-2,z:1},{x:0,z:2},{x:1,z:.5},{x:-1,z:.5}].forEach((o,a)=>{const i=v.PeD.CreateCapsule(`seed_${a}`,{height:.8*t,radius:.2*t},e);A(i,s);const l=o.x*t,c=o.z*t,d=Math.sqrt(l*l+c*c),p=u+.7*Math.sqrt(Math.max(0,r*r-d*d));i.position.set(l,p,c),i.rotation.x=Math.PI/2,i.rotation.z=Math.random()*Math.PI,i.parent=n}),n.position.y=0;const C=n.getChildMeshes();if(C.length>0){const t=v.eaF.MergeMeshes(C,!0,!1,n,!1,!0);if(t)return t.name="obs_hamburger",t.material=function(e){const t="hamburgerUnifiedPBR";if(E.has(t))return E.get(t);const n=new v.YOq(t,e);return n.metallic=0,n.roughness=.9,E.set(t,n),n}(e),t.useVertexColors=!0,t.metadata={isHamburger:!0},t}return n}D.cache={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]},D.loaded=!1;const F="insuperable",$="jump",N="duck",V="platform",G=[[{obstacles:[{type:$,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:F,laneIndex:-1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.2},{obstacles:[{type:V,laneIndex:1}],coins:[{laneIndex:1,yOffset:15,count:4,spacing:10}],delayNext:2},{obstacles:[{type:N,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.3},{obstacles:[{type:V,laneIndex:-1}],coins:[{laneIndex:-1,yOffset:15,count:4,spacing:10}],delayNext:2},{obstacles:[],coins:[{laneIndex:1,count:5,spacing:6}],delayNext:1}],[{obstacles:[{type:$,laneIndex:-1}],coins:[{laneIndex:-1,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:$,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:$,laneIndex:1}],coins:[{laneIndex:1,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:F,laneIndex:0}],coins:[{laneIndex:1,count:3,spacing:8}],delayNext:1.2},{obstacles:[],coins:[{laneIndex:0,count:5,spacing:6}],delayNext:1}],[{obstacles:[{type:N,laneIndex:-1}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:1.3},{obstacles:[{type:N,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.3},{obstacles:[{type:$,laneIndex:1}],coins:[{laneIndex:1,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:N,laneIndex:1}],coins:[{laneIndex:1,count:3,spacing:8}],delayNext:1.3},{obstacles:[],coins:[{laneIndex:0,count:5,spacing:6}],delayNext:1}],[{obstacles:[{type:F,laneIndex:-1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.2},{obstacles:[{type:$,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:F,laneIndex:1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.2},{obstacles:[{type:N,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.3},{obstacles:[],coins:[{laneIndex:-1,count:5,spacing:6}],delayNext:1}],[{obstacles:[{type:V,laneIndex:-1}],coins:[{laneIndex:-1,yOffset:15,count:5,spacing:10}],delayNext:2.2},{obstacles:[{type:$,laneIndex:0}],coins:[{laneIndex:0,count:3,spacing:8,yOffset:8}],delayNext:1.5},{obstacles:[{type:V,laneIndex:1}],coins:[{laneIndex:1,yOffset:15,count:5,spacing:10}],delayNext:2.2},{obstacles:[{type:F,laneIndex:-1}],coins:[{laneIndex:1,count:3,spacing:8}],delayNext:1.2},{obstacles:[{type:V,laneIndex:0}],coins:[{laneIndex:0,yOffset:15,count:5,spacing:10}],delayNext:2.2},{obstacles:[],coins:[{laneIndex:-1,count:5,spacing:6}],delayNext:1}],[{obstacles:[{type:$,laneIndex:-1}],coins:[{laneIndex:-1,count:3,spacing:8,yOffset:8}],delayNext:1.4},{obstacles:[{type:F,laneIndex:1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:1.2},{obstacles:[{type:N,laneIndex:-1}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:1.3},{obstacles:[{type:$,laneIndex:1}],coins:[{laneIndex:1,count:3,spacing:8,yOffset:8}],delayNext:1.4},{obstacles:[],coins:[{laneIndex:0,count:5,spacing:6}],delayNext:1}]];function U(e,t,o,a,i={},s){var r,l,c;const d=null!==(r=i.laneWidth)&&void 0!==r?r:25,u=(i.laneCount,null!==(l=i.spawnZ)&&void 0!==l?l:-400),p=null!==(c=i.despawnZ)&&void 0!==c?c:200,f={jump:j(e,"jump"),duck:j(e,"duck"),platform:j(e,"platform"),insuperable:j(e,"insuperable"),hamburger:j(e,"jump")},g=function(){const e={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]};try{const t=n(44503);t.keys().forEach(n=>{const o=n.replace(/^\.\//,"").split("/");if(o.length>=2){const a=o[0];if(a in e){const o=t(n);e[a].push(o)}}}),console.log("Obstacle Model Scan Results:",e)}catch(e){console.warn("Failed to scan obstacle folders (require.context might not be available):",e)}return e}();let m=!1;D.preloadAll(e,g).then(()=>{m=!0,console.log("âœ… Obstacle GLBs ready"),s&&s()});const h=new v.VR0("obstacles_root",e),b={jump:()=>function(e,t){const n=v.PeD.CreateBox("obs_jump",{width:12,height:12,depth:14},e);return n.material=t,n.position.y=6,n}(e,f.jump),duck:()=>function(e,t){const n=v.PeD.CreateBox("obs_duck",{width:18,height:6,depth:10},e);return n.material=t,n.position.y=12,n}(e,f.duck),platform:()=>function(e,t){const n=v.PeD.CreateBox("obs_platform",{width:18,height:15,depth:90},e);return n.material=t,n.position.y=7.5,n}(e,f.platform),insuperable:()=>function(e){const t=B(e,1.5);return t.name="obs_insuperable",t}(e),hamburger:()=>B(e,1)},x=[],y=[];function w(n){let o=!1;"hamburger"!==n&&("jump"===n||"insuperable"===n)&&(o=Math.random()<0);const a=D.getVariantCount(n),i=a>0?Math.floor(Math.random()*a):void 0,s=x.find(e=>e.type===n&&!e.active&&(!!e.isHamburgerVariant===o&&(void 0===i||e.variant===i||void 0===e.variant)));if(s)return s.active=!0,s.mesh.setEnabled(!0),s;let r=null,l=null,c=i,d=!1;if(o)r=B(e,"insuperable"===n?2:1),l=[r],c=void 0,d=!0;else{const t=void 0!==i?D.getMesh(n,e,i):D.getMesh(n,e);t?(r=t.root,l=t.collisionMeshes):(r=b[n](),l=[r],c=void 0),d=!1}r.parent=h,r.receiveShadows=!0,r.metadata={obstacleType:n,variant:c,isHamburgerVariant:d},t.addShadowCaster(r,!0);const u={mesh:r,collisionMeshes:null!=l?l:[r],type:n,variant:c,isHamburgerVariant:d,active:!0};return x.push(u),u}let S=1,M=G[0],C=0,I=1,P=0,k=0;const R=e.onBeforeRenderObservable.add(()=>{var t;const n=z.getState().gameState,i=o();if("playing"!==n&&!("gameover"===n&&i<0))return;const s=e.getEngine().getDeltaTime()/1e3;if(0===i)return;const r=i*s;for(const e of y)e.mesh.position.z+=r,"insuperable"===e.type&&((null===(t=e.mesh.metadata)||void 0===t?void 0:t.sourceUrl)||"").toLowerCase().includes("soda")&&e.mesh.rotate(v._0v.Y,1.5*s,v.$xS.LOCAL);for(let e=y.length-1;e>=0;e--){const t=y[e];t.mesh.position.z>p&&(t.active=!1,t.mesh.setEnabled(!1),y.splice(e,1))}i>0&&(S+=s,S>=I&&(S=0,function(){var e;if(C>=M.length){const e=Math.floor(Math.random()*G.length);M=G[e],C=0,console.log("Switched to pattern index:",e)}const t=o(),n=M[C];let i=0,s=[!0,!0,!0],r=0;for(const t of n.obstacles){const n=w(t.type),o=t.laneIndex*d,a=t.laneIndex+1;a>=0&&a<=2&&"insuperable"===t.type&&(s[a]=!1);let l=0;"jump"===t.type?l=1.3:"duck"===t.type?l=1:"platform"===t.type&&(l=1.8),l>r&&(r=l);const c=(null===(e=n.mesh.metadata)||void 0===e?void 0:e.sourceUrl)||"",p=c.toLowerCase().includes("car"),f=p&&"platform"===n.type?-3:0;n.mesh.position.set(o,n.mesh.position.y+f,u);let g=12;"platform"===t.type?g=90:"duck"===t.type?g=10:"insuperable"===t.type&&(g=14),g>i&&(i=g);const m=c.toLowerCase().includes("fries");if(!p||"insuperable"!==n.type&&"platform"!==n.type)m||(n.mesh.rotation.y=0);else{const e=t.laneIndex>=0;n.mesh.rotation.y=e?Math.PI:0}y.push(n)}let l=k,c=999,p=!1,f=[!0,!0,!0];n.obstacles.forEach(e=>{"insuperable"===e.type&&(f[e.laneIndex+1]=!1)});for(let e=-1;e<=1;e++)if(f[e+1]){const t=Math.abs(e-k);t<c&&(c=t,l=e,p=!0)}const g=l,m=g===k,h=.4*Math.abs(g-k);if(n.coins)for(const e of n.coins)a.spawnCoin(e.laneIndex,e.yOffset||0,e.count,e.spacing);const v=performance.now()/1e3,b=Math.max(.4,1-v/300);let x=n.delayNext*b*2,S=0;t>0&&(S=(i+10)/t);let R=0;R=m?P>1.1?P:.6:P+h;let O=Math.max(x,S,R);O/=(()=>{const e=z.getState(),t=Math.max(1,e.matchDuration),n=t-e.matchTimeRemaining;return 1+.5*Math.min(1,n/t)})(),O<.5&&(O=.5),I=O,P=r,k=g,C++}()))});return{dispose:function(){R&&e.onBeforeRenderObservable.remove(R),x.forEach(e=>e.mesh.dispose()),h.dispose()},getActiveObstacles:function(){return y},getActivePlatformMeshes:function(){return y.filter(e=>"platform"===e.type).map(e=>e.mesh)},reset:function(){y.forEach(e=>{e.active=!1,e.mesh.setEnabled(!1)}),y.length=0,S=0,C=0,I=2;const e=Math.floor(Math.random()*G.length);M=G[e],console.log("Obstacle system reset")},isReady:function(){return m},hasObstacleAt:function(e,t,n){for(const o of y){if(!o.active)continue;const a=e-o.mesh.position.x,i=t-o.mesh.position.z;if(a*a+i*i<n*n)return!0}return!1},isGroundLocked:function(e,t,n){for(const o of y){if(!o.active)continue;if(Math.abs(e-o.mesh.position.x)>=n)continue;const a=o.mesh.position.z;let i=!1;switch(o.type){case"duck":i=t>=a-80&&t<=a+100;break;case"jump":i=t>=a-50&&t<=a+130;break;case"platform":i=t>=a-105&&t<=a+145;break;case"insuperable":i=t>=a-20&&t<=a+60}if(i)return!0}return!1}}}const Y={cubesWide:10,cubesLong:56,cubeSize:15,extraStartRows:4,get roadWidth(){return this.cubesWide*this.cubeSize},get roadLength(){return this.cubesLong*this.cubeSize},segmentCount:2,fallGravity:2500,fallMaxSpeed:4e3,triggerZoneStart:-80,triggerZoneEnd:-200,fallProbabilityPerSecond:.15,maxAdjacentGaps:1,cubeColor:new v.v9j(.15,.15,.2),cubeRoughness:.8};function q(e,t,n,o,a,i){const s=function(e,t,n){let o=Y.cubesLong,a=Y.roadLength,i=null;const s=function(e){const t="Multi_roadLayeredMulti",n=e.getMaterialByName(t);if(n&&n instanceof v.FrY)return n;const o=new v.YOq("asphaltTopMat",e);o.albedoTexture=new v.gPd("./scene/assets/road/asphalt_top.png",e),o.metallic=0,o.roughness=.8,o.freeze();const a=new v.YOq("asphaltDirtSideMat",e);a.albedoTexture=new v.gPd("./scene/assets/road/asphalt_dirt_side.png",e,!1,!1),a.metallic=0,a.roughness=.9,a.freeze();const i=new v.YOq("dirtBottomMat",e);i.albedoTexture=new v.gPd("./scene/assets/road/dirt_sides.png",e),i.metallic=0,i.roughness=.9,i.freeze();const s=new v.FrY(t,e);return s.subMaterials.push(a),s.subMaterials.push(o),s.subMaterials.push(i),s}(e),r=v.PeD.CreateBox("fallingCubeSource",{size:Y.cubeSize},e);r.material=s,r.isVisible=!1,r.receiveShadows=!0;const l=r.getVerticesData(v.Rcs.UVKind);if(l){for(let e=16;e<32;e+=2){const t=l[e],n=l[e+1];l[e]=n,l[e+1]=1-t}r.setVerticesData(v.Rcs.UVKind,l)}r.subMeshes=[],new v.KOo(0,0,r.getTotalVertices(),0,24,r),new v.KOo(2,0,r.getTotalVertices(),30,6,r),new v.KOo(1,0,r.getTotalVertices(),24,6,r);const c=r,d=r,u={pieceSize:Y.cubeSize/3,piecesPerCube:8,maxActiveDebris:100,gravity:400,maxSpeed:600,randomVelocityRange:30,randomRotationSpeed:1.5},p=new v.YOq("debrisMat",e);p.albedoColor=new v.v9j(.12,.11,.15),p.roughness=.9,p.metallic=0,p.freeze();const f=v.PeD.CreateBox("debrisSource",{size:u.pieceSize},e);f.material=p,f.isVisible=!1;const g=[],m=[];function h(){const e=g.find(e=>!e.active);if(e)return e;if(g.length<u.maxActiveDebris){const e=f.createInstance(`debris_${g.length}`);e.isVisible=!1;const t={mesh:e,active:!1,velocity:v.Pq0.Zero(),rotationSpeed:v.Pq0.Zero()};return g.push(t),t}return null}function b(e,t,n){const o=Y.cubeSize/2;for(let a=0;a<u.piecesPerCube;a++){const a=h();if(!a)break;const i=(Math.random()-.5)*Y.cubeSize*1.5,s=(Math.random()-.5)*Y.cubeSize*1.5,r=(Math.random()-.5)*o;a.mesh.position.set(e+i,t+r,n+s),a.velocity=new v.Pq0(3*i+(Math.random()-.5)*u.randomVelocityRange,30*-Math.random(),3*s+(Math.random()-.5)*u.randomVelocityRange),a.rotationSpeed=new v.Pq0((Math.random()-.5)*u.randomRotationSpeed,(Math.random()-.5)*u.randomRotationSpeed,(Math.random()-.5)*u.randomRotationSpeed),a.mesh.rotation=new v.Pq0(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2);const l=.5+1*Math.random();a.mesh.scaling.setAll(l),a.mesh.isVisible=!0,a.active=!0,m.push(a)}}const x=new v.YOq("shadowCatcherMat",e);x.albedoColor=new v.v9j(1,1,1),x.roughness=1,x.metallic=0,x.alpha=.95;const y=v.PeD.CreateGround("shadowCatcher",{width:600,height:2e3},e);y.material=x,y.position.y=-Y.cubeSize-50,y.receiveShadows=!0,y.isPickable=!1;const w=e.onBeforeRenderObservable.add(()=>{const t=e.activeCamera;t&&(y.position.x=.3*t.position.x,y.position.z=t.position.z-600)}),S=[],M=new Map;function C(e){return`${e.segmentIndex}_${e.gridX}_${e.gridZ}`}function I(e,t){return e%3==1&&t%3==1}function P(){for(const e of S)e.instance.dispose();S.length=0,M.clear();const e=-Y.roadWidth/2+Y.cubeSize/2,n=-Y.cubeSize/2;let i=0;for(let s=0;s<Y.segmentCount;s++){const r=-s*a,l=0===s?-Y.extraStartRows:0;for(let a=0;a<Y.cubesWide;a++)for(let u=l;u<o;u++){const o=e+a*Y.cubeSize,l=r-u*Y.cubeSize-Y.cubeSize/2,p=u<0,f=((a+u+s)%2==0?c:d).createInstance(`cube_${s}_${a}_${u}`);f.position=new v.Pq0(o,n,l),f.receiveShadows=!0,t.addShadowCaster(f,!0);const g=I(a,u);g&&i++,S.push({instance:f,state:"active",fallVelocity:0,originalY:n,gridX:a,gridZ:u,segmentIndex:s,isCellCenter:g,randomFallOffset:100*Math.random(),isSafePath:p})}}!function(){console.log("ðŸ•¸ï¸ Weaving safe path...");const e=new Map;for(const t of S){const n=`${t.segmentIndex}_${t.gridZ}`;e.has(n)||e.set(n,new Map),e.get(n).set(t.gridX,t)}let t=5;for(let n=0;n<Y.segmentCount;n++)for(let a=0;a<o;a++){const o=`${n}_${a}`,i=e.get(o);if(!i)continue;const s=i.get(t);s&&(s.isSafePath=!0);let r=t+(Math.floor(3*Math.random())-1);r<1&&(r=1),r>8&&(r=8),t=r}}(),console.log(`âœ… Created falling cube road: ${S.length} cubes, ${i} cell centers that can fall`)}P();let k=z.getState().lives;const R=z.subscribe(e=>{k=e.lives}),O=e.onBeforeRenderObservable.add(()=>{if("playing"!==z.getState().gameState)return;const t=n();if(0===t)return;const o=e.getEngine().getDeltaTime()/1e3,i=t*o;!function(e,t){for(let n=m.length-1;n>=0;n--){const o=m[n];o.velocity.y-=u.gravity*e,o.velocity.y=Math.max(o.velocity.y,-u.maxSpeed),o.mesh.position.x+=o.velocity.x*e,o.mesh.position.y+=o.velocity.y*e,o.mesh.position.z+=o.velocity.z*e+t,o.mesh.rotation.x+=o.rotationSpeed.x*e,o.mesh.rotation.y+=o.rotationSpeed.y*e,o.mesh.rotation.z+=o.rotationSpeed.z*e,(o.mesh.position.y<-200||o.mesh.position.z>100)&&(o.active=!1,o.mesh.isVisible=!1,m.splice(n,1))}}(o,i);const s=Y.segmentCount*a;let r=1/0;for(const e of S)e.instance.position.z<r&&(r=e.instance.position.z);for(const e of S){e.instance.position.z+=i;const t=2*Y.cubeSize,n=5*Y.cubeSize,a=4.5,r=t+2*Math.abs(e.gridX-a),l=!1;if(!l&&e.instance.position.z>r&&"active"===e.state&&(e.state="falling",b(e.instance.position.x,e.instance.position.y,e.instance.position.z),e.instance.isVisible=!1),e.instance.position.z>n&&(e.instance.position.z-=s,"active"!==e.state&&(e.state="active",e.fallVelocity=0,e.instance.position.y=e.originalY,e.instance.isVisible=!0,M.delete(C(e)))),"falling"===e.state&&(e.fallVelocity=Math.min(e.fallVelocity+Y.fallGravity*o,Y.fallMaxSpeed),e.instance.position.y-=e.fallVelocity*o,!(e.instance.position.z>t)&&e.instance.position.y<e.originalY-3*Y.cubeSize&&(e.state="fallen",e.instance.isVisible=!1,M.set(C(e),{x:e.instance.position.x,z:e.instance.position.z}))),"active"===e.state&&!l){const t=e.instance.position.z;if(t>Y.triggerZoneEnd&&t<Y.triggerZoneStart){const t=z.getState(),n=Math.max(1,t.matchDuration),a=n-t.matchTimeRemaining,i=1+1.5*Math.min(1,a/n),s=Y.fallProbabilityPerSecond*i*o;if(Math.random()<s&&E(e)){e.state="falling",e.fallVelocity=0;const t=Math.random();let n=[[0,0]];t>.4&&(Math.random()>.5?n.push([1,0]):n.push([0,1])),t>.7&&n.push([1,1]),t>.9&&(n.some(([e,t])=>1===e&&0===t)||n.push([1,0]),n.some(([e,t])=>0===e&&1===t)||n.push([0,1]));for(const[t,o]of n){if(0===t&&0===o)continue;const n=e.gridX+t,a=e.gridZ+o,i=S.find(t=>t.gridX===n&&t.gridZ===a&&t.segmentIndex===e.segmentIndex&&"active"===t.state);i&&T(i)&&(i.state="falling",i.fallVelocity=0)}}}}}});function E(e){if(i&&i(e.instance.position.x,e.instance.position.z,Y.cubeSize))return!1;if(e.gridX<1||e.gridX>8)return!1;if(e.isSafePath)return!1;if(e.gridZ%6!=0)return!1;let t=0;for(const n of S)n.gridZ===e.gridZ&&n.segmentIndex===e.segmentIndex&&("falling"!==n.state&&"fallen"!==n.state||t++);return!(t>=1)}function T(e){return!(i&&i(e.instance.position.x,e.instance.position.z,Y.cubeSize)||e.gridX<1||e.gridX>8||e.isSafePath)}return{getGapBoundingBoxes:function(){const e=[],t=Y.cubeSize/2;for(const[,n]of M)e.push({min:new v.Pq0(n.x-t,-100,n.z-t),max:new v.Pq0(n.x+t,0,n.z+t)});return e},isOverGap:function(e,t){for(const n of S)if("fallen"===n.state){const o=Math.abs(e-n.instance.position.x),a=Math.abs(t-n.instance.position.z);if(o<8&&a<8)return!0}return!1},reset:function(){for(const e of S)e.state="active",e.fallVelocity=0,e.instance.position.y=e.originalY,e.instance.isVisible=!0;M.clear(),console.log("ðŸ”„ Falling cube road reset")},rebuild:function(e){console.log(`ðŸ› ï¸ Rebuilding road with target length: ${e}`),o=Math.round(e/Y.cubeSize),a=o*Y.cubeSize,console.log(`   -> New dimensions: ${o} cubes long = ${a} units`),P()},fillGapAt:function(e,t){const n=Y.cubeSize;for(const o of S)if("fallen"===o.state){const a=Math.abs(e-o.instance.position.x),i=Math.abs(t-o.instance.position.z);if(a<n&&i<n)return console.log("ðŸ©¹ Repairing road gap under player"),o.state="active",o.fallVelocity=0,o.instance.position.y=o.originalY,o.instance.isVisible=!0,void M.delete(C(o))}},setObstacleChecker:e=>{i=e},dispose:function(){e.onBeforeRenderObservable.remove(O),e.onBeforeRenderObservable.remove(w),R();for(const e of S)e.instance.dispose();S.length=0,r.dispose(),s.dispose(),y.dispose(),x.dispose(),M.clear();for(const e of g)e.mesh.dispose();g.length=0,m.length=0,f.dispose(),p.dispose(),console.log("ðŸ—‘ï¸ Falling cube road disposed")}}}(e,t,a),r=function(e,t,n,o,a){const i=[],s=[];let r=160,l=0;const c=function(e){const t="groundPBR";if(E.has(t))return E.get(t);const n=new v.YOq(t,e);return n.albedoColor=T.ground.albedoColor,n.metallic=T.ground.metallic,n.roughness=T.ground.roughness,E.set(t,n),n.freeze(),n}(e),d={offset:0};function u(e){e.uScale=1,e.vScale=Math.max(1,4),e.wrapU=v.gPd.CLAMP_ADDRESSMODE,e.wrapV=v.gPd.WRAP_ADDRESSMODE}const{packagedTex:p,dynamicTex:f}=function(){const t=`${o}fallback-road-texture.png`,n=new v.gPd(t,e,void 0,!1,v.gPd.TRILINEAR_SAMPLINGMODE),a=new v.RCS("roadDyn",{width:1024,height:1024},e,!1),i=a.getContext();if(i){const e=1024;i.fillStyle="#201f2b",i.fillRect(0,0,e,e),i.fillStyle="#14131d",i.fillRect(0,.08*e,e,.84*e),i.fillStyle="#fcd75a";const t=Math.round(.005*e),n=Math.round(.01*e),o=Math.round(1*n),a=(e-t)/2;for(let s=0;s<e;s+=n+o)i.fillRect(a,s,t,n)}return a.update(!1),n.onLoadObservable.addOnce(()=>{u(n),c.albedoTexture=n}),{packagedTex:n,dynamicTex:a}}();c.albedoTexture=f,u(f);let g=f;function m(t,n){const o=v.PeD.CreateGround(`ground-${t}`,{width:350,height:n},e);return o.material=c,o.receiveShadows=!0,o.position.z=-t*n,o.isVisible=!1,o}function h(e,t){i.forEach(e=>e.dispose()),i.length=0,r=e;for(let n=0;n<t;n++){const t=m(n,e);i.push(t)}d.offset=0,u(g)}h(r,2);const b=Array.from({length:10},(e,t)=>`b${t+1}.glb`),x=new Map;function y(n,o,a,i){const s=new v.VR0(o,e);return s.parent=n,s.rotation=new v.Pq0(0,a,0),i.forEach(e=>{const n=e.createInstance(`${e.name}-${o}`);n.parent=s,function(e,t){const n=x.get(t);n&&(e.position=n.pos.clone(),e.scaling=n.scale.clone(),n.rotQ?(e.rotationQuaternion=n.rotQ.clone(),e.rotation=v.Pq0.Zero()):n.rot&&(e.rotation=n.rot.clone(),e.rotationQuaternion=null))}(n,e),n.receiveShadows=!0,t.addShadowCaster(n,!0)}),s}Promise.all(b.map(t=>v.cng.ImportMeshAsync(null,n,t,e).then(e=>e.meshes.filter(e=>e instanceof v.eaF)))).then(t=>{const n=t.flat();if(0===n.length)return;n.forEach(t=>{var n,o,a,i;if(t.scaling=t.scaling.scale(8),x.set(t,{pos:t.position.clone(),rot:null!==(o=null===(n=t.rotation)||void 0===n?void 0:n.clone())&&void 0!==o?o:null,rotQ:null!==(i=null===(a=t.rotationQuaternion)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,scale:t.scaling.clone()}),!(t.material instanceof v.YOq)){const n=t.material,o=function(e,t){const n="buildingPBR_"+(t?`${t.r.toFixed(2)}_${t.g.toFixed(2)}_${t.b.toFixed(2)}`:"default");if(E.has(n))return E.get(n);const o=new v.YOq(n,e);return o.albedoColor=null!=t?t:v.v9j.White(),o.metallic=T.building.metallic,o.roughness=T.building.roughness,E.set(n,o),o.freeze(),o}(e,null==n?void 0:n.diffuseColor);t.material=o}t.isVisible=!1,t.setEnabled(!1)});const o=new v.VR0("buildSeg-0",e);function i(e,t){e.position=new v.Pq0(0,3,-t*l),s.push(e)}y(o,"B_A0",0,n).position.x=-90,y(o,"B_B0",Math.PI,n).position.x=90,o.getHierarchyBoundingVectors(),l=1050,a&&a(l),h(l,2),i(o,0);for(let t=1;t<2;t++){const o=new v.VR0(`buildSeg-${t}`,e);y(o,`B_A${t}`,0,n).position.x=-90,y(o,`B_B${t}`,Math.PI,n).position.x=90,i(o,t)}}).catch(e=>console.error("Buildings load error:",e));const w=[],S=1050,M=new v.YOq("sidewalkMat",e);M.albedoColor=new v.v9j(.4,.4,.4),M.roughness=1,M.metallic=0,M.freeze(),function(){const t=v.PeD.CreateBox("sidewalkBase",{width:100,height:5,depth:S},e);t.material=M,t.receiveShadows=!0,t.isVisible=!1,t.isVisible=!1;for(let e=0;e<4;e++){const n=t.createInstance(`sidewalk_left_${e}`);n.position.set(-125,.5,-e*S),n.checkCollisions=!1,w.push(n);const o=t.createInstance(`sidewalk_right_${e}`);o.position.set(125,.5,-e*S),o.checkCollisions=!1,w.push(o)}}(),function(){const t=new v.YOq("roadExtensionMat",e);t.albedoColor=new v.v9j(.08,.075,.11),t.roughness=.9,t.metallic=0,t.freeze();const n=v.PeD.CreateBox("roadExtension",{width:150,height:1,depth:3e3},e);n.material=t,n.position.set(0,-.5,-2550),n.receiveShadows=!0,n.isPickable=!1,n.freezeWorldMatrix();const o=new v.FUi("stripeMat",e);o.diffuseColor=new v.v9j(1,.84,.35),o.emissiveColor=new v.v9j(.2,.17,.07),o.freeze();const a=v.PeD.CreateBox("stripeBase",{width:2,height:.1,depth:25},e);a.material=o,a.isVisible=!1,a.isPickable=!1;const i=Math.floor(50);for(let e=0;e<i;e++){const t=a.createInstance(`stripe_${e}`);t.position.set(0,.1,-1080-60*e),t.isPickable=!1,t.freezeWorldMatrix()}}();const C=[],I=[],P=new v.YOq("roadMarkerMat",e);return P.albedoColor=new v.v9j(1,.85,.1),P.emissiveColor=new v.v9j(.3,.25,0),P.roughness=.6,P.metallic=0,P.freeze(),function(){const t=Math.ceil(100),n=v.PeD.CreateBox("markerBase",{width:1.5,height:.2,depth:8},e);n.material=P,n.receiveShadows=!0,n.isVisible=!1,n.isVisible=!1;for(let e=0;e<t;e++){const t=n.createInstance(`roadMarker_${e}`);t.position.set(0,.1,20*-e),I.push(t)}}(),{groundSegments:i,buildingSegments:s,groundSpacing:r,buildingSpacing:l,getRoadOffset:()=>d.offset,setRoadOffset:e=>{d.offset=e%1,d.offset<0&&(d.offset+=1)},updateRoadTextureOffset:()=>{g.vOffset=d.offset},advanceGround:function(e){for(const t of i)t.position.z+=e;let t=1/0;for(const e of i)e.position.z<t&&(t=e.position.z);for(const e of i)e.position.z>r&&(e.position.z=t-r)},advanceBuildings:function(e){for(const t of s)t.position.z+=e;let t=1/0;for(const e of s)e.position.z<t&&(t=e.position.z);for(const e of s)e.position.z>l&&(e.position.z=t-l);for(const t of w)t.position.z+=e;let n=1/0;for(const e of w)e.position.z<n&&(n=e.position.z);for(const e of w)e.position.z>S&&(e.position.z=n-S);for(const t of I)t.position.z+=e;let o=1/0;for(const e of I)e.position.z<o&&(o=e.position.z);for(const e of I)e.position.z>20&&(e.position.z=o-20);for(const t of C)t.position.z+=e;let a=1/0;for(const e of C)e.position.z<a&&(a=e.position.z);for(const e of C)e.position.z>160&&(e.position.z=a-160)},rebuildGround:h,dispose:function(){i.forEach(e=>e.dispose()),s.forEach(e=>e.dispose()),w.forEach(e=>e.dispose()),I.forEach(e=>e.dispose()),C.forEach(e=>e.dispose()),M.dispose(),P.dispose(),f.dispose(),p.dispose(),g.dispose()}}}(e,t,n,o,e=>{console.log(`ðŸ—ï¸ World spacing ready: ${e}, rebuilding road...`),s.rebuild(e)}),l=function(e,t,n){let o=null;return o=e.onBeforeRenderObservable.add(()=>{const o=z.getState().gameState,a=n();if("playing"!==o&&!("gameover"===o&&a<0))return;const i=e.getEngine().getDeltaTime()/1e3;if(0===a)return;const s=a*i;t.advanceGround(s),t.advanceBuildings(s);const r=t.getRoadOffset()-s/t.groundSpacing;t.setRoadOffset(r),t.updateRoadTextureOffset()}),{dispose:function(){o&&(e.onBeforeRenderObservable.remove(o),o=null)}}}(e,r,a),c=function(e,t,n,o={}){var a,i,s;const r=null!==(a=o.spawnZ)&&void 0!==a?a:-520,l=null!==(i=o.despawnZ)&&void 0!==i?i:200,c=null!==(s=o.laneWidth)&&void 0!==s?s:25,d=new v.VR0("coins_root",e),u=[],p=[];let f=!1;const g=[];let m=null,h=null,b=null,x=null;function y(){var n,o;const a=u.find(e=>!e.active);if(a){if(a.active=!0,a.mesh.setEnabled(!0),a.mesh instanceof v.eaF){const e=null===(o=(n=a.mesh).getChildMeshes)||void 0===o?void 0:o.call(n,!1);e&&e.forEach(e=>e.setEnabled(!0))}return a}const i=function(){if(u.length>0){const e=u[0].mesh.createInstance(`coin_${u.length}`);return e.parent=d,e.checkCollisions=!1,e}if(!h||!b)return null;const n=v.PeD.CreateCylinder("coin_source",{diameter:7.5,height:1.2,tessellation:32,cap:v.eaF.CAP_ALL,faceUV:[new v.IUQ(0,0,1,1),new v.IUQ(1,0,0,1),new v.IUQ(0,0,1,1)]},e);n.parent=d,n.rotation.x=Math.PI/2;const o=new v.FrY("coinMultiMat",e);o.subMaterials.push(b),o.subMaterials.push(h),o.subMaterials.push(h),n.material=o,n.subMeshes=[];const a=n.getTotalVertices();return new v.KOo(0,0,a,0,192,n),new v.KOo(1,0,a,192,96,n),new v.KOo(2,0,a,288,96,n),t.addShadowCaster(n,!0),n.receiveShadows=!0,console.log("ðŸª™ Created source coin mesh"),n}();if(!i)return null;const s={mesh:i,active:!0,rotationSpeed:3};return u.push(s),s}function w(e,t,n=1,o=10){const a=e*c;for(let e=0;e<n;e++){const n=r+e*o;if(m&&m(a,n,15)){console.log(`ðŸª™ Skipped coin at (${a}, ${n}) - obstacle intersection`);continue}const i=y();i&&(i.mesh.position.set(a,5+t,n),p.push(i))}}function S(e,t){if(0===t)return;const n=t*e;for(let t=p.length-1;t>=0;t--){const o=p[t];o.mesh.position.z+=n,o.mesh.rotation.y+=o.rotationSpeed*e,o.mesh.position.z>l&&(o.active=!1,o.mesh.setEnabled(!1),p.splice(t,1))}}!function(){h=new v.YOq("coinFaceMat",e),x=new v.gPd("/scene/assets/model/coin/bitcoin_face.png",e),h.albedoTexture=x,h.metallic=.85,h.roughness=.3,h.emissiveColor=new v.v9j(.4,.32,.05),h.emissiveIntensity=.8,b=new v.YOq("coinEdgeMat",e),b.albedoColor=new v.v9j(1,.84,0),b.metallic=.9,b.roughness=.25,b.emissiveColor=new v.v9j(.25,.2,.02),b.emissiveIntensity=.4,f=!0,console.log("ðŸª™ Coin materials initialized");for(const e of g)w(e.laneIndex,e.yOffset,e.count,e.spacing);g.length=0}();const M=e.onBeforeRenderObservable.add(()=>{const t=z.getState().gameState,o=n();("playing"===t||"gameover"===t&&o<0)&&S(e.getEngine().getDeltaTime()/1e3,o)});return{spawnCoin:function(e,t,n=1,o=10){f?w(e,t,n,o):g.push({laneIndex:e,yOffset:t,count:n,spacing:o})},update:S,checkCollisions:function(e){let t=0;const n=2.5;for(let o=p.length-1;o>=0;o--){const a=p[o],i=a.mesh.position,s=i.x-n,r=i.x+n,l=i.y-n,c=i.y+n,d=i.z-n,u=i.z+n;!(e.max.x<s||e.min.x>r||e.max.y<l||e.min.y>c||e.max.z<d||e.min.z>u)&&(a.active=!1,a.mesh.setEnabled(!1),p.splice(o,1),t++)}return t},dispose:function(){M&&e.onBeforeRenderObservable.remove(M),u.forEach(e=>e.mesh.dispose()),d.dispose()},reset:function(){for(const e of p)e.active=!1,e.mesh.setEnabled(!1);p.length=0,console.log("Coin system reset")},isReady:()=>f,setObstacleChecker:function(e){m=e}}}(e,t,a),d=function(e,t,n){const o=new v.VR0("roadside_cars_root",e),a=[],i=[],s=[];let r=!1;const l=["red_car.glb","green_car.glb","flame_car.glb","white_car.glb"].map(t=>{const n=`scene/assets/model/roadside/${t}`;return v.cng.LoadAssetContainerAsync("",n,e,null,".glb").then(e=>{a.push(e),console.log(`âœ… Loaded roadside car: ${t}`)}).catch(e=>{console.warn(`Failed to load car ${t}:`,e)})});function c(){let e=-600;for(;e<-100;)d(e),e+=200+200*Math.random()}function d(e){let n=s.find(e=>!e.active);if(!n){const e=function(){if(0===a.length)return null;const e=a[Math.floor(Math.random()*a.length)].instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];return e?(e.parent=o,t.addShadowCaster(e,!0),e.getChildMeshes().forEach(e=>{e.receiveShadows=!0}),e):null}();if(!e)return;n={mesh:e,active:!1},s.push(n)}const r=Math.random()<.5?-50:50,l=-50===r?0:Math.PI;n.mesh.position.set(r,-5,e),n.mesh.rotation=new v.Pq0(0,l,0),n.mesh.setEnabled(!0),n.active=!0,i.push(n)}function u(e){const t=z.getState().gameState,o=n();if("playing"!==t&&!("gameover"===t&&o<0))return;if(0===o)return;const a=o*e;for(const e of i)e.mesh.position.z+=a;for(let e=i.length-1;e>=0;e--){const t=i[e];t.mesh.position.z>100&&(t.active=!1,t.mesh.setEnabled(!1),i.splice(e,1))}if(o>0&&r){let e=0;for(const t of i)t.mesh.position.z<e&&(e=t.mesh.position.z);e>-400&&d(e-(200+200*Math.random()))}}Promise.all(l).then(()=>{r=a.length>0,r&&(console.log(`âœ… Roadside cars ready (${a.length} variants)`),c())});const p=e.onBeforeRenderObservable.add(()=>{u(e.getEngine().getDeltaTime()/1e3)});return{update:u,dispose:()=>{e.onBeforeRenderObservable.remove(p),s.forEach(e=>e.mesh.dispose()),a.forEach(e=>e.dispose()),o.dispose()},reset:function(){for(const e of i)e.active=!1,e.mesh.setEnabled(!1);i.length=0,r&&c()}}}(e,t,a),u=U(e,t,a,c,{laneWidth:25,laneCount:3},i);return s.setObstacleChecker((e,t,n)=>u.isGroundLocked(e,t,n)),c.setObstacleChecker((e,t,n)=>u.hasObstacleAt(e,t,n)),{dispose:function(){u.dispose(),c.dispose(),d.dispose(),s.dispose(),l.dispose(),r.dispose()},obstacleController:u,coinController:c,fallingCubeRoadController:s}}v.gSV&&(v.gSV.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});var W=n(74848),X=n(5338);const Z=()=>{const e=z(e=>e.isLoading),t=z(e=>e.dismissIntroScreen);return(0,W.jsx)("div",{className:"loading-screen",children:e?(0,W.jsxs)("div",{className:"loading-indicator",children:[(0,W.jsx)("div",{className:"loading-spinner"}),(0,W.jsx)("div",{className:"loading-text",children:"Loading..."})]}):(0,W.jsx)("button",{className:"start-button",onClick:()=>{t(),window.dispatchEvent(new KeyboardEvent("keydown",{code:"Space",key:" "}))},"aria-label":"Start Game",children:"PLAY"})})},K=()=>{const e=z(e=>e.countdownValue);if(null===e)return null;const t=0===e?"GO!":e.toString(),n=0===e;return(0,W.jsx)("div",{className:"countdown-overlay",children:(0,W.jsx)("div",{className:"countdown-number "+(n?"countdown-go":""),children:t},e)})},H=()=>(0,W.jsxs)("div",{className:"outro-screen",children:[(0,W.jsx)("video",{src:"/DanceOutro.webm",autoPlay:!0,muted:!0,playsInline:!0,style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none",transform:"translate(calc(-50% + 0px), calc(-50% + 150px)) scale(0.6)"}}),(0,W.jsx)("img",{src:"/PlayAgainButton.png",alt:"Restart",onClick:()=>window.location.reload(),style:{position:"absolute",top:"50px",left:"50%",transform:"translateX(-50%)",width:"400px",height:"auto",cursor:"pointer",zIndex:10,pointerEvents:"auto"}})]}),Q=()=>{const e=z(e=>e.showIntroScreen),t=z(e=>e.coinCount),n=z(e=>e.lives),o=z(e=>e.gameState),a=z(e=>e.activePowerUps),i=z(e=>e.matchTimeRemaining),s=z(e=>e.isMatchTimerActive);return e?(0,W.jsx)(Z,{}):(0,W.jsxs)("div",{className:"game-overlay-container",children:[!1,(0,W.jsx)(K,{}),(0,W.jsxs)("div",{className:"top-hud",children:[(0,W.jsxs)("div",{className:"lives-container",children:[(0,W.jsx)("span",{className:"lives-label",children:"Lives:"}),(0,W.jsxs)("div",{className:"hearts-container",children:[Array.from({length:Math.max(0,n)}).map((e,t)=>(0,W.jsx)("span",{className:"heart",children:"â¤ï¸"},t)),Array.from({length:Math.max(0,3-n)}).map((e,t)=>(0,W.jsx)("span",{className:"empty-heart",children:"ðŸ–¤"},`empty-${t}`))]})]}),(0,W.jsxs)("div",{className:"coin-counter",children:[(0,W.jsx)("span",{className:"coin-icon",children:"ðŸŸ¡"}),(0,W.jsx)("span",{className:"coin-count",children:t})]})]}),s&&(0,W.jsxs)("div",{className:"match-timer "+(i<=10?"timer-warning":""),children:["â±ï¸ ",(r=i,`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`)]}),a.length>0&&(0,W.jsx)("div",{className:"powerups-container",children:a.map(e=>(0,W.jsxs)("div",{className:"powerup-icon",children:["âš¡ ",e.type]},e.type))}),"gameover"===o&&(0,W.jsxs)("div",{className:"gameover-overlay",children:[(0,W.jsx)("div",{className:"gameover-text",children:i<=0?"TIME'S UP!":"GAME OVER"}),(0,W.jsx)("div",{className:"gameover-subtext",children:"Press R to restart"}),(0,W.jsx)("button",{className:"reset-button",onClick:()=>{window.location.reload()},style:{marginTop:"20px",padding:"8px 16px",fontSize:"14px",backgroundColor:"rgba(255, 50, 50, 0.9)",color:"white",border:"2px solid rgba(255, 255, 255, 0.5)",borderRadius:"8px",cursor:"pointer",pointerEvents:"auto",textShadow:"1px 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},children:"ðŸ”„ Restart"})]}),"victory"===o&&(0,W.jsx)(H,{})]});var r};window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("game-canvas");e?(function(){const e=document.getElementById("game-canvas");if(!(e&&e instanceof HTMLCanvasElement))return void console.error("âŒ Canvas not found - cannot initialize React overlay");const t=document.createElement("div");t.id="react-overlay";const n=()=>{const n=e.getBoundingClientRect();t.style.top=`${n.top}px`,t.style.left=`${n.left}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`};n(),document.body.appendChild(t),new ResizeObserver(()=>{n()}).observe(e),window.addEventListener("resize",n),(0,X.H)(t).render((0,W.jsx)(S.StrictMode,{children:(0,W.jsx)(Q,{})})),console.log("âœ… React overlay initialized and synced with canvas")}(),function(e){if(!e)return;let t=null;const n=()=>{if(!t)return;const n=Math.max(1,e.height/1080);t.setHardwareScalingLevel(Math.min(2.5,n))},o=()=>{const o=9/16,a=window.innerWidth;let i=window.innerHeight,s=i*o;s>a&&(s=a,i=s/o),e.width=s,e.height=i,e.style.width=`${s}px`,e.style.height=`${i}px`,null==t||t.resize(),n()};o(),e.addEventListener("contextmenu",e=>{e.preventDefault()});const{engine:a,scene:i}=function(e){const t=new v.N$8(e,!0);v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.NoneLogLevel;const n=new v.Z58(t);return n.skipPointerMovePicking=!0,n.skipPointerDownPicking=!0,n.skipPointerUpPicking=!0,n.environmentTexture=v.b4q.CreateFromPrefilteredData("https://assets.babylonjs.com/environments/environmentSpecular.env",n),n.environmentIntensity=.4,n.clearColor=new v.ov8(1,1,1,1),{engine:t,scene:n}}(e);t=a,n();const{shadowGenerator:s}=function(e){const t=new v.g4z("hemilight",new v.Pq0(0,1,0),e);t.intensity=.2;const n=new v.ZyN("dirLight",new v.Pq0(-.5,-1,.5),e);n.position=new v.Pq0(20,40,-30),n.intensity=2;const o=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),a=o?1024:2048,i=new v.crD(a,n);return i.numCascades=o?2:4,i.lambda=.9,i.cascadeBlendPercentage=.1,i.stabilizeCascades=!0,i.shadowMaxZ=500,i.autoCalcDepthBounds=!0,i.usePercentageCloserFiltering=!0,i.filteringQuality=v.owA.QUALITY_MEDIUM,i.bias=.001,i.normalBias=.02,{hemisphericLight:t,directionalLight:n,shadowGenerator:i,setDirectionalLightIntensity:e=>{n.intensity=e}}}(i),{camera:r}=function(e,t){const n=localStorage.getItem("camera_alpha"),o=localStorage.getItem("camera_beta"),a=localStorage.getItem("camera_radius"),i=localStorage.getItem("camera_target_x"),s=localStorage.getItem("camera_target_y"),r=localStorage.getItem("camera_target_z"),l=localStorage.getItem("camera_fov"),c=n?parseFloat(n):1.57,d=o?parseFloat(o):1.02,u=a?parseFloat(a):68.41,p=i?parseFloat(i):-1.6,f=s?parseFloat(s):-10.4,g=r?parseFloat(r):-1.7,m=l?parseFloat(l):1.5,h=new v.Lqh("camera",c,d,u,new v.Pq0(p,f,g),e);h.fov=m,"true"===new URLSearchParams(window.location.search).get("debug")?(h.attachControl(t,!0),console.log("ðŸ“· Camera controls ENABLED (Debug Mode)")):console.log("ðŸ“· Camera controls LOCKED (Normal Mode)");const b=h.inputs.attached.mouse;return b&&(b.useCtrlForPanning=!1,b.buttons=[0,1,2],b.panningMouseButton=2),h.inputs.removeByType("ArcRotateCameraKeyboardMoveInput"),h.keysUp=[],h.keysDown=[],h.keysLeft=[],h.keysRight=[],h.lowerRadiusLimit=20,h.upperRadiusLimit=200,h.panningSensibility=50,h.panningAxis=new v.Pq0(1,1,0),{camera:h}}(i,e),{assetBase:l,modelRoot:c,textureRoot:d}=function(){const e="undefined"!=typeof window?window.location.hostname:"",t=e.endsWith("github.io")||e.endsWith("vercel.app")||e.endsWith(".vercel.app")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/":"scene/assets/";return{assetBase:t,modelRoot:`${t}model/`,textureRoot:`${t}road/`}}(),{skyDome:u}=function(e,t){const n=v.PeD.CreateSphere("skyDome",{diameter:5e3,segments:32,sideOrientation:v.eaF.BACKSIDE},e),o=new v.FUi("skyMat",e),a=new v.gPd(`${t}sky_clouds.jpg`,e,!1,!1,v.gPd.TRILINEAR_SAMPLINGMODE);return a.uScale=8,a.vScale=4,o.diffuseTexture=a,o.emissiveTexture=a,o.emissiveColor=new v.v9j(.5,.5,.5),o.specularColor=new v.v9j(0,0,0),o.backFaceCulling=!1,o.disableLighting=!0,n.material=o,n.isPickable=!1,n.infiniteDistance=!0,n.position.y=-500,e.onBeforeRenderObservable.add(()=>{n.rotation.y+=3e-4*e.getAnimationRatio()}),{skyDome:n,skyMaterial:o,cloudTexture:a}}(i,l);u.isVisible=!0;let p=0,f=!1,g=!1;function m(){f&&g&&(console.log("âœ… All assets loaded - ready to start when user taps"),z.getState().setLoading(!1))}let h=!1;z.subscribe(e=>{if(!e.showIntroScreen&&!e.isLoading&&!h){h=!0,console.log("ðŸŽ¬ User tapped start - beginning countdown");const e=[3,2,1,0];let t=0;const n=()=>{z.getState().setCountdown(e[t]),t++,t<e.length?setTimeout(n,1e3):setTimeout(()=>{z.getState().setCountdown(null),console.log("ðŸƒ Starting game after countdown"),y.startGame(),z.getState().startMatchTimer(),console.log("â±ï¸ Match timer started (2 minutes)")},500)};n()}});const b=q(i,s,c,d,()=>p*(()=>{const e=z.getState(),t=Math.max(1,e.matchDuration),n=t-e.matchTimeRemaining;return 1+.5*Math.min(1,n/t)})(),()=>{g=!0,console.log("âœ… Obstacles ready"),m()}),x=function(){let e=0;function t(t){e=t,z.getState().updateCoinCount(e)}const n=n=>{const o=n.detail.count;t(e+o)};return window.addEventListener("coinCollected",n),{updateCoinCount:t,dispose:function(){window.removeEventListener("coinCollected",n)}}}(),y=O(i,r,c,s,e=>p=e,b.obstacleController,b.coinController,b.fallingCubeRoadController,()=>{f=!0,console.log("âœ… Player ready"),m()});t.runRenderLoop(()=>{y.ensureIdle(),i.render()});const w=()=>o(),S=e=>y.handleKeyDown(e),M=e=>y.handleKeyUp(e),C=e=>y.handleTouchStart(e),I=e=>y.handleTouchMove(e),P=e=>y.handleTouchEnd(e),k=e=>y.handlePointerDown(e),R=e=>y.handlePointerUp(e);window.addEventListener("resize",w);const E={};window.addEventListener("keydown",e=>{if(E[e.key]=!0,e.shiftKey&&"KeyC"===e.code){e.preventDefault(),e.stopPropagation(),console.log("ðŸ“¸ CAMERA CAPTURE (Saving to LocalStorage)..."),localStorage.setItem("camera_alpha",r.alpha.toString()),localStorage.setItem("camera_beta",r.beta.toString()),localStorage.setItem("camera_radius",r.radius.toString()),localStorage.setItem("camera_target_x",r.target.x.toString()),localStorage.setItem("camera_target_y",r.target.y.toString()),localStorage.setItem("camera_target_z",r.target.z.toString()),localStorage.setItem("camera_fov",r.fov.toString());const t={alpha:parseFloat(r.alpha.toFixed(2)),beta:parseFloat(r.beta.toFixed(2)),radius:parseFloat(r.radius.toFixed(2)),targetX:parseFloat(r.target.x.toFixed(1)),targetY:parseFloat(r.target.y.toFixed(1)),targetZ:parseFloat(r.target.z.toFixed(1)),fov:parseFloat(r.fov.toFixed(2))},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="camera-settings.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o);const i=`export const CAMERA_DEFAULTS = {\n    alpha: ${r.alpha.toFixed(2)},\n    beta: ${r.beta.toFixed(2)},\n    radius: ${r.radius.toFixed(2)},\n    targetX: ${r.target.x.toFixed(1)},\n    targetY: ${r.target.y.toFixed(1)},\n    targetZ: ${r.target.z.toFixed(1)},\n    fov: ${r.fov.toFixed(2)},\n};`;navigator.clipboard.writeText(i).then(()=>{console.log("ðŸ“‹ Camera defaults code copied to clipboard!")}).catch(e=>{console.error("Failed to copy to clipboard:",e)});const s=`âœ… Camera Saved!\nðŸ“ camera-settings.json downloaded (save to project root)\nðŸ“‹ Code copied to clipboard\n\nAlpha: ${r.alpha.toFixed(2)} rad\nBeta: ${r.beta.toFixed(2)} rad\nRadius: ${r.radius.toFixed(2)}\nFOV: ${r.fov.toFixed(2)} rad (${(180*r.fov/Math.PI).toFixed(1)}Â°)\nTarget: (${r.target.x.toFixed(1)}, ${r.target.y.toFixed(1)}, ${r.target.z.toFixed(1)})`;return console.log(s),void alert(s)}S(e)}),window.addEventListener("keyup",e=>{E[e.key]=!1,M(e)}),window.addEventListener("touchstart",C,{passive:!0}),window.addEventListener("touchmove",I,{passive:!0}),window.addEventListener("touchend",P,{passive:!0}),window.addEventListener("pointerdown",k),window.addEventListener("pointerup",R);let T=!1,L=null,j="idle",_=null;i.onBeforeRenderObservable.add(()=>{const t=z.getState().gameState;if("playing"===t)return void(T||(r.detachControl(),_&&"paused"===j?(r.alpha=_.alpha,r.beta=_.beta,r.radius=_.radius,r.target.copyFrom(_.targetPosition),console.log("ðŸ“· Camera state restored (unpause)")):console.log("ðŸ“· Fresh start - using current camera position"),_=null,L&&(r.lockedTarget=L,L=null),T=!0,console.log("ðŸ”’ Camera Locked (Playing)")));if(T){let t;if(r.lockedTarget){if(r.lockedTarget instanceof v.Pq0)t=r.lockedTarget.clone();else{const e=r.lockedTarget;t=(e.absolutePosition||e.position).clone()}console.log(`ðŸ“ Locking target at: (${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`),L=r.lockedTarget,r.lockedTarget=null,r.setTarget(t)}else t=r.target.clone();_={alpha:r.alpha,beta:r.beta,radius:r.radius,targetPosition:t},console.log(`ðŸ’¾ Camera state saved - Alpha: ${r.alpha.toFixed(2)}, Beta: ${r.beta.toFixed(2)}, Radius: ${r.radius.toFixed(2)}`),r.attachControl(e,!0),T=!1,console.log("ðŸ”“ Camera Unlocked (Not Playing) - Free orbit enabled")}if(j=t,"gameover"===t)return;const n=2.5,o=(r.getDirection(v.Pq0.Forward()),r.getDirection(v.Pq0.Right())),a=r.getDirection(v.Pq0.Up());E.ArrowLeft&&r.target.subtractInPlace(o.scale(n)),E.ArrowRight&&r.target.addInPlace(o.scale(n)),E.ArrowUp&&r.target.addInPlace(a.scale(n)),E.ArrowDown&&r.target.subtractInPlace(a.scale(n))}),window.addEventListener("beforeunload",()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",S),window.removeEventListener("keyup",M),window.removeEventListener("touchstart",C),window.removeEventListener("touchmove",I),window.removeEventListener("touchend",P),window.removeEventListener("pointerdown",k),window.removeEventListener("pointerup",R),b.dispose(),y.dispose(),x.dispose(),v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.AllLogLevel,null==t||t.dispose()}),window.__BABYLON_ENGINE__=t,window.__BABYLON_SCENE__=i}(e)):console.error("âŒ Errore: Canvas #game-canvas non trovato.")})}},e=>{e.O(0,[645,967],()=>e(e.s=98869)),e.O()}]);