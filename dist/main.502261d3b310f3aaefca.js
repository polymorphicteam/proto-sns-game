(self.webpackChunkbabylon_react_916_canvas=self.webpackChunkbabylon_react_916_canvas||[]).push([[792],{10540(e){"use strict";e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},10915(e,n,t){"use strict";var o=t(85072),a=t.n(o),i=t(97825),s=t.n(i),r=t(77659),l=t.n(r),c=t(55056),d=t.n(c),u=t(10540),p=t.n(u),m=t(41113),f=t.n(m),h=t(11249),g={};g.styleTagTransform=f(),g.setAttributes=d(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=p(),a()(h.A,g),h.A&&h.A.locals&&h.A.locals;var v=t(11964);t(57792);const y={Idle:[0,88],Run:[89,109],Strafe_L:[182,201],Strafe_R:[202,221]};function x(e,n){const[t,o]=y[e];return{start:t,end:o,loop:!0,scroll:n}}const b=300,w={Idle:x("Idle",0),Run:x("Run",b),Slide:{start:110,end:154,loop:!1,scroll:b},Jump:{start:155,end:181,loop:!1,scroll:b,allowStrafe:!1},Strafe_L:x("Strafe_L",b),Strafe_R:x("Strafe_R",b),Run_Idle:{start:222,end:248,loop:!1,scroll:0},Fall:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1},Getup:{start:325,end:552,loop:!1,scroll:0,allowStrafe:!1},Death:{start:249,end:324,loop:!1,scroll:0,allowStrafe:!1}},S=new Set(["Slide","Jump","Fall","Getup","Death"]);var M=t(96540);const C=e=>{let n;const t=new Set,o=(e,o)=>{const a="function"==typeof e?e(n):e;if(!Object.is(a,n)){const e=n;n=(null!=o?o:"object"!=typeof a||null===a)?a:Object.assign({},n,a),t.forEach(t=>t(n,e))}},a=()=>n,i={setState:o,getState:a,getInitialState:()=>s,subscribe:e=>(t.add(e),()=>t.delete(e))},s=n=e(o,a,i);return i},I=e=>e,P=e=>{const n=(e=>e?C(e):C)(e),t=e=>function(e,n=I){const t=M.useSyncExternalStore(e.subscribe,M.useCallback(()=>n(e.getState()),[e,n]),M.useCallback(()=>n(e.getInitialState()),[e,n]));return M.useDebugValue(t),t}(n,e);return Object.assign(t,n),t},j={coinCount:0,score:0,lives:3,gameState:"idle",isLoading:!0,countdownValue:null,matchDuration:120,matchTimeRemaining:120,isMatchTimerActive:!1,activePowerUps:[]},T=(E=e=>Object.assign(Object.assign({},j),{updateCoinCount:n=>e({coinCount:n}),incrementCoinCount:n=>e(e=>({coinCount:e.coinCount+n})),resetCoinCount:()=>e({coinCount:0}),decrementLives:()=>e(e=>{const n=Math.max(0,e.lives-1),t=n<=0?"gameover":e.gameState;return console.log(`â¤ï¸ Lives: ${n} | Game State: ${t}`),{lives:n,gameState:t}}),setLives:n=>e({lives:Math.max(0,n)}),addScore:n=>e(e=>({score:e.score+n})),setGameState:n=>{console.log(`ðŸŽ® Game State: ${n}`),e({gameState:n})},activatePowerUp:(n,t)=>e(e=>{const o=Date.now()+t,a={type:n,expiresAt:o},i=e.activePowerUps.filter(e=>e.type!==n);return console.log(`âš¡ Power-up activated: ${n} (expires in ${t}ms)`),{activePowerUps:[...i,a]}}),deactivatePowerUp:n=>e(e=>({activePowerUps:e.activePowerUps.filter(e=>e.type!==n)})),setLoading:n=>{console.log(`â³ Loading: ${n}`),e({isLoading:n})},setCountdown:n=>{e({countdownValue:n})},startMatchTimer:()=>{e(e=>({isMatchTimerActive:!0,matchTimeRemaining:e.matchDuration})),console.log("â±ï¸ Match timer started")},tickMatchTimer:n=>e(e=>{if(!e.isMatchTimerActive)return{};if("playing"!==e.gameState)return{};const t=Math.max(0,e.matchTimeRemaining-n);return t<=0?(console.log("â±ï¸ TIME'S UP! Match ended."),{matchTimeRemaining:0,isMatchTimerActive:!1,gameState:"gameover"}):{matchTimeRemaining:t}}),stopMatchTimer:()=>{e({isMatchTimerActive:!1}),console.log("â±ï¸ Match timer stopped")},resetGame:()=>{console.log("ðŸ”„ Game reset"),e(Object.assign(Object.assign({},j),{isLoading:!1,countdownValue:null}))}}))?P(E):P;var E;let R=0;function L(e,n,t,o,a,i,s,r){const l={forward:!1,slide:!1,jump:!1,leftPressed:!1,rightPressed:!1};let c=null;const d={Digit1:"Idle",Digit2:"Run",Digit3:"Slide",Digit4:"Jump",Digit5:"Run_Idle"};let u=0,p=0,m=!1,f=!1,h=null,g=null,y=0,x=0,b=!1;const M={halfWidth:0,halfDepth:0,standingHeight:0,slideHeight:0,centerOffsetY:0,slideCenterOffsetY:0,initialized:!1};let C=null,I=0,P=!1,j=0;const E={active:!1,velocity:0,gravity:-180,jumpStrength:75};function L(){if(!h||!M.initialized)return null;const e="Slide"===(null==g?void 0:g.currentState),n=e?M.slideHeight:M.standingHeight;let t=e?M.slideCenterOffsetY:M.centerOffsetY;E.active&&(t+=4),e&&(t-=2);const o=new v.Pq0(h.position.x,h.position.y+t,h.position.z),a=.5*n,i={min:new v.Pq0(o.x-M.halfWidth,o.y-a,o.z-M.halfDepth),max:new v.Pq0(o.x+M.halfWidth,o.y+a,o.z+M.halfDepth)};return i}function D(e,n){return!(e.max.x<n.min.x||e.min.x>n.max.x||e.max.y<n.min.y||e.min.y>n.max.y||e.max.z<n.min.z||e.min.z>n.max.z)}function k(e){l.forward=!1,l.slide=!1,l.jump=!1,l.leftPressed=!1,l.rightPressed=!1,c=e,e&&g?g.setPlayerState(e,!0):g&&g.setPlayerState("Idle",!0)}function A(e){if(!h||!g)return;if(!g.canStrafe)return;const n=u;u=Math.min(1,Math.max(-1,u+e)),n!==u&&(p=25*u,e>0?g.setPlayerState("Strafe_R"):g.setPlayerState("Strafe_L"))}!function(e,n,t,o,a){v.cng.ImportMesh(null,t,"player.glb",e,(t,i,s,r)=>{var l,c,d,u;if(0===t.length)return void console.error("No meshes loaded from player.glb");const p=new v.VR0("playerRoot",e);t.forEach(e=>{e.parent=p,e.alwaysSelectAsActiveMesh=!0,e.setEnabled(!0),e instanceof v.eaF&&(e.receiveShadows=!0,o.addShadowCaster(e,!0))});const m=null!==(c=null!==(l=t.find(e=>e instanceof v.eaF&&!!e.skeleton))&&void 0!==l?l:t.find(e=>e instanceof v.eaF))&&void 0!==c?c:null,f=null!==(d=null!=m?m:t[0])&&void 0!==d?d:null;p.position=v.Pq0.Zero(),p.scaling=v.Pq0.One(),p.computeWorldMatrix(!0);const h=s[0]||(null==m?void 0:m.skeleton)||null,{min:g,max:y}=p.getHierarchyBoundingVectors(),x=y.y-g.y,b=x>0?16/x:1;p.scaling=new v.Pq0(b,b,b),p.computeWorldMatrix(!0),p.rotate(v._0v.Y,Math.PI,v.$xS.LOCAL),p.computeWorldMatrix(!0);const{min:w,max:S}=p.getHierarchyBoundingVectors(),M=w.add(S).scale(.5);p.position=new v.Pq0(-M.x,.05-w.y,7.5-M.z),p.computeWorldMatrix(!0),f?n.lockedTarget=f:n.setTarget(p.position.clone());const C=null!==(u=r.find(e=>e.targetedAnimations.length>0))&&void 0!==u?u:null;r.forEach(e=>{e!==C&&e.stop()}),a({playerRoot:p,playerSkeleton:h,playerAnimationGroup:C})},void 0,(e,n,t)=>{console.error("Error loading player.glb:",n,t)})}(e,n,t,o,n=>{h=n.playerRoot,y=h.position.y,x=y;const{min:t,max:o}=n.playerRoot.getHierarchyBoundingVectors(),i=t.subtract(n.playerRoot.position),s=o.subtract(n.playerRoot.position),l=s.x-i.x,c=s.z-i.z,d=s.y-i.y;M.halfWidth=.5*l,M.halfDepth=.5*c,M.standingHeight=d,M.slideHeight=.6*d,M.centerOffsetY=i.y+.5*d,M.slideCenterOffsetY=i.y+.5*M.slideHeight,M.initialized=!0,g=function(e){var n;const{scene:t,playerRoot:o,playerSkeleton:a,animationGroup:i,setScrollSpeed:s}=e;let r="Idle",l=!1,c=!1,d=null,u=null,p=null,m=24;if(i){const e=i.targetedAnimations[0];(null===(n=null==e?void 0:e.animation)||void 0===n?void 0:n.framePerSecond)&&(m=e.animation.framePerSecond)}function f(e,n){if(a){const n=a.getAnimationRange(e);if(n)return{start:n.from,end:n.to}}return{start:n.start,end:n.end}}function h(){d&&p&&(d.onAnimationEndObservable.remove(p),p=null),i&&u&&(i.onAnimationGroupEndObservable.remove(u),u=null),i&&i.stop(),d&&d.stop(),d=null}return a&&Object.keys(w).forEach(e=>{if(!a.getAnimationRange(e)){const{start:n,end:t}=w[e];a.createAnimationRange(e,n,t)}}),{get currentState(){return r},get canStrafe(){return!(!c||"Jump"!==r&&"Fall"!==r)||!1!==w[r].allowStrafe},setPlayerState:function e(n,o=!1){if(!o&&r===n)return;if(!o&&S.has(r))return;const l=w[n],c=f(n,l);if(!a&&!i)return r=n,void s(l.scroll);h(),s(l.scroll);const g=()=>{"Slide"===n?e("Run",!0):"Fall"===n?e("Getup",!0):"Getup"===n?e("Run",!0):"Run_Idle"===n&&e("Idle",!0)};let v=!1;if(i){const e=m/24,n=c.start*e,t=c.end*e;i.reset(),i.start(l.loop,1.5,n,t,!1),v=!0,l.loop||(u=i.onAnimationGroupEndObservable.addOnce(()=>{u=null,g()}))}else a&&(d=t.beginAnimation(a,c.start,c.end,l.loop,1),d&&(v=!0,l.loop||(p=d.onAnimationEndObservable.addOnce(()=>{p=null,g()}))));r=n},setAllowAirStrafe:e=>{c=e},ensureIdle:function(){if(l)return;const e=f("Idle",w.Idle);if(i){const n=m/24;i.reset(),i.start(!0,1,e.start*n,e.end*n,!0),l=!0}else a&&(d=t.beginAnimation(a,e.start,e.end,!0),d&&(l=!0))},pauseAnimation:function(){i&&i.pause(),d&&d.pause()},resumeAnimation:function(){i&&i.play(),d&&d.restart()},dispose:function(){h()}}}({scene:e,playerRoot:n.playerRoot,playerSkeleton:n.playerSkeleton,animationGroup:n.playerAnimationGroup,setScrollSpeed:a}),B(),f&&O(),null==r||r()});const z=()=>"playing"===T.getState().gameState;function O(){f=!0,m=!0,T.getState().setGameState("playing"),g&&g.setPlayerState("Run",!0)}function B(){g&&g.ensureIdle()}function N(){h&&g&&(h.position.y=x,y=x,u=0,p=0,h.position.x=0,m=!1,f=!1,b=!1,E.active=!1,E.velocity=0,P=!1,j=0,I=0,g.setPlayerState("Idle",!0),a(0),console.log("Player controller reset"))}e.onBeforeRenderObservable.add(()=>{if(!h||!g)return;if("paused"===T.getState().gameState)return;const n=T.getState();if(n.isMatchTimerActive&&"playing"===n.gameState){const t=e.getEngine().getDeltaTime()/1e3;n.tickMatchTimer(t)}if("gameover"===n.gameState)return void("Death"!==g.currentState&&(console.log("ðŸŽ® Game Over detected - setting player to Death state"),E.active=!1,E.velocity=0,P=!1,j=0,a(0),g.setPlayerState("Death",!0)));!function(){if(!h||!g)return;if(c)return;const e=g.currentState;"Fall"!==e&&"Getup"!==e&&"Death"!==e&&(l.jump&&!E.active?(g.setPlayerState("Jump"),h&&(E.active||(E.active=!0,E.velocity=E.jumpStrength)),l.jump=!1):l.slide&&g.setPlayerState("Slide"))}();const t=e.getEngine().getDeltaTime()/1e3;if(I=Math.max(0,I-t),P&&(j-=t,j<=0?(P=!1,j=0,a(0),console.log("âœ… Bounce-back effect completed")):a(-240)),h.position.x=v.X5X.Lerp(h.position.x,p,.12),function(){var n,t,o,a,s,r;if(!h)return;if("Fall"===(null==g?void 0:g.currentState)||"Getup"===(null==g?void 0:g.currentState))return void(null==C||C.hide());const l=i.getActivePlatformMeshes().length>0,d=h.position.add(new v.Pq0(0,2,0)),u=new v.RlV(d,new v.Pq0(0,-1,0),40);null==C||C.hide();const p=e.pickWithRay(u,e=>{var n,t,o;return!0===(null===(n=e.metadata)||void 0===n?void 0:n.isCollisionMesh)||"platform"===(null===(t=e.metadata)||void 0===t?void 0:t.obstacleType)||!(!e.parent||"platform"!==(null===(o=e.parent.metadata)||void 0===o?void 0:o.obstacleType))});if((null==p?void 0:p.hit)&&p.pickedPoint&&p.pickedMesh){const e=p.pickedMesh.getBoundingInfo(),i=null==e?void 0:e.boundingBox.minimumWorld,l=null==e?void 0:e.boundingBox.maximumWorld,d=1.5,u=!i||!l||h.position.x>=i.x-d&&h.position.x<=l.x+d,m=!i||!l||h.position.z>=i.z-d&&h.position.z<=l.z+d,f=l.y,v=h.position.y,w=v-f,S=w>=-2&&w<=30;if(p){const e=performance.now();if(e-R>300){R=e,console.log("----- PLATFORM LANDING DEBUG -----"),console.log("Picked Mesh:",null===(n=p.pickedMesh)||void 0===n?void 0:n.name),console.log("isCollisionMesh:",null===(o=null===(t=p.pickedMesh)||void 0===t?void 0:t.metadata)||void 0===o?void 0:o.isCollisionMesh),console.log("PickedPoint Y:",null===(s=null===(a=p.pickedPoint)||void 0===a?void 0:a.y)||void 0===s?void 0:s.toFixed(3)),console.log("Player Y:",h.position.y.toFixed(3));const i=null===(r=p.pickedMesh)||void 0===r?void 0:r.getBoundingInfo();i&&(console.log("bbMinY:",i.boundingBox.minimumWorld.y.toFixed(3)),console.log("bbMaxY:",i.boundingBox.maximumWorld.y.toFixed(3))),console.log("deltaY:",w),console.log("feetY:",v),console.log("platformTopY:",f),console.log("withinX:",u),console.log("withinZ:",m),console.log("platformBelow:",S),console.log("----------------------------------")}}if(u&&m&&S){const e=l.y,n=Math.max(e,x),t=1.5,o=E.active&&E.velocity<=0,a=h.position.y-n<=t;if(!E.active||o&&a)return y=n,h.position.y=Math.max(h.position.y,y),E.active&&(E.active=!1,E.velocity=0,!c&&g&&g.setPlayerState("Run",!0)),void(b=!0)}}if(!l)return b=!1,void(y=x);b?(y=x,(!E.active||E.velocity<=0)&&(E.active=!0,E.velocity=0),b=!1):y=x}(),function(e){h&&(E.active?(E.velocity+=E.gravity*e,h.position.y+=E.velocity*e,h.position.y<=y&&(h.position.y=y,E.active=!1,E.velocity=0,!c&&g&&g.setPlayerState("Run",!0))):h.position.y!==y&&(h.position.y=y))}(t),!c&&"Fall"!==g.currentState&&"Getup"!==g.currentState&&"Death"!==g.currentState&&z()){const n=function(){var e;if(!h||!g)return null;if(I>0)return null;const n=L();if(!n)return null;const t=i.getActiveObstacles();for(const o of t){if(!o.active)continue;const t=o.mesh;t.computeWorldMatrix(!0);const a=(null===(e=o.collisionMeshes)||void 0===e?void 0:e.length)?o.collisionMeshes:[t];for(const e of a){e.computeWorldMatrix(!0);const t=e.getBoundingInfo();if(!t)continue;const a={min:t.boundingBox.minimumWorld,max:t.boundingBox.maximumWorld};if("platform"===o.type){const e=n.min.y>=a.max.y-1.2;if(b||e)continue}if(D(n,a))return o}}return null}();n&&function(n){if(!g)return;const t=g.currentState;"Fall"!==t&&"Getup"!==t&&"Death"!==t&&(function(n){if(P=!0,j=.25,n&&h){const t=h.position.clone();t.y+=3,function(e,n,t,o={}){var a,i,s,r;const l=null!==(a=o.duration)&&void 0!==a?a:.8,c=null!==(i=o.particleCount)&&void 0!==i?i:120,d=null!==(s=o.color1)&&void 0!==s?s:new v.ov8(.6,.55,.5,.6),u=null!==(r=o.color2)&&void 0!==r?r:new v.ov8(.4,.35,.3,.5),p=new v.okU("dustCloud",c,e);p.particleTexture=new v.gPd("https://raw.githubusercontent.com/BabylonJS/Babylon.js/master/packages/tools/playground/public/textures/cloud.png",e);const m=v.PeD.CreateBox("dustEmitter",{size:.1},e);m.position=n.clone(),m.parent=t,m.isVisible=!1,p.emitter=m,p.color1=d,p.color2=u,p.colorDead=new v.ov8(.3,.28,.25,0),p.minSize=3,p.maxSize=7,p.minLifeTime=.4,p.maxLifeTime=l,p.emitRate=400,p.blendMode=v.okU.BLENDMODE_STANDARD,p.minEmitPower=5,p.maxEmitPower=12,p.updateSpeed=.01,p.createCylinderEmitter(2.5,.5,0),p.direction1=new v.Pq0(-1,-.5,-1),p.direction2=new v.Pq0(1,1.5,1),p.gravity=new v.Pq0(0,-5,0),p.start(),setTimeout(()=>{p.stop()},150),setTimeout(()=>{p.dispose(),m.dispose()},1e3*(l+.5)),console.log("ðŸ’¨ Dust cloud VFX created at",n.toString())}(e,t,n.mesh,{duration:.4,particleCount:60})}console.log("ðŸ”™ Bounce-back effect triggered!")}(n),T.getState().decrementLives(),T.getState().lives<=0?(console.log("ðŸ’€ GAME OVER - No lives remaining"),E.active=!1,E.velocity=0,I=4,g.setPlayerState("Death",!0)):(E.active=!1,E.velocity=0,I=4,g.setPlayerState("Fall",!0)))}(n);const t=L();if(t){const e=s.checkCollisions(t);if(e>0){console.log("Collected coins:",e);const n=new CustomEvent("coinCollected",{detail:{count:e}});window.dispatchEvent(n)}}}const o=g.currentState,r=Math.abs(h.position.x-p)<.5;m&&r&&("Strafe_L"===o||"Strafe_R"===o)&&g.setPlayerState("Run")});const _={startX:0,startY:0,startTime:0,isDragging:!1};return{handleKeyDown:function(e){const n=d[e.code];if(n)return e.preventDefault(),void k(n);if("Digit0"===e.code)return e.preventDefault(),void k(null);if("KeyP"===e.code){const e=T.getState();return void("playing"===e.gameState?(e.setGameState("paused"),g&&g.pauseAnimation()):"paused"===e.gameState&&(e.setGameState("playing"),g&&g.resumeAnimation()))}if("KeyR"===e.code)return console.log("ðŸ”„ RESTARTING GAME..."),T.getState().resetGame(),i.reset(),s.reset(),N(),O(),void T.getState().startMatchTimer();if(z())switch(e.code){case"ArrowLeft":case"KeyA":l.leftPressed=!0,A(1);break;case"ArrowRight":case"KeyD":l.rightPressed=!0,A(-1);break;case"ArrowDown":case"KeyS":l.slide=!0;break;case"KeyW":l.jump=!0}},handleKeyUp:function(e){switch(e.code){case"ArrowLeft":case"KeyA":l.leftPressed=!1;break;case"ArrowRight":case"KeyD":l.rightPressed=!1;break;case"ArrowDown":case"KeyS":l.slide=!1;break;case"KeyW":l.jump=!1}},handleTouchStart:function(e){if(!z())return;const n=e.touches[0];n&&(_.startX=n.clientX,_.startY=n.clientY,_.startTime=Date.now(),_.isDragging=!0)},handleTouchMove:function(e){z()&&_.isDragging},handleTouchEnd:function(e){if(!z()||!_.isDragging)return;const n=e.changedTouches[0];if(!n)return;const t=n.clientX-_.startX,o=n.clientY-_.startY,a=Date.now()-_.startTime;_.isDragging=!1;const i=Math.sqrt(t*t+o*o);if(i<50&&a<200)return l.jump=!0,void setTimeout(()=>l.jump=!1,100);i>=50&&a<500&&(Math.abs(t)>Math.abs(o)?A(t>0?-1:1):o<0?(l.jump=!0,setTimeout(()=>l.jump=!1,100)):(l.slide=!0,setTimeout(()=>l.slide=!1,500)))},handlePointerDown:function(n){if(!z())return;const t=e.getEngine().getRenderingCanvas();if(!t)return;const o=t.getBoundingClientRect(),a=n.clientX-o.left,i=n.clientY-o.top,s=o.width,r=o.height,c=a<.33*s,d=a>.66*s;i<.33*r&&!c&&!d?l.jump=!0:i>.66*r&&!c&&!d?l.slide=!0:c?A(1):d&&A(-1)},handlePointerUp:function(e){l.slide=!1,l.jump=!1},startGame:O,ensureIdle:B,dispose:function(){C&&(C.dispose(),C=null)},reset:N}}const D=new Map,k={ground:{albedoColor:new v.v9j(.12,.12,.14),metallic:0,roughness:.9},building:{metallic:0,roughness:1},coin:{albedoColor:new v.v9j(1,.8,0),emissiveColor:new v.v9j(.4,.3,0),metallic:1,roughness:.3},obstacle:{metallic:0,roughness:.9},obstacleGLB:{metallic:0,roughness:.85},hamburger:{metallic:0,roughness:.7}},A={jump:{albedo:new v.v9j(.8,.2,.2),emissive:new v.v9j(.2,.05,.05)},duck:{albedo:new v.v9j(.2,.6,.9),emissive:new v.v9j(.05,.15,.25)},platform:{albedo:new v.v9j(.35,.8,.4),emissive:new v.v9j(.08,.2,.1)},insuperable:{albedo:new v.v9j(.5,.2,.8),emissive:new v.v9j(.1,.05,.2)}};function z(e,n){const t=`obstaclePBR_${n}`;if(D.has(t))return D.get(t);const o=A[n]||A.jump,a=new v.YOq(t,e);return a.albedoColor=o.albedo,a.emissiveColor=o.emissive,a.metallic=k.obstacle.metallic,a.roughness=k.obstacle.roughness,D.set(t,a),a}function O(e,n,t){var o,a;const i=e.material;if(i){if(i instanceof v.YOq){const n=i.metallicTexture||i.microSurfaceTexture,t=i.bumpTexture,o=i.reflectivityTexture||i.reflectionTexture;return console.log(`[MaterialFactory] ${e.name}: metallicRoughness=${!!n}, normal=${!!t}, reflectance=${!!o}`),void(n||(i.metallic=k.obstacleGLB.metallic,i.roughness=k.obstacleGLB.roughness))}if(i instanceof v.FUi){const t=new v.YOq(`${i.name}_unified`,n);i.diffuseTexture&&(t.albedoTexture=i.diffuseTexture),i.bumpTexture&&(t.bumpTexture=i.bumpTexture),i.emissiveTexture&&(t.emissiveTexture=i.emissiveTexture),i.ambientTexture&&(t.ambientTexture=i.ambientTexture),i.specularTexture&&(t.reflectivityTexture=i.specularTexture),t.albedoColor=null!==(o=i.diffuseColor)&&void 0!==o?o:v.v9j.White(),t.emissiveColor=null!==(a=i.emissiveColor)&&void 0!==a?a:v.v9j.Black(),t.metallic=k.obstacleGLB.metallic,t.roughness=k.obstacleGLB.roughness,e.material=t}}}new v.v9j(.85,.55,.25),new v.v9j(.35,.2,.1),new v.v9j(1,.8,.2),new v.v9j(.3,.7,.2),new v.v9j(.9,.2,.15),new v.v9j(.95,.92,.8);class B{static preloadAll(e,n){return t=this,o=void 0,i=function*(){if(this.loaded)return;const t=[];for(const o in n){const a=o,i=n[a];for(const n of i){const o=v.cng.LoadAssetContainerAsync("",n,e,null,".glb").then(e=>{this.cache[a].push({container:e,sourceUrl:n})}).catch(e=>{console.error(`Failed to load obstacle GLB [${a}]: ${n}`,e)});t.push(o)}}yield Promise.all(t),this.loaded=!0,console.log("Obstacle GLBs preloaded:",this.cache)},new((a=void 0)||(a=Promise))(function(e,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function r(e){try{l(i.throw(e))}catch(e){n(e)}}function l(n){var t;n.done?e(n.value):(t=n.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}l((i=i.apply(t,o||[])).next())});var t,o,a,i}static getVariantCount(e){const n=this.cache[e];return n?n.length:0}static getMesh(e,n,t){const o=this.cache[e];if(!o||0===o.length)return null;const a=o.length-1,i="number"==typeof t&&t>=0&&t<=a?t:Math.floor(Math.random()*o.length),{container:s,sourceUrl:r}=o[i],l=s.instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];if(!l)return console.warn(`Empty GLB container for ${e}`),null;const c=l;c.metadata=c.metadata||{},c.metadata.sourceUrl=r,c.position.setAll(0),"duck"===e&&c.scaling.setAll(1.5),"insuperable"===e&&(c.rotation.z=0),function(e,n){O(e,n);const t=e.getChildMeshes(!1);for(const e of t)O(e,n)}(c,n);let d=[];const u=c.getChildMeshes(!1).filter(e=>e.name.toLowerCase().includes("customcollision"));if(c.name&&c.name.toLowerCase().includes("customcollision")&&u.unshift(c),u.length>0?(console.log(`[ObstacleGLBBuilder] Found ${u.length} custom collision mesh(es) for ${e}`),d=u,d.forEach(e=>{e.isVisible=!1,e.isPickable=!0,e.metadata=e.metadata||{},e.metadata.isCollisionMesh=!0,e.computeWorldMatrix(!0)})):d=[c],c.computeWorldMatrix(!0),1===d.length&&d[0]===c){const{min:e,max:n}=c.getHierarchyBoundingVectors(),t=new v.jLo(e,n);c.setBoundingInfo(t)}return d.forEach(e=>e.computeWorldMatrix(!0)),{root:c,collisionMeshes:d}}}function N(e,n){const t=e.getTotalVertices();if(0===t)return;const o=[];for(let e=0;e<t;e++)o.push(n[0],n[1],n[2],n[3]);e.setVerticesData(v.Rcs.ColorKind,o)}function _(e,n=.75){const t=new v.eaF("obs_hamburger",e),o=[.95,.7,.3,1],a=[.2,.8,.2,1],i=[1,.2,.2,1],s=[.98,.96,.9,1],r=6*n,l=3*n,c=5.5*n,d=1.5*n;let u=0;const p=v.PeD.CreateCylinder("bottomBun",{diameter:2*r,height:l,tessellation:32},e);N(p,o),u=l/2,p.position.y=u,p.parent=t,u+=l/2;const m=v.PeD.CreateCylinder("patty",{diameter:2*c,height:d,tessellation:32},e);N(m,[.4,.2,.1,1]),u+=d/2,m.position.y=u,m.parent=t,u+=d/2;const f=1.8*r,h=v.PeD.CreateBox("cheese",{width:f,height:.3*n,depth:f},e);N(h,[1,.9,.2,1]),u+=.15*n,h.position.y=u,h.rotation.y=Math.PI/4,h.parent=t,u+=.15*n;const g=1.1*r,y=.8*n;u+=y/2;for(let n=0;n<6;n++){const o=v.PeD.CreateBox(`lettuce_${n}`,{width:.8*g,height:y,depth:.5*g},e);N(o,a),o.position.y=u,o.rotation.y=Math.PI/3*n,o.position.x=Math.cos(Math.PI/3*n)*r*.3,o.position.z=Math.sin(Math.PI/3*n)*r*.3,o.parent=t}u+=y/2;const x=4*n,b=.6*n;u+=b/2;const w=v.PeD.CreateCylinder("tomato1",{diameter:2*x,height:b,tessellation:16},e);N(w,i),w.position.y=u,w.position.x=-1.5*n,w.parent=t;const S=v.PeD.CreateCylinder("tomato2",{diameter:2*x,height:b,tessellation:16},e);N(S,i),S.position.y=u,S.position.x=1.5*n,S.parent=t,u+=b/2;const M=v.PeD.CreateSphere("topBun",{diameter:2*r,slice:.5,segments:16},e);N(M,o),M.position.y=u,M.parent=t,[{x:0,z:-2},{x:1.5,z:-1},{x:-1.5,z:-1},{x:2,z:1},{x:-2,z:1},{x:0,z:2},{x:1,z:.5},{x:-1,z:.5}].forEach((o,a)=>{const i=v.PeD.CreateCapsule(`seed_${a}`,{height:.8*n,radius:.2*n},e);N(i,s);const l=o.x*n,c=o.z*n,d=Math.sqrt(l*l+c*c),p=u+.7*Math.sqrt(Math.max(0,r*r-d*d));i.position.set(l,p,c),i.rotation.x=Math.PI/2,i.rotation.z=Math.random()*Math.PI,i.parent=t}),t.position.y=0;const C=t.getChildMeshes();if(C.length>0){const n=v.eaF.MergeMeshes(C,!0,!1,t,!1,!0);if(n)return n.name="obs_hamburger",n.material=function(e){const n="hamburgerUnifiedPBR";if(D.has(n))return D.get(n);const t=new v.YOq(n,e);return t.metallic=0,t.roughness=.9,D.set(n,t),t}(e),n.useVertexColors=!0,n.metadata={isHamburger:!0},n}return t}B.cache={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]},B.loaded=!1;const G=[[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1},{laneIndex:1}],delayNext:1.6},{obstacles:[{type:"duck",laneIndex:-1}],coins:[{laneIndex:0}],delayNext:1.6},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:-1},{laneIndex:0}],delayNext:1.6},{obstacles:[{type:"duck",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8},{laneIndex:1,count:3,spacing:8}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"insuperable",laneIndex:1}],delayNext:1.2},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"jump",laneIndex:0},{type:"insuperable",laneIndex:1}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"duck",laneIndex:0},{type:"insuperable",laneIndex:1}],delayNext:1.8},{obstacles:[{type:"insuperable",laneIndex:-1}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:1}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:.9},{obstacles:[{type:"insuperable",laneIndex:-1}],delayNext:1.5},{obstacles:[{type:"insuperable",laneIndex:0}],delayNext:1.2},{obstacles:[{type:"insuperable",laneIndex:-1},{type:"insuperable",laneIndex:1}],delayNext:2.5},{obstacles:[{type:"jump",laneIndex:1}],delayNext:1.5}],[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:-1}],coins:[{laneIndex:1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:0}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:1}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:-1}],delayNext:2.2}],[{obstacles:[{type:"jump",laneIndex:0}],coins:[{laneIndex:-1,count:3,spacing:8},{laneIndex:1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:-1}],coins:[{laneIndex:0,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:1}],coins:[{laneIndex:-1,count:3,spacing:8}],delayNext:2.2},{obstacles:[{type:"duck",laneIndex:0}],delayNext:2},{obstacles:[{type:"jump",laneIndex:-1},{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:5,spacing:8}],delayNext:2.2},{obstacles:[{type:"jump",laneIndex:0}],delayNext:1.8},{obstacles:[{type:"jump",laneIndex:0}],delayNext:1.8},{obstacles:[{type:"jump",laneIndex:-1},{type:"jump",laneIndex:1}],coins:[{laneIndex:0,count:4,spacing:8}],delayNext:3}]];function $(e,n,o,a,i,s){const r=function(e,n,t,o){const a=[],i=[];let s=160,r=0;const l=function(e){const n="groundPBR";if(D.has(n))return D.get(n);const t=new v.YOq(n,e);return t.albedoColor=k.ground.albedoColor,t.metallic=k.ground.metallic,t.roughness=k.ground.roughness,D.set(n,t),t}(e),c={offset:0};function d(e){e.uScale=1,e.vScale=Math.max(1,12),e.wrapU=v.gPd.CLAMP_ADDRESSMODE,e.wrapV=v.gPd.WRAP_ADDRESSMODE}const{packagedTex:u,dynamicTex:p}=function(){const n=`${o}fallback-road-texture.png`,t=new v.gPd(n,e,void 0,!1,v.gPd.TRILINEAR_SAMPLINGMODE),a=new v.RCS("roadDyn",{width:1024,height:1024},e,!1),i=a.getContext();if(i){const e=1024;i.fillStyle="#201f2b",i.fillRect(0,0,e,e),i.fillStyle="#14131d",i.fillRect(0,.08*e,e,.84*e),i.fillStyle="#fcd75a";const n=Math.round(.005*e),t=Math.round(.01*e),o=Math.round(1*t),a=(e-n)/2;for(let s=0;s<e;s+=t+o)i.fillRect(a,s,n,t)}return a.update(!1),t.onLoadObservable.addOnce(()=>{d(t),l.albedoTexture=t}),{packagedTex:t,dynamicTex:a}}();l.albedoTexture=p,d(p);let m=p;function f(n,t){const o=v.PeD.CreateGround(`ground-${n}`,{width:350,height:t},e);return o.material=l,o.receiveShadows=!0,o.position.z=-n*t,o}function h(e,n){a.forEach(e=>e.dispose()),a.length=0,s=e;for(let t=0;t<n;t++){const n=f(t,e);a.push(n)}c.offset=0,d(m)}h(s,6);const g=Array.from({length:10},(e,n)=>`b${n+1}.glb`),y=new Map;function x(t,o,a,i){const s=new v.VR0(o,e);return s.parent=t,s.rotation=new v.Pq0(0,a,0),i.forEach(e=>{const t=e.createInstance(`${e.name}-${o}`);t.parent=s,function(e,n){const t=y.get(n);t&&(e.position=t.pos.clone(),e.scaling=t.scale.clone(),t.rotQ?(e.rotationQuaternion=t.rotQ.clone(),e.rotation=v.Pq0.Zero()):t.rot&&(e.rotation=t.rot.clone(),e.rotationQuaternion=null))}(t,e),t.receiveShadows=!0,n.addShadowCaster(t,!0)}),s}return Promise.all(g.map(n=>v.cng.ImportMeshAsync(null,t,n,e).then(e=>e.meshes.filter(e=>e instanceof v.eaF)))).then(n=>{const t=n.flat();if(0===t.length)return;t.forEach(n=>{var t,o,a,i;if(n.scaling=n.scaling.scale(8),y.set(n,{pos:n.position.clone(),rot:null!==(o=null===(t=n.rotation)||void 0===t?void 0:t.clone())&&void 0!==o?o:null,rotQ:null!==(i=null===(a=n.rotationQuaternion)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,scale:n.scaling.clone()}),!(n.material instanceof v.YOq)){const t=n.material,o=function(e,n){const t="buildingPBR_"+(n?`${n.r.toFixed(2)}_${n.g.toFixed(2)}_${n.b.toFixed(2)}`:"default");if(D.has(t))return D.get(t);const o=new v.YOq(t,e);return o.albedoColor=null!=n?n:v.v9j.White(),o.metallic=k.building.metallic,o.roughness=k.building.roughness,D.set(t,o),o}(e,null==t?void 0:t.diffuseColor);n.material=o}n.isVisible=!1,n.setEnabled(!1)});const o=new v.VR0("buildSeg-0",e);x(o,"B_A0",0,t),x(o,"B_B0",Math.PI,t);const a=o.getHierarchyBoundingVectors();function s(e,n){e.position=new v.Pq0(0,0,-n*r),i.push(e)}r=Math.max(Math.abs(a.max.z-a.min.z)-1,10),h(r,6),s(o,0);for(let n=1;n<6;n++){const o=new v.VR0(`buildSeg-${n}`,e);x(o,`B_A${n}`,0,t),x(o,`B_B${n}`,Math.PI,t),s(o,n)}}).catch(e=>console.error("Buildings load error:",e)),{groundSegments:a,buildingSegments:i,groundSpacing:s,buildingSpacing:r,getRoadOffset:()=>c.offset,setRoadOffset:e=>{c.offset=e%1,c.offset<0&&(c.offset+=1)},updateRoadTextureOffset:()=>{m.vOffset=c.offset},advanceGround:function(e){for(const n of a)n.position.z+=e;let n=1/0;for(const e of a)e.position.z<n&&(n=e.position.z);for(const e of a)e.position.z>s&&(e.position.z=n-s)},advanceBuildings:function(e){for(const n of i)n.position.z+=e;let n=1/0;for(const e of i)e.position.z<n&&(n=e.position.z);for(const e of i)e.position.z>r&&(e.position.z=n-r)},rebuildGround:h,dispose:function(){a.forEach(e=>e.dispose()),i.forEach(e=>e.dispose()),p.dispose(),u.dispose(),m.dispose()}}}(e,n,o,a),l=function(e,n,t){let o=null;return o=e.onBeforeRenderObservable.add(()=>{const o=T.getState().gameState,a=t();if("playing"!==o&&!("gameover"===o&&a<0))return;const i=e.getEngine().getDeltaTime()/1e3;if(0===a)return;const s=a*i;n.advanceGround(s),n.advanceBuildings(s);const r=n.getRoadOffset()-s/n.groundSpacing;n.setRoadOffset(r),n.updateRoadTextureOffset()}),{dispose:function(){o&&(e.onBeforeRenderObservable.remove(o),o=null)}}}(e,r,i),c=function(e,n,t,o={}){var a,i,s;const r=null!==(a=o.spawnZ)&&void 0!==a?a:-520,l=null!==(i=o.despawnZ)&&void 0!==i?i:200,c=null!==(s=o.laneWidth)&&void 0!==s?s:25,d=function(e){const n="coinPBR";if(D.has(n))return D.get(n);const t=new v.YOq(n,e);return t.albedoColor=k.coin.albedoColor,t.emissiveColor=k.coin.emissiveColor,t.metallic=k.coin.metallic,t.roughness=k.coin.roughness,D.set(n,t),t}(e),u=new v.VR0("coins_root",e),p=[],m=[];function f(){const t=p.find(e=>!e.active);if(t)return t.active=!0,t.mesh.setEnabled(!0),t;const o={mesh:function(){const t=v.PeD.CreateCylinder("coin",{diameter:4,height:.5,tessellation:16},e);return t.rotation.x=Math.PI/2,t.material=d,t.parent=u,t.checkCollisions=!1,n.addShadowCaster(t,!0),t}(),active:!0,rotationSpeed:3};return p.push(o),o}function h(e,n){if(0===n)return;const t=n*e;for(let n=m.length-1;n>=0;n--){const o=m[n];o.mesh.position.z+=t,o.mesh.rotation.y+=o.rotationSpeed*e,o.mesh.position.z>l&&(o.active=!1,o.mesh.setEnabled(!1),m.splice(n,1))}}const g=e.onBeforeRenderObservable.add(()=>{const n=T.getState().gameState,o=t();("playing"===n||"gameover"===n&&o<0)&&h(e.getEngine().getDeltaTime()/1e3,o)});return{spawnCoin:function(e,n,t=1,o=10){const a=e*c;for(let e=0;e<t;e++){const t=f(),i=e*o;t.mesh.position.set(a,5+n,r+i),m.push(t)}},update:h,checkCollisions:function(e){let n=0;const t=2.5;for(let o=m.length-1;o>=0;o--){const a=m[o],i=a.mesh.position,s=i.x-t,r=i.x+t,l=i.y-t,c=i.y+t,d=i.z-t,u=i.z+t;!(e.max.x<s||e.min.x>r||e.max.y<l||e.min.y>c||e.max.z<d||e.min.z>u)&&(a.active=!1,a.mesh.setEnabled(!1),m.splice(o,1),n++)}return n},dispose:function(){g&&e.onBeforeRenderObservable.remove(g),p.forEach(e=>e.mesh.dispose()),u.dispose()},reset:function(){for(const e of m)e.active=!1,e.mesh.setEnabled(!1);m.length=0,console.log("Coin system reset")}}}(e,n,i),d=function(e,n,t){const o=new v.VR0("roadside_cars_root",e),a=[],i=[],s=[];let r=!1;const l=["red_car.glb","green_car.glb","flame_car.glb","white_car.glb"].map(n=>{const t=`scene/assets/model/roadside/${n}`;return v.cng.LoadAssetContainerAsync("",t,e,null,".glb").then(e=>{a.push(e),console.log(`âœ… Loaded roadside car: ${n}`)}).catch(e=>{console.warn(`Failed to load car ${n}:`,e)})});function c(){let e=-800;for(;e<0;)d(e),e+=150+200*Math.random()}function d(e){let t=s.find(e=>!e.active);if(!t){const e=function(){if(0===a.length)return null;const e=a[Math.floor(Math.random()*a.length)].instantiateModelsToScene(e=>e,!1,{doNotInstantiate:!1}).rootNodes[0];return e?(e.parent=o,n.addShadowCaster(e,!0),e.getChildMeshes().forEach(e=>{e.receiveShadows=!0}),e):null}();if(!e)return;t={mesh:e,active:!1},s.push(t)}const r=Math.random()<.5?-45:45,l=-45===r?0:Math.PI;t.mesh.position.set(r,-5,e),t.mesh.rotation=new v.Pq0(0,l,0),t.mesh.setEnabled(!0),t.active=!0,i.push(t)}function u(e){const n=T.getState().gameState,o=t();if("playing"!==n&&!("gameover"===n&&o<0))return;if(0===o)return;const a=o*e;for(const e of i)e.mesh.position.z+=a;for(let e=i.length-1;e>=0;e--){const n=i[e];n.mesh.position.z>150&&(n.active=!1,n.mesh.setEnabled(!1),i.splice(e,1))}if(o>0&&r){let e=0;for(const n of i)n.mesh.position.z<e&&(e=n.mesh.position.z);e>-650&&d(e-(150+200*Math.random()))}}Promise.all(l).then(()=>{r=a.length>0,r&&(console.log(`âœ… Roadside cars ready (${a.length} variants)`),c())});const p=e.onBeforeRenderObservable.add(()=>{u(e.getEngine().getDeltaTime()/1e3)});return{update:u,dispose:()=>{e.onBeforeRenderObservable.remove(p),s.forEach(e=>e.mesh.dispose()),a.forEach(e=>e.dispose()),o.dispose()},reset:function(){for(const e of i)e.active=!1,e.mesh.setEnabled(!1);i.length=0,r&&c()}}}(e,n,i),u=function(e,n,o,a,i={},s){var r,l,c;const d=null!==(r=i.laneWidth)&&void 0!==r?r:25,u=(i.laneCount,null!==(l=i.spawnZ)&&void 0!==l?l:-1500),p=null!==(c=i.despawnZ)&&void 0!==c?c:200,m=(i.minSpawnDelay,i.maxSpawnDelay,{jump:z(e,"jump"),duck:z(e,"duck"),platform:z(e,"platform"),insuperable:z(e,"insuperable"),hamburger:z(e,"jump")}),f=function(){const e={jump:[],duck:[],platform:[],insuperable:[],hamburger:[]};try{const n=t(44503);n.keys().forEach(t=>{const o=t.replace(/^\.\//,"").split("/");if(o.length>=2){const a=o[0];if(a in e){const o=n(t);e[a].push(o)}}}),console.log("Obstacle Model Scan Results:",e)}catch(e){console.warn("Failed to scan obstacle folders (require.context might not be available):",e)}return e}();let h=!1;B.preloadAll(e,f).then(()=>{h=!0,console.log("âœ… Obstacle GLBs ready"),s&&s()});const g=new v.VR0("obstacles_root",e),y={jump:()=>function(e,n){const t=v.PeD.CreateBox("obs_jump",{width:12,height:12,depth:14},e);return t.material=n,t.position.y=6,t}(e,m.jump),duck:()=>function(e,n){const t=v.PeD.CreateBox("obs_duck",{width:18,height:6,depth:10},e);return t.material=n,t.position.y=12,t}(e,m.duck),platform:()=>function(e,n){const t=v.PeD.CreateBox("obs_platform",{width:18,height:15,depth:90},e);return t.material=n,t.position.y=7.5,t}(e,m.platform),insuperable:()=>function(e){const n=_(e,1.5);return n.name="obs_insuperable",n}(e),hamburger:()=>_(e,1)},x=[],b=[];function w(t){let o=!1;"hamburger"!==t&&("jump"===t||"insuperable"===t)&&(o=Math.random()<0);const a=B.getVariantCount(t),i=a>0?Math.floor(Math.random()*a):void 0,s=x.find(e=>e.type===t&&!e.active&&!!e.isHamburgerVariant===o&&(void 0===i||e.variant===i||void 0===e.variant));if(s)return s.active=!0,s.mesh.setEnabled(!0),s;let r=null,l=null,c=i,d=!1;if(o)r=_(e,"insuperable"===t?2:1),l=[r],c=void 0,d=!0;else{const n=void 0!==i?B.getMesh(t,e,i):B.getMesh(t,e);n?(r=n.root,l=n.collisionMeshes):(r=y[t](),l=[r],c=void 0),d=!1}r.parent=g,r.receiveShadows=!0,r.metadata={obstacleType:t,variant:c,isHamburgerVariant:d},n.addShadowCaster(r,!0);const u={mesh:r,collisionMeshes:null!=l?l:[r],type:t,variant:c,isHamburgerVariant:d,active:!0};return x.push(u),u}let S=0,M=G[0],C=0,I=2;const P=e.onBeforeRenderObservable.add(()=>{var n,t;const i=T.getState().gameState,s=o();if("playing"!==i&&!("gameover"===i&&s<0))return;const r=e.getEngine().getDeltaTime()/1e3;if(0===s)return;const l=s*r;for(const e of b)if(e.mesh.position.z+=l,"insuperable"===e.type){const o=(null===(n=e.mesh.metadata)||void 0===n?void 0:n.sourceUrl)||"",a=o.toLowerCase().includes("soda");if((null===(t=e.mesh.metadata)||void 0===t?void 0:t._debugLogged)||(console.log(`[DEBUG] Insuperable mesh: ${e.mesh.name}, sourceUrl: ${o}, isSoda: ${a}`),e.mesh.metadata=e.mesh.metadata||{},e.mesh.metadata._debugLogged=!0),a){const n=1.5*r;e.mesh.rotate(v._0v.Y,n,v.$xS.LOCAL)}}for(let e=b.length-1;e>=0;e--){const n=b[e];n.mesh.position.z>p&&(n.active=!1,n.mesh.setEnabled(!1),b.splice(e,1))}s>0&&(S+=r,S>=I&&(S=0,function(){if(C>=M.length){const e=Math.floor(Math.random()*G.length);M=G[e],C=0,console.log("Switched to pattern index:",e)}const e=M[C];for(const n of e.obstacles){const e=w(n.type),t=n.laneIndex*d;e.mesh.position.set(t,e.mesh.position.y,u),b.push(e)}if(e.coins)for(const n of e.coins)a.spawnCoin(n.laneIndex,n.yOffset||0,n.count,n.spacing);I=e.delayNext,C++}()))});return{dispose:function(){P&&e.onBeforeRenderObservable.remove(P),x.forEach(e=>e.mesh.dispose()),g.dispose()},getActiveObstacles:function(){return b},getActivePlatformMeshes:function(){return b.filter(e=>"platform"===e.type).map(e=>e.mesh)},reset:function(){for(const e of b)e.active=!1,e.mesh.setEnabled(!1);b.length=0,S=0,C=0,I=2;const e=Math.floor(Math.random()*G.length);M=G[e],console.log("Obstacle system reset")},isReady:function(){return h}}}(e,n,i,c,{laneWidth:25,laneCount:3},s);return{dispose:function(){u.dispose(),c.dispose(),d.dispose(),l.dispose(),r.dispose()},obstacleController:u,coinController:c}}v.gSV&&(v.gSV.Configuration={decoder:{wasmUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://cdn.babylonjs.com/draco_wasm_wrapper_gltf.wasm",fallbackUrl:"https://cdn.babylonjs.com/draco_decoder_gltf.js"}});var F=t(74848),V=t(5338);const U=()=>(0,F.jsx)("div",{className:"loading-screen",children:(0,F.jsxs)("div",{className:"loading-content",children:[(0,F.jsx)("div",{className:"loading-spinner"}),(0,F.jsx)("div",{className:"loading-text",children:"Loading..."})]})}),q=()=>{const e=T(e=>e.countdownValue);if(null===e)return null;const n=0===e?"GO!":e.toString(),t=0===e;return(0,F.jsx)("div",{className:"countdown-overlay",children:(0,F.jsx)("div",{className:"countdown-number "+(t?"countdown-go":""),children:n},e)})},W=()=>{const e=T(e=>e.isLoading),n=T(e=>e.coinCount),t=T(e=>e.lives),o=T(e=>e.gameState),a=T(e=>e.activePowerUps),i=T(e=>e.matchTimeRemaining),s=T(e=>e.isMatchTimerActive);return e?(0,F.jsx)(U,{}):(0,F.jsxs)("div",{className:"game-overlay-container",children:[(0,F.jsx)(q,{}),(0,F.jsxs)("div",{className:"top-hud",children:[(0,F.jsxs)("div",{className:"lives-container",children:[(0,F.jsx)("span",{className:"lives-label",children:"Lives:"}),(0,F.jsxs)("div",{className:"hearts-container",children:[Array.from({length:Math.max(0,t)}).map((e,n)=>(0,F.jsx)("span",{className:"heart",children:"â¤ï¸"},n)),Array.from({length:Math.max(0,3-t)}).map((e,n)=>(0,F.jsx)("span",{className:"empty-heart",children:"ðŸ–¤"},`empty-${n}`))]})]}),(0,F.jsxs)("div",{className:"coin-counter",children:[(0,F.jsx)("span",{className:"coin-icon",children:"ðŸŸ¡"}),(0,F.jsx)("span",{className:"coin-count",children:n})]})]}),s&&(0,F.jsxs)("div",{className:"match-timer "+(i<=10?"timer-warning":""),children:["â±ï¸ ",(r=i,`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`)]}),a.length>0&&(0,F.jsx)("div",{className:"powerups-container",children:a.map(e=>(0,F.jsxs)("div",{className:"powerup-icon",children:["âš¡ ",e.type]},e.type))}),"gameover"===o&&(0,F.jsxs)("div",{className:"gameover-overlay",children:[(0,F.jsx)("div",{className:"gameover-text",children:i<=0?"TIME'S UP!":"GAME OVER"}),(0,F.jsx)("div",{className:"gameover-subtext",children:"Press R to restart"})]})]});var r};window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("game-canvas");e?(function(){const e=document.getElementById("game-canvas");if(!(e&&e instanceof HTMLCanvasElement))return void console.error("âŒ Canvas not found - cannot initialize React overlay");const n=document.createElement("div");n.id="react-overlay";const t=()=>{const t=e.getBoundingClientRect();n.style.top=`${t.top}px`,n.style.left=`${t.left}px`,n.style.width=`${t.width}px`,n.style.height=`${t.height}px`};t(),document.body.appendChild(n),new ResizeObserver(()=>{t()}).observe(e),window.addEventListener("resize",t),(0,V.H)(n).render((0,F.jsx)(M.StrictMode,{children:(0,F.jsx)(W,{})})),console.log("âœ… React overlay initialized and synced with canvas")}(),function(e){if(!e)return;let n=null;const t=()=>{if(!n)return;const t=Math.max(1,e.height/1080);n.setHardwareScalingLevel(Math.min(2.5,t))},o=()=>{const o=9/16,a=window.innerWidth;let i=window.innerHeight,s=i*o;s>a&&(s=a,i=s/o),e.width=s,e.height=i,e.style.width=`${s}px`,e.style.height=`${i}px`,null==n||n.resize(),t()};o();const{engine:a,scene:i}=function(e){const n=new v.N$8(e,!0);v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.NoneLogLevel;const t=new v.Z58(n);return t.environmentTexture=v.b4q.CreateFromPrefilteredData("https://assets.babylonjs.com/environments/environmentSpecular.env",t),t.environmentIntensity=.4,{engine:n,scene:t}}(e);n=a,t();const{shadowGenerator:s}=function(e){const n=new v.g4z("hemilight",new v.Pq0(0,1,0),e);n.intensity=.5;const t=new v.ZyN("dirLight",new v.Pq0(-.5,-1,.5),e);t.position=new v.Pq0(20,40,-30),t.intensity=1.5;const o=new v.owA(2048,t);return o.usePercentageCloserFiltering=!0,o.filteringQuality=v.owA.QUALITY_MEDIUM,o.bias=.001,o.normalBias=.02,t.shadowMinZ=1,t.shadowMaxZ=200,{hemisphericLight:n,directionalLight:t,shadowGenerator:o,setDirectionalLightIntensity:e=>{t.intensity=e}}}(i),{camera:r}=function(e){const n=new v.Lqh("camera",Math.PI/2,Math.PI/2.5,60,new v.Pq0(0,8,0),e);return n.inputs.clear(),{camera:n}}(i),{assetBase:l,modelRoot:c,textureRoot:d}=function(){const e="undefined"!=typeof window?window.location.hostname:"",n=e.endsWith("github.io")||e.endsWith("vercel.app")||e.endsWith(".vercel.app")?"https://media.githubusercontent.com/media/elektrazone/INFIN_BBOY_REPO/main/public/scene/assets/":"scene/assets/";return{assetBase:n,modelRoot:`${n}model/`,textureRoot:`${n}road/`}}();!function(e,n){const t=v.PeD.CreateSphere("skyDome",{diameter:5e3,segments:32,sideOrientation:v.eaF.BACKSIDE},e),o=new v.FUi("skyMat",e),a=new v.gPd(`${n}sky_clouds.jpg`,e,!1,!1,v.gPd.TRILINEAR_SAMPLINGMODE);a.uScale=8,a.vScale=4,o.diffuseTexture=a,o.emissiveTexture=a,o.emissiveColor=new v.v9j(.5,.5,.5),o.specularColor=new v.v9j(0,0,0),o.backFaceCulling=!1,o.disableLighting=!0,t.material=o,t.isPickable=!1,t.infiniteDistance=!0,t.position=v.Pq0.Zero()}(i,l);let u=0,p=!1,m=!1;function f(){if(p&&m){console.log("âœ… All assets loaded - hiding loading screen"),T.getState().setLoading(!1);const e=[3,2,1,0];let n=0;const t=()=>{T.getState().setCountdown(e[n]),n++,n<e.length?setTimeout(t,1e3):setTimeout(()=>{T.getState().setCountdown(null),console.log("ðŸƒ Starting game after countdown"),y.startGame(),T.getState().startMatchTimer(),console.log("â±ï¸ Match timer started (2 minutes)")},500)};t()}}const h=$(i,s,c,d,()=>u,()=>{m=!0,console.log("âœ… Obstacles ready"),f()}),g=function(){let e=0;function n(n){e=n,T.getState().updateCoinCount(e)}const t=t=>{const o=t.detail.count;n(e+o)};return window.addEventListener("coinCollected",t),{updateCoinCount:n,dispose:function(){window.removeEventListener("coinCollected",t)}}}(),y=L(i,r,c,s,e=>u=e,h.obstacleController,h.coinController,()=>{p=!0,console.log("âœ… Player ready"),f()});n.runRenderLoop(()=>{y.ensureIdle(),i.render()});const x=()=>o(),b=e=>y.handleKeyDown(e),w=e=>y.handleKeyUp(e),S=e=>y.handleTouchStart(e),M=e=>y.handleTouchMove(e),C=e=>y.handleTouchEnd(e),I=e=>y.handlePointerDown(e),P=e=>y.handlePointerUp(e);window.addEventListener("resize",x),window.addEventListener("keydown",b),window.addEventListener("keyup",w),window.addEventListener("touchstart",S,{passive:!0}),window.addEventListener("touchmove",M,{passive:!0}),window.addEventListener("touchend",C,{passive:!0}),window.addEventListener("pointerdown",I),window.addEventListener("pointerup",P),window.addEventListener("beforeunload",()=>{window.removeEventListener("resize",x),window.removeEventListener("keydown",b),window.removeEventListener("keyup",w),window.removeEventListener("touchstart",S),window.removeEventListener("touchmove",M),window.removeEventListener("touchend",C),window.removeEventListener("pointerdown",I),window.removeEventListener("pointerup",P),h.dispose(),y.dispose(),g.dispose(),v.VyI.ClearLogCache(),v.VyI.LogLevels=v.VyI.AllLogLevel,null==n||n.dispose()})}(e)):console.error("âŒ Errore: Canvas #game-canvas non trovato.")})},11249(e,n,t){"use strict";t.d(n,{A:()=>r});var o=t(31601),a=t.n(o),i=t(76314),s=t.n(i)()(a());s.push([e.id,"body {\n  margin: 0;\n  padding: 0;\n  background: black;\n  overflow: hidden;\n}\n\n#game-canvas {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: block;\n}\n\n/* ============================================ */\n/* React Overlay Styles */\n/* ============================================ */\n\n#react-overlay {\n  position: fixed;\n  pointer-events: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Game Overlay Container */\n/* ============================================ */\n\n.game-overlay-container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  user-select: none;\n  z-index: 1000;\n}\n\n/* ============================================ */\n/* Top HUD */\n/* ============================================ */\n\n.top-hud {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  justify-content: space-between;\n  padding: 20px;\n}\n\n/* ============================================ */\n/* Lives Display (Top Left) */\n/* ============================================ */\n\n.lives-container {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.lives-label {\n  color: white;\n  font-family: sans-serif;\n  font-size: 20px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n.hearts-container {\n  display: flex;\n  gap: 5px;\n}\n\n.heart {\n  font-size: 24px;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n.empty-heart {\n  font-size: 24px;\n  opacity: 0.3;\n  filter: drop-shadow(2px 2px 0 #000);\n}\n\n/* ============================================ */\n/* Coin Counter (Top Right) */\n/* ============================================ */\n\n.coin-counter {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.coin-icon {\n  font-size: 24px;\n}\n\n.coin-count {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  font-weight: bold;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Power-ups Display (Top Center) */\n/* ============================================ */\n\n.powerups-container {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  gap: 10px;\n}\n\n.powerup-icon {\n  padding: 8px 16px;\n  background-color: rgba(255, 215, 0, 0.2);\n  border: 2px solid gold;\n  border-radius: 8px;\n  color: white;\n  font-family: sans-serif;\n  font-size: 16px;\n  font-weight: bold;\n  text-shadow: 1px 1px 0 #000;\n}\n\n/* ============================================ */\n/* Game Over Screen */\n/* ============================================ */\n\n.gameover-overlay {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  pointer-events: auto;\n}\n\n.gameover-text {\n  color: #ff4444;\n  font-family: sans-serif;\n  font-size: 64px;\n  font-weight: bold;\n  text-shadow: 4px 4px 0 #000;\n  margin-bottom: 20px;\n}\n\n.gameover-subtext {\n  color: white;\n  font-family: sans-serif;\n  font-size: 24px;\n  text-shadow: 2px 2px 0 #000;\n}\n\n/* ============================================ */\n/* Loading Screen */\n/* ============================================ */\n\n.loading-screen {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n}\n\n.loading-content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 24px;\n}\n\n.loading-spinner {\n  width: 60px;\n  height: 60px;\n  border: 4px solid rgba(255, 255, 255, 0.1);\n  border-top: 4px solid #e94560;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n.loading-text {\n  color: white;\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 24px;\n  font-weight: 600;\n  letter-spacing: 2px;\n  text-transform: uppercase;\n  text-shadow: 0 2px 10px rgba(233, 69, 96, 0.5);\n  animation: pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes pulse {\n\n  0%,\n  100% {\n    opacity: 1;\n  }\n\n  50% {\n    opacity: 0.5;\n  }\n}\n\n/* ============================================ */\n/* Countdown Overlay */\n/* ============================================ */\n\n.countdown-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1500;\n  pointer-events: none;\n}\n\n.countdown-number {\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 150px;\n  font-weight: 900;\n  color: #ffa500;\n  background: linear-gradient(180deg, #ffdd00 0%, #ff8c00 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 165, 0, 0.5));\n  animation: countdown-zoom 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;\n}\n\n.countdown-go {\n  color: #4ade80;\n  text-shadow:\n    0 0 20px rgba(74, 222, 128, 0.5),\n    0 0 40px rgba(74, 222, 128, 0.3),\n    0 4px 8px rgba(0, 0, 0, 0.5);\n}\n\n@keyframes countdown-zoom {\n  0% {\n    transform: scale(0.3);\n    opacity: 0;\n  }\n\n  20% {\n    opacity: 1;\n  }\n\n  70% {\n    transform: scale(1.1);\n    opacity: 1;\n  }\n\n  100% {\n    transform: scale(1.0);\n    opacity: 0;\n  }\n}\n\n/* ============================================ */\n/* Match Timer */\n/* ============================================ */\n\n.match-timer {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  font-family: 'Inter', 'Segoe UI', sans-serif;\n  font-size: 2rem;\n  font-weight: bold;\n  color: #fff;\n  text-shadow: \n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 10px rgba(255, 255, 255, 0.3);\n  pointer-events: none;\n  z-index: 100;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 8px;\n}\n\n.match-timer.timer-warning {\n  color: #ff4444;\n  animation: pulse-warning 0.5s ease-in-out infinite;\n  text-shadow: \n    2px 2px 4px rgba(0, 0, 0, 0.8),\n    0 0 15px rgba(255, 68, 68, 0.6);\n}\n\n@keyframes pulse-warning {\n  0%, 100% { \n    transform: translateX(-50%) scale(1); \n  }\n  50% { \n    transform: translateX(-50%) scale(1.1); \n  }\n}",""]);const r=s},25100(e,n,t){"use strict";e.exports=t.p+"scene/assets/model/obstacles/duck/oring_new.glb"},31601(e){"use strict";e.exports=function(e){return e[1]}},39012(e,n,t){"use strict";e.exports=t.p+"scene/assets/model/obstacles/insuperable/Soda_new1.glb"},41113(e){"use strict";e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},44503(e,n,t){var o={"./duck/oring_new.glb":25100,"./insuperable/Fries_new.glb":65115,"./insuperable/Soda_new1.glb":39012,"./jump/Burger.glb":82218};function a(e){var n=i(e);return t(n)}function i(e){if(!t.o(o,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=44503},55056(e,n,t){"use strict";e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},65115(e,n,t){"use strict";e.exports=t.p+"scene/assets/model/obstacles/insuperable/Fries_new.glb"},76314(e){"use strict";e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,o,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),n.push(d))}},n}},77659(e){"use strict";var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},82218(e,n,t){"use strict";e.exports=t.p+"scene/assets/model/obstacles/jump/Burger.glb"},85072(e){"use strict";var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var i={},s=[],r=0;r<e.length;r++){var l=e[r],c=o.base?l[0]+o.base:l[0],d=i[c]||0,u="".concat(c," ").concat(d);i[c]=d+1;var p=t(u),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)n[p].references++,n[p].updater(m);else{var f=a(m,o);o.byIndex=r,n.splice(r,0,{identifier:u,updater:f,references:1})}s.push(u)}return s}function a(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,a){var i=o(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var r=t(i[s]);n[r].references--}for(var l=o(e,a),c=0;c<i.length;c++){var d=t(i[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}i=l}}},97825(e){"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,a&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var i=t.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},e=>{e.O(0,[645,967],()=>e(e.s=10915)),e.O()}]);